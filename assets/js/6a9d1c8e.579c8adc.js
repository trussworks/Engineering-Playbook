"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[4842],{6515:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"developing/command-line-tools/direnv","title":"direnv","description":"Overview","source":"@site/docs/developing/command-line-tools/direnv.md","sourceDirName":"developing/command-line-tools","slug":"/developing/command-line-tools/direnv","permalink":"/docs/developing/command-line-tools/direnv","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/developing/command-line-tools/direnv.md","tags":[],"version":"current","frontMatter":{},"sidebar":"about","previous":{"title":"Building internal tools with GoReleaser","permalink":"/docs/developing/command-line-tools/HOW2GORELEASER"},"next":{"title":"Docker","permalink":"/docs/developing/command-line-tools/docker"}}');var r=i(4848),t=i(8453);const l={},s="direnv",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Installation",id:"installation",level:2},{value:"Getting started",id:"getting-started",level:2},{value:"Usage example: Changing the git committer email",id:"usage-example-changing-the-git-committer-email",level:3},{value:"Language-specific settings",id:"language-specific-settings",level:3},{value:"direnv and golang",id:"direnv-and-golang",level:4},{value:"direnv and Docker Machine",id:"direnv-and-docker-machine",level:4},{value:"direnv and python",id:"direnv-and-python",level:4},{value:"Storing secrets with direnv",id:"storing-secrets-with-direnv",level:3},{value:"Other examples",id:"other-examples",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"direnv",children:"direnv"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://direnv.net/",children:"direnv"})," is an MIT-licensed command-line tool that addresses the hassle of setting per-project environment variables."]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.p,{children:"Via homebrew:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"brew install direnv\n"})}),"\n",(0,r.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,r.jsxs)(n.p,{children:["Create an ",(0,r.jsx)(n.code,{children:".envrc"})," file in a directory with some environment variables your project needs:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"$ cat <<ENVRC > .envrc\nexport DB_HOST=localhost\nexport DB_PORT=5432\nexport DB_USER=postgres\nexport DB_PASSWORD=mysecretpassword\nexport DB_NAME=dev_db\nCLIENT_AUTH_SECRET_KEY=$(<client_auth_secret.key)\nENVRC\n$\n"})}),"\n",(0,r.jsxs)(n.p,{children:["On first run, you should get a message indicating that you will have to explicitly authorize ",(0,r.jsx)(n.code,{children:"direnv"})," to load the file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:"$ cd ./projectdir\ndirenv: error .envrc is blocked. Run `direnv allow` to approve its content.\n$ direnv allow\ndirenv: loading .envrc\ndirenv: export +DB_HOST +DB_NAME +DB_PASSWORD +DB_PORT +DB_USER -PS2\n$\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Your local environment variables should be updated now. Any time the ",(0,r.jsx)(n.code,{children:".envrc"})," file is changed, you will need to re-approve the file, but it will load automatically otherwise."]}),"\n",(0,r.jsx)(n.h3,{id:"usage-example-changing-the-git-committer-email",children:"Usage example: Changing the git committer email"}),"\n",(0,r.jsxs)(n.p,{children:["Some Trussels develop on projects where they must use a client email address. ",(0,r.jsx)(n.code,{children:"direnv"})," can automate the process of changing the email address displayed in your git commits appropriately. For example, consider the following directory structure:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:'$ pwd\n/User/trussel/src/\n$ tree -n -L 2\n.\n\u251c\u2500\u2500 me\n\u2502\xa0\xa0 \u251c\u2500\u2500 personal_toy_project_1\n\u2502\xa0\xa0 \u2514\u2500\u2500 personal_toy_project_2\n\u251c\u2500\u2500 client\n\u2502\xa0\xa0 \u2514\u2500\u2500 client_project\n\u2514\u2500\u2500 truss\n    \u2514\u2500\u2500 Engineering-Playbook\n$ cat me/.envrc\nexport GIT_AUTHOR_EMAIL="ryan.delaney@gmail.com"\nexport GIT_COMITTER_EMAIL="ryan.delaney@gmail.com"\n$ cat client/.envrc\nexport GIT_AUTHOR_EMAIL="ryan.delaney@clientdomain.com"\nexport GIT_COMITTER_EMAIL="ryan.delaney@clientdomain.com"\n$ cat truss/.envrc\nexport GIT_AUTHOR_EMAIL="ryan@truss.works"\nexport GIT_COMITTER_EMAIL="ryan@truss.works"\n$\n'})}),"\n",(0,r.jsx)(n.h3,{id:"language-specific-settings",children:"Language-specific settings"}),"\n",(0,r.jsx)(n.h4,{id:"direnv-and-golang",children:"direnv and golang"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["From the ",(0,r.jsx)(n.a,{href:"https://github.com/direnv/direnv/wiki/golang",children:"direnv wiki"}),":"]})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["If you're using ",(0,r.jsx)(n.a,{href:"http://getgb.io/",children:"the gb build tool"})," for Go projects, you may find this layout useful for helping many ",(0,r.jsx)(n.code,{children:"GOPATH"}),"-dependent ecosystem tools work seamlessly in your projects:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# Usage: layout golang\n#\n# Sets up environment for a Go project using the alternative gb build tool. Also\n# works with the official dep package.In addition to project executables on\n# PATH, this includes an exclusive, project- local GOPATH which enables many\n# tools like gocode and oracle to "just work".\n#\n# http://getgb.io/\n# https://golang.github.io/dep/\n#\n\nlayout_golang() {\n  export GOPATH="$PWD/vendor:$PWD"\n  PATH_add "$PWD/vendor/bin"\n  PATH_add bin\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Add this to your ",(0,r.jsx)(n.code,{children:"~/.direnvrc"})," and then use ",(0,r.jsx)(n.code,{children:"layout golang"})," in your project ",(0,r.jsx)(n.code,{children:".envrc"}),"s. With this loaded, the support for many tools like ",(0,r.jsx)(n.code,{children:"gocode"}),", ",(0,r.jsx)(n.code,{children:"oracle"}),", ",(0,r.jsx)(n.code,{children:"godoc"}),', etc. in editor plugins like vim-go and GoSublime will usually "just work". This layout may also be completely applicable if you are using the Go 1.5 "vendor experiment" with the official ',(0,r.jsx)(n.code,{children:"go"})," tool on your project."]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"https://github.com/direnv/direnv/pull/188",children:"this pull request"})," for some background discussion."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"direnv-and-docker-machine",children:"direnv and Docker Machine"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["From the ",(0,r.jsx)(n.a,{href:"https://github.com/direnv/direnv/wiki/Docker-Machine",children:"direnv wiki"}),":"]})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"When using Docker Machine on OS X, there's an incantation that needs to be run in every shell where you want to run Docker. Direnv can help mitigate that annoyance:"}),"\n",(0,r.jsxs)(n.p,{children:["Add to ",(0,r.jsx)(n.code,{children:"~/.direnvrc"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"use_docker-machine(){\n  local env=${1:-default}\n  echo Docker machine: $env\n  local machine_cmd=$(docker-machine env --shell bash $env)\n\n  eval $(docker-machine env --shell bash $env)\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Any project that's using docker, add to ",(0,r.jsx)(n.code,{children:".envrc"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"use docker-machine\n"})}),"\n",(0,r.jsxs)(n.p,{children:["One nice feature to this is that you can have different Docker machine VMs per project, if needed by saying ",(0,r.jsx)(n.code,{children:"use docker-machine special"}),", for instance."]}),"\n",(0,r.jsxs)(n.p,{children:["Note that when using this pattern, when docker-machine warns you to ",(0,r.jsx)(n.code,{children:"eval (docker-machine env)"}),", you'll want instead to ",(0,r.jsx)(n.code,{children:"direnv reload"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"direnv-and-python",children:"direnv and python"}),"\n",(0,r.jsxs)(n.p,{children:["If using ",(0,r.jsx)(n.code,{children:"pipenv"}),", add ",(0,r.jsx)(n.code,{children:"layout_pipenv"})," to the ",(0,r.jsx)(n.code,{children:".envrc"})," and the virtualenv will be loaded automatically when you enter the project directory."]}),"\n",(0,r.jsx)(n.h3,{id:"storing-secrets-with-direnv",children:"Storing secrets with direnv"}),"\n",(0,r.jsxs)(n.p,{children:["Sometimes, we want to put the ",(0,r.jsx)(n.code,{children:".envrc"})," in source control but also use direnv to store secrets that should not be source controlled. With this bit of code, we can separate local secrets into ",(0,r.jsx)(n.code,{children:".envrc.local"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-console",children:'$ cat << EOF >> .envrc\nif [[ -s .envrc.local ]] ; then\n  source_env .envrc.local\nfi\nEOF\n$ echo ".envrc.local" >> .gitignore\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Commands in ",(0,r.jsx)(n.code,{children:".envrc.local"})," will be loaded by direnv, but ignored by git."]}),"\n",(0,r.jsx)(n.h3,{id:"other-examples",children:"Other examples"}),"\n",(0,r.jsxs)(n.p,{children:["Trussels have thoroughly exploited ",(0,r.jsx)(n.code,{children:"direnv"})," on the ",(0,r.jsx)(n.a,{href:"https://github.com/transcom/mymove/blob/master/.envrc",children:"TransCom/mymove"})," GitHub repository."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>s});var o=i(6540);const r={},t=o.createContext(r);function l(e){const n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);