"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[1116],{6567:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"developing/vcs/master-to-main","title":"Master to Main branch rename","description":"These instructions will help moving repos from using the default branch name master and modify it to be","source":"@site/docs/developing/vcs/master-to-main.md","sourceDirName":"developing/vcs","slug":"/developing/vcs/master-to-main","permalink":"/docs/developing/vcs/master-to-main","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/developing/vcs/master-to-main.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"about","previous":{"title":"Git Workflow","permalink":"/docs/developing/vcs/git-workflow"},"next":{"title":"Leadership","permalink":"/docs/leadership/"}}');var r=i(4848),s=i(8453);const a={sidebar_position:4},o="Master to Main branch rename",l={},h=[{value:"Prereqs",id:"prereqs",level:2},{value:"Instructions to change default branch name",id:"instructions-to-change-default-branch-name",level:2},{value:"Future proofing",id:"future-proofing",level:2},{value:"Github",id:"github",level:2},{value:"Terraform Registry",id:"terraform-registry",level:2},{value:"IDE Changes",id:"ide-changes",level:2},{value:"Tooling Changes",id:"tooling-changes",level:2},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"master-to-main-branch-rename",children:"Master to Main branch rename"})}),"\n",(0,r.jsxs)(n.p,{children:["These instructions will help moving repos from using the default branch name ",(0,r.jsx)(n.code,{children:"master"})," and modify it to be\n",(0,r.jsx)(n.code,{children:"main"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"prereqs",children:"Prereqs"}),"\n",(0,r.jsxs)(n.p,{children:["First, ensure that the version of ",(0,r.jsx)(n.code,{children:"git"})," that you have installed is at least v2.28.0. This is important to ensure\nyou have access to the ",(0,r.jsx)(n.a,{href:"https://github.blog/2020-07-27-highlights-from-git-2-28/#introducing-init-defaultbranch",children:"init.DefaultBranch"}),"\nsetting in the git config file."]}),"\n",(0,r.jsx)(n.h2,{id:"instructions-to-change-default-branch-name",children:"Instructions to change default branch name"}),"\n",(0,r.jsxs)(n.p,{children:["To update the branch name use the npm tool ",(0,r.jsx)(n.a,{href:"https://github.com/lgarron/main-branch",children:"lgarron/main-branch"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"npm install -g main-branch\nmain-branch trussworks/master-to-main-test replace master main\n"})}),"\n",(0,r.jsx)(n.p,{children:"Follow up with local modifications:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"cd git-repo-name\ngit pull origin main\ngit checkout main\ngit branch --delete master\ngit branch --set-upstream-to=origin/main main\ngit symbolic-ref HEAD refs/heads/main\ngit symbolic-ref refs/remotes/origin/HEAD refs/remotes/origin/main\ngit fetch --all --prune\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Test that the ",(0,r.jsx)(n.code,{children:"master"})," branch has been removed by running this command and getting a shell error (exit code not ",(0,r.jsx)(n.code,{children:"0"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"git checkout master\n"})}),"\n",(0,r.jsx)(n.h2,{id:"future-proofing",children:"Future proofing"}),"\n",(0,r.jsxs)(n.p,{children:["If you're using ",(0,r.jsx)(n.code,{children:"git"})," v2.28.0 or later you should be able to configure git globally to ensure ",(0,r.jsx)(n.code,{children:"main"})," is now\nyour default branch permanently."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"git config --global init.defaultBranch main\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Now in your ",(0,r.jsx)(n.code,{children:"~/.gitconfig"})," file you'll see this addition:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",children:"[init]\n    defaultBranch = main\n"})}),"\n",(0,r.jsxs)(n.p,{children:["For older versions of the ",(0,r.jsx)(n.code,{children:"git"})," tool you'll have to be careful to not create new repos with ",(0,r.jsx)(n.code,{children:"master"})," as the default\nbranch. First make a new git alias:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"git config --global alias.main '!git init && git checkout -b main'\ngit main\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can add an alias to your ",(0,r.jsx)(n.code,{children:"bash"})," or other shell to help:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"alias git_init='git main'\n"})}),"\n",(0,r.jsx)(n.p,{children:"Alternatively use this alias:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"alias git_init='git init && git checkout -b main'\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Don't forget to source your changes to your shell. For bash you can run: ",(0,r.jsx)(n.code,{children:"source ~/.bash_profile"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Which gives you the ability to run either ",(0,r.jsx)(n.code,{children:"git main"})," or ",(0,r.jsx)(n.code,{children:"git_init"})," to start a new repo with ",(0,r.jsx)(n.code,{children:"main"})," as the default\nbranch."]}),"\n",(0,r.jsx)(n.h2,{id:"github",children:"Github"}),"\n",(0,r.jsx)(n.p,{children:"The branch protection rules in Github will need to be modified for each repo that you touch."}),"\n",(0,r.jsx)(n.h2,{id:"terraform-registry",children:"Terraform Registry"}),"\n",(0,r.jsxs)(n.p,{children:["Terraform registry uses git tags to pull from github. As long as ",(0,r.jsx)(n.code,{children:"main"})," is a reflection of ",(0,r.jsx)(n.code,{children:"master"})," then no\nchanges are needed for the terraform registry."]}),"\n",(0,r.jsx)(n.h2,{id:"ide-changes",children:"IDE Changes"}),"\n",(0,r.jsxs)(n.p,{children:["Any ID that handles git integrations should be able to handle this change. Consider adding ",(0,r.jsx)(n.code,{children:"main"})," to the set of protected\nbranches if your editor allows for that."]}),"\n",(0,r.jsx)(n.h2,{id:"tooling-changes",children:"Tooling Changes"}),"\n",(0,r.jsx)(n.p,{children:"As a quick reference for some tools that need to be updated here is a non-exhaustive list:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://danger.systems/js/",children:"DangerJS"})," should be updated to at least ",(0,r.jsx)(n.code,{children:"v10.3.0"})," (see the ",(0,r.jsx)(n.a,{href:"https://github.com/danger/danger-js/issues/1057",children:"PR"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://git-scm.com/",children:"git"})," should be updated to at least ",(0,r.jsx)(n.code,{children:"v2.28.0"})," (see the ",(0,r.jsx)(n.a,{href:"https://github.blog/2020-07-27-highlights-from-git-2-28/#introducing-init-defaultbranch",children:"Release Notes"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,r.jsx)(n.p,{children:"References:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://dev.to/rhymu8354/git-renaming-the-master-branch-137b",children:"Git Renaming the master branch"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var t=i(6540);const r={},s=t.createContext(r);function a(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);