"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[519],{8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var s=t(6540);const o={},r=s.createContext(o);function i(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},9789:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"infrasec/adrs/tests_in_terraform","title":"Remove tests from our open-source Terraform modules","description":"Context and Problem Statement","source":"@site/docs/infrasec/adrs/0001-tests_in_terraform.md","sourceDirName":"infrasec/adrs","slug":"/infrasec/adrs/tests_in_terraform","permalink":"/docs/infrasec/adrs/tests_in_terraform","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/adrs/0001-tests_in_terraform.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"practices","previous":{"title":"ADRs","permalink":"/docs/infrasec/adrs/"},"next":{"title":"Guidance for Pinning Terraform Versions","permalink":"/docs/infrasec/adrs/pinning-terraform-version"}}');var o=t(4848),r=t(8453);const i={},a="Remove tests from our open-source Terraform modules",d={},l=[{value:"Context and Problem Statement",id:"context-and-problem-statement",level:2},{value:"Decision Drivers",id:"decision-drivers",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Validation",id:"validation",level:2},{value:"Pros and Cons of the Options",id:"pros-and-cons-of-the-options",level:2},{value:"Do nothing",id:"do-nothing",level:3},{value:"Assign dedicated staff to maintain CI in the modules",id:"assign-dedicated-staff-to-maintain-ci-in-the-modules",level:3},{value:"Remove branch protection requiring tests pass before merging",id:"remove-branch-protection-requiring-tests-pass-before-merging",level:3},{value:"Remove tests from the Terraform modules",id:"remove-tests-from-the-terraform-modules",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"remove-tests-from-our-open-source-terraform-modules",children:"Remove tests from our open-source Terraform modules"})}),"\n",(0,o.jsx)(n.h2,{id:"context-and-problem-statement",children:"Context and Problem Statement"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://terratest.gruntwork.io/",children:"Terratest"})," is a Go library that provides\npatterns and helper functions for testing infrastructure, including Terraform\ncode. Truss has ",(0,o.jsx)(n.a,{href:"https://github.com/orgs/trussworks/repositories?q=terraform+in%3Aname&type=all",children:"open source Terraform modules"}),", and we have added\ntests for many of them using Terratest. Following Truss' understanding of best\npractices for production code, we block updates to the modules pending\nsuccessful Terratests in CI."]}),"\n",(0,o.jsxs)(n.p,{children:["There is no Truss policy that assigns responsibility for maintaining the code\nrepositories for these modules. In practice, it informally falls to InfraSec\nReserve. Importantly, there is no SLA for maintenance of our Terraform modules.\nBecause the Reserve is unevenly staffed across time, CI systems in these\nrepositories have become stale. Dependencies and tests themselves grow out of\ndate, and we have no monitoring or health checks that alert us to build\nfailures so they can be actioned. In turn, neglected and broken CI pipelines\nblock automated dependency updates from auto-merging, so these updates languish\nas well. (",(0,o.jsx)(n.a,{href:"https://github.com/trussworks/terraform-module-template/pull/96",children:"Example"}),")"]}),"\n",(0,o.jsxs)(n.p,{children:["We remain committed to the value of, and need for, tests in software\nengineering overall. However, the value Truss has realized from our experiment\nwith Terratests in these modules is limited. Typically, the tests create a\nresource in the ",(0,o.jsx)(n.a,{href:"https://github.com/trussworks/legendary-waddle/tree/main/trussworks-ci",children:(0,o.jsx)(n.code,{children:"trussworks-ci"})})," account and pass the build if\na ",(0,o.jsx)(n.code,{children:"terraform apply"})," was successful. Such tests are not sufficient basis for\nconfidence that functionality has not regressed, or that the module will do\nanything useful at all in a practical environment: rather, Truss engineers rely\non Terraform plans to evaluate the impact of changes to a module and report\nbugs if they observe anything unexpected. This casts further doubt on the value\nof the tests."]}),"\n",(0,o.jsx)(n.h2,{id:"decision-drivers",children:"Decision Drivers"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Broken tests should not routinely block automation from applying dependency\nupdates."}),"\n",(0,o.jsxs)(n.li,{children:["Tests should ",(0,o.jsx)(n.em,{children:"reduce"})," the ongoing work required to maintain our Terraform\nmodules. If they increase it, they are bad tests."]}),"\n",(0,o.jsx)(n.li,{children:"The success or failure of a test suite should be a reliable signal that the\ncode is healthy and new changes have not introduced bugs or regressions in\nfunctionality. If they aren't, they are bad tests."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"considered-options",children:"Considered Options"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Do nothing."}),"\n",(0,o.jsx)(n.li,{children:"Assign dedicated staff to maintain CI in the modules."}),"\n",(0,o.jsx)(n.li,{children:"Remove branch protection requiring tests pass before merging."}),"\n",(0,o.jsx)(n.li,{children:"Remove tests from the Terraform modules."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"decision-outcome",children:"Decision Outcome"}),"\n",(0,o.jsx)(n.p,{children:"Chosen option: Remove the tests from the Terraform modules."}),"\n",(0,o.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,o.jsx)(n.p,{children:"Terraform modules conform to this ADR if they do not have tests for Terraform\ncode."}),"\n",(0,o.jsx)(n.h2,{id:"pros-and-cons-of-the-options",children:"Pros and Cons of the Options"}),"\n",(0,o.jsx)(n.h3,{id:"do-nothing",children:"Do nothing"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Good, because it's the least work in the short term."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because none of the decision drivers are achieved."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"assign-dedicated-staff-to-maintain-ci-in-the-modules",children:"Assign dedicated staff to maintain CI in the modules"}),"\n",(0,o.jsx)(n.p,{children:"Maintenance of any production software is an on-going process. Having engineers\nassigned to doing the non-billable work maintaining our modules would allow us\nto keep the tests working and even expand them to make them more informative\nand provide clearer signal."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Good, because having good tests is better than not having tests."}),"\n",(0,o.jsx)(n.li,{children:"Good, because dedicated engineers could expand the test suites to make them\nmore useful."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because non-billable engineers are expensive, and only Truss leadership\ncan create a new role for it."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because without an understanding of how these modules are adopted, we\nwon't know whether or to what extent the effort is a benefit to Truss'\nclients."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"remove-branch-protection-requiring-tests-pass-before-merging",children:"Remove branch protection requiring tests pass before merging"}),"\n",(0,o.jsx)(n.p,{children:"Branch protection rules are separate from CI workflows in Github Actions. We\ncan configure the modules' repositories to continue running the tests, while\nallowing PRs to merge even if the tests fail."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Good, because Renovatebot or any other dependency automation we may employ\nwill not be blocked by stale tests."}),"\n",(0,o.jsx)(n.li,{children:"Good, because we won't have to delete the tests from the codebase."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because it does not meet the critical decision driver that tests should\nprovide a reliable signal. Because this option does not address the lack of\nengineering time for maintaining the tests, they would be ignored and rot\nfurther."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"remove-tests-from-the-terraform-modules",children:"Remove tests from the Terraform modules"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Good, because Renovatebot or any other dependency automation we may employ\nwill not be blocked by stale tests."}),"\n",(0,o.jsx)(n.li,{children:"Good, because it reduces noise from unreliable and uninformative tests."}),"\n",(0,o.jsx)(n.li,{children:"Good, because it brings the long-term effort required to maintain the modules\ninto line with the resources available."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because InfraSec Reserve will have to a lot of near-term work to remove\nthe tests."}),"\n",(0,o.jsx)(n.li,{children:"Bad, because we'll have to delete all the tests, and we like tests."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);