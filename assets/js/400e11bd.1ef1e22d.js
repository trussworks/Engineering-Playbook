"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[994],{5161:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>a,metadata:()=>t,toc:()=>m});const t=JSON.parse('{"id":"infrasec/terraform/terraform-import","title":"terraform import","description":"If you\'re adding Terraform to an environment where Terraform was not being","source":"@site/docs/infrasec/terraform/terraform-import.md","sourceDirName":"infrasec/terraform","slug":"/infrasec/terraform/terraform-import","permalink":"/docs/infrasec/terraform/terraform-import","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/terraform/terraform-import.md","tags":[],"version":"current","frontMatter":{},"sidebar":"practices","previous":{"title":"Naming conventions for Terraform","permalink":"/docs/infrasec/terraform/naming"},"next":{"title":"terraform state mv in Delicate Circumstances","permalink":"/docs/infrasec/terraform/terraform-state-mv"}}');var o=n(4848),s=n(8453);const a={},i="terraform import",c={},m=[{value:"A Word of Warning",id:"a-word-of-warning",level:2},{value:"Importing a resource as a raw Terraform resource",id:"importing-a-resource-as-a-raw-terraform-resource",level:2},{value:"Importing a resource as a component of a module",id:"importing-a-resource-as-a-component-of-a-module",level:2},{value:"Resources",id:"resources",level:2}];function d(e){const r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"terraform-import",children:(0,o.jsx)(r.code,{children:"terraform import"})})}),"\n",(0,o.jsxs)(r.p,{children:["If you're adding Terraform to an environment where Terraform was not being\nused, often you'll need to import existing resources into your Terraform\ndeployment so they can be managed with your other Terraformed resources.\nThe ",(0,o.jsx)(r.a,{href:"https://www.terraform.io/docs/import/index.html",children:"Terraform documentation"}),"\ndescribes how to do this and will give you a detailed breakdown of the\ncommand; this page provides a tangible example and tries to explain potential\npitfalls."]}),"\n",(0,o.jsx)(r.h2,{id:"a-word-of-warning",children:"A Word of Warning"}),"\n",(0,o.jsxs)(r.p,{children:["Remember when importing resources that you may need to import multiple\nresources to get everything that might seem like a single component in\nAWS. If you import an S3 bucket, that does ",(0,o.jsx)(r.em,{children:"not"})," import its analytics\nconfiguration, for instance, which is a completely different Terraform\nresource."]}),"\n",(0,o.jsx)(r.h2,{id:"importing-a-resource-as-a-raw-terraform-resource",children:"Importing a resource as a raw Terraform resource"}),"\n",(0,o.jsxs)(r.p,{children:["In this case, we're going to be importing an existing S3 bucket from AWS\nnamed ",(0,o.jsx)(r.code,{children:"my-s3-bucket"})," into our Terraform deployment as a Terraform\n",(0,o.jsx)(r.code,{children:"aws_s3_bucket"})," resource."]}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsx)(r.p,{children:"Write the Terraform code that will describe this resource in your\ninfrastructure. For our example, we would add this to our Terraform\ninfrastructure:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'resource "aws_s3_bucket" "my_s3_bucket" {\n  bucket = "my-s3-bucket"\n\n  tags = {\n    Name        = "My Bucket"\n    Environment = "Dev"\n  }\n}\n'})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["Run ",(0,o.jsx)(r.code,{children:"terraform import"})," in the namespace that file is in to import the\nresource. The ",(0,o.jsx)(r.code,{children:"import"})," command requires two arguments; the ",(0,o.jsx)(r.code,{children:"ADDRESS"})," and\nthe ",(0,o.jsx)(r.code,{children:"ID"}),". The ",(0,o.jsx)(r.code,{children:"ADDRESS"})," is the terraform resource we just described, so\n",(0,o.jsx)(r.code,{children:"aws_s3_bucket.my_s3_bucket"})," in the example above. The ",(0,o.jsx)(r.code,{children:"ID"})," depends on\nthe resource we're importing; you can find out at the bottom of the\ndocumentation for that resource in the Terraform docs. You can see in the\ndocs for\n",(0,o.jsx)(r.a,{href:"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket#import",children:(0,o.jsx)(r.code,{children:"aws_s3_bucket"})}),"\nthat for that resource, it's just the bucket name. So we would run this\ncommand:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'$ terraform import aws_s3_bucket.my_s3_bucket my-s3-bucket\naws_s3_bucket.my_s3_bucket: Importing from ID "my-s3-bucket"...\naws_s3_bucket.my_s3_bucket: Import prepared!\n  Prepared aws_s3_bucket for import\naws_s3_bucket.my_s3_bucket: Refreshing state... [id=my-s3-bucket]\n\nImport successful!\n\nThe resources that were imported are shown above. These resources are now in\nyour Terraform state and will henceforth be managed by Terraform.\n\nReleasing state lock. This may take a few moments...\n'})}),"\n"]}),"\n",(0,o.jsxs)(r.li,{children:["\n",(0,o.jsxs)(r.p,{children:["Our resource has been imported. Now if we run a ",(0,o.jsx)(r.code,{children:"terraform plan"}),", we\ncan see that Terraform has added the bucket to the state:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:'$ terraform plan\n\n...\n\nAn execution plan has been generated and is shown below.\nResource actions are indicated with the following symbols:\n  ~ update in-place\n\nTerraform will perform the following actions:\n\n  # aws_s3_bucket.my_s3_bucket will be updated in-place\n  ~ resource "aws_s3_bucket" "my_s3_bucket" {\n      + acl                         = "private"\n        arn                         = "arn:aws:s3:::my-s3-bucket"\n        bucket                      = "my-s3-bucket"\n        bucket_domain_name          = "my-s3-bucket.s3.amazonaws.com"\n        bucket_regional_domain_name = "my-s3-bucket.s3.us-west-2.amazonaws.com"\n      + force_destroy               = false\n        hosted_zone_id              = "Z3BJ5K6RIION3M"\n        id                          = "my-s3-bucket"\n        region                      = "us-west-2"\n        request_payer               = "BucketOwner"\n      ~ tags                        = {\n          + "Environment" = "Dev"\n            "Name"        = "My Bucket"\n        }\n\n        versioning {\n            enabled    = false\n            mfa_delete = false\n        }\n    }\n\nPlan: 0 to add, 1 to change, 0 to destroy.\n'})}),"\n",(0,o.jsxs)(r.p,{children:["Note that it is only changing an existing resource. Also note that the\n",(0,o.jsx)(r.code,{children:"Name"})," tag already existed on the existing bucket, so that will not be\nchanged, but that we're adding the ",(0,o.jsx)(r.code,{children:"Environment"})," tag to the bucket. To\nmake these changes, we'd run a ",(0,o.jsx)(r.code,{children:"terraform apply"})," and then we should have\na clean plan after that. We can then use this resource as if it had\nalways been in Terraform."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"importing-a-resource-as-a-component-of-a-module",children:"Importing a resource as a component of a module"}),"\n",(0,o.jsxs)(r.p,{children:["It's also possible to import an existing resource as a component of a\nTerraform module, we just have to change our Terraform code and the\n",(0,o.jsx)(r.code,{children:"ADDRESS"})," component of the ",(0,o.jsx)(r.code,{children:"terraform import"})," command. So if we wanted\nto use the Truss ",(0,o.jsx)(r.code,{children:"terraform-aws-s3-private-bucket"})," module for our bucket\ninstead of the raw S3 resource, we'd have Terraform code like this:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'module "my_s3_bucket" {\n  source         = "trussworks/s3-private-bucket/aws"\n  bucket         = "my-s3-bucket"\n  logging_bucket = "my-logging-bucket"\n\n  tags = {\n    Name        = "My Bucket"\n    Environment = "Dev"\n  }\n}\n'})}),"\n",(0,o.jsx)(r.p,{children:"Then we would run this command:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-bash",children:"$ terraform import module.my_s3_bucket.aws_s3_bucket.private_bucket my-s3-bucket\n"})}),"\n",(0,o.jsxs)(r.p,{children:["We're getting that ",(0,o.jsx)(r.code,{children:"ADDRESS"})," by looking at the code of the module and\nseeing where it is actually defining that resource that we want to import;\nin this case, it's the\n",(0,o.jsx)(r.a,{href:"https://github.com/trussworks/terraform-aws-s3-private-bucket/blob/master/main.tf",children:(0,o.jsx)(r.code,{children:"main.tf"})}),"\nfile, on this line:"]}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-hcl",children:'resource "aws_s3_bucket" "private_bucket" {\n  bucket        = local.bucket_id\n  acl           = "private"\n\n...\n'})}),"\n",(0,o.jsx)(r.h2,{id:"resources",children:"Resources"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.a,{href:"https://www.terraform.io/docs/import/index.html",children:"Importing Infrastructure"})}),"\n",(0,o.jsx)(r.li,{children:(0,o.jsx)(r.a,{href:"https://spacelift.io/blog/importing-exisiting-infrastructure-into-terraform",children:"Importing Existing Infrastructure into Terraform \u2013 Step by Step"})}),"\n"]})]})}function l(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>i});var t=n(6540);const o={},s=t.createContext(o);function a(e){const r=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);