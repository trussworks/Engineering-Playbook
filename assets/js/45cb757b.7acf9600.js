"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[3622],{1444:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>y,frontMatter:()=>a,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"infrasec/tutorials/yubikey-configuration","title":"YubiKey Configuration Guide","description":"Introduction","source":"@site/docs/infrasec/tutorials/yubikey-configuration.mdx","sourceDirName":"infrasec/tutorials","slug":"/infrasec/tutorials/yubikey-configuration","permalink":"/docs/infrasec/tutorials/yubikey-configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/tutorials/yubikey-configuration.mdx","tags":[],"version":"current","frontMatter":{"title":"YubiKey Configuration Guide"},"sidebar":"practices","previous":{"title":"Deploying your first AWS Lambda Function with Go and Terraform","permalink":"/docs/infrasec/tutorials/your_first_lambda_function"},"next":{"title":"Single Sign-On","permalink":"/docs/infrasec/tutorials/yubikey-sso"}}');var s=i(4848),r=i(8453),o=i(1470),l=i(9365);const a={title:"YubiKey Configuration Guide"},c="YubiKey Configuration Guide",d={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Purchasing and Distribution",id:"purchasing-and-distribution",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Hardware Requirements",id:"hardware-requirements",level:3},{value:"Software Requirements",id:"software-requirements",level:3},{value:"Configuring Your Environment",id:"configuring-your-environment",level:2},{value:"Using pinentry (optional)",id:"using-pinentry-optional",level:3},{value:"Verifying Your YubiKey",id:"verifying-your-yubikey",level:2},{value:"Setting the YubiKey User and Admin PIN codes",id:"setting-the-yubikey-user-and-admin-pin-codes",level:2},{value:"Key Generation",id:"key-generation",level:2},{value:"Generating a GPG Private Key",id:"generating-a-gpg-private-key",level:3},{value:"Add a (S) signing subkey",id:"add-a-s-signing-subkey",level:3},{value:"Add an (A) authentication subkey",id:"add-an-a-authentication-subkey",level:3},{value:"Check Your Keys",id:"check-your-keys",level:2},{value:"Deleting a secret key",id:"deleting-a-secret-key",level:2},{value:"Creating Backups",id:"creating-backups",level:2},{value:"Create a backup of your secret keys (optional)",id:"create-a-backup-of-your-secret-keys-optional",level:3},{value:"Create a backup of your public key (optional)",id:"create-a-backup-of-your-public-key-optional",level:3},{value:"Create a revocation certificate (optional)",id:"create-a-revocation-certificate-optional",level:3},{value:"Configuring the YubiKey",id:"configuring-the-yubikey",level:2},{value:"Importing the keys to your YubiKey",id:"importing-the-keys-to-your-yubikey",level:3},{value:"Adding Additional Email Addresses",id:"adding-additional-email-addresses",level:2},{value:"UIDs and the primary key",id:"uids-and-the-primary-key",level:3},{value:"Configuring SSH",id:"configuring-ssh",level:2},{value:"Configuring git commit Signing",id:"configuring-git-commit-signing",level:2},{value:"Configuring Github",id:"configuring-github",level:2},{value:"Using Github Desktop",id:"using-github-desktop",level:3},{value:"Verifying your configuration",id:"verifying-your-configuration",level:2},{value:"Deleting local secret key material",id:"deleting-local-secret-key-material",level:3},{value:"Subkey stubs",id:"subkey-stubs",level:3},{value:"Using The YubiKey",id:"using-the-yubikey",level:2},{value:"Signing git commits",id:"signing-git-commits",level:3},{value:"Enabling touch-only mode (optional)",id:"enabling-touch-only-mode-optional",level:3},{value:"Disabling OTP (One Time Password)",id:"disabling-otp-one-time-password",level:3},{value:"GitHub Apps",id:"github-apps",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function u(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"yubikey-configuration-guide",children:"YubiKey Configuration Guide"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"The YubiKey is a hardware authentication device manufactured by Yubico that supports one-time passwords, public-key encryption and authentication, and the Universal 2nd Factor (U2F) and FIDO2 protocols developed by the FIDO Alliance. It allows users to securely log into their accounts by emitting one-time passwords or using a FIDO-based public/private key pair generated by the device. YubiKey also allows for storing static passwords for use at sites that do not support one-time passwords. Some password managers, including 1Password, support YubiKey."}),"\n",(0,s.jsx)(n.p,{children:"The YubiKey will allow us to sign our GitHub commits, which may be required by some contracts."}),"\n",(0,s.jsx)(n.p,{children:"If you have problems or questions during the configuration process, check in with #infrasec-chat on the Truss Slack."}),"\n",(0,s.jsx)(n.p,{children:"PIN codes and passphrases may be cached for a short duration at any point during the configuration process. You may not always be prompted to enter these."}),"\n",(0,s.jsx)(n.h2,{id:"purchasing-and-distribution",children:"Purchasing and Distribution"}),"\n",(0,s.jsxs)(n.p,{children:["It is currently recommended that distributed Trussels purchase their YubiKey directly from either Amazon or ",(0,s.jsx)(n.a,{href:"https://www.yubico.com/store/",children:"Yubico"}),". The SF office may opt to purchase some YubiKeys in bulk for local Trussels, but this has not been decided yet. Bulk purchasing of YubiKeys yields a savings of $2.40 per $60 YubiKey."]}),"\n",(0,s.jsxs)(n.p,{children:["If ordering a YubiKey for a project, check with your project on how to categorize the expense in Expensify. Otherwise, use the ",(0,s.jsx)(n.code,{children:"Computer Equipment"})," category."]}),"\n",(0,s.jsxs)(n.p,{children:["You should purchase a YubiKey 5 Series (",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Yubico-YubiKey-Factor-Authentication-Security/dp/B07HBCTYP1/",children:"5C"}),", ",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Yubico-YubiKey-Factor-Authentication-Security/dp/B07HBTBJ5S/",children:"5C Nano"}),", ",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Yubico-YubiKey-5Ci-Authentication-Connectors/dp/B07WGJ1DNJ/",children:"5ci"}),")"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"5Ci"})," supports both USB C and Lighting ports, which is good if you have an iPhone."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"5C"})," and ",(0,s.jsx)(n.strong,{children:"5C Nano"})," only support USB C and come in different form factors."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you have a YubiKey Series 4 or a YubiKey 5 NEO, you ",(0,s.jsx)(n.em,{children:"should"})," upgrade to a 5 Series, unless you have a specific need for the older model. The YubiKey 5 series will provide stronger security and can support larger encryption keys."]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.h3,{id:"hardware-requirements",children:"Hardware Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["YubiKey 5 Series (",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Yubico-YubiKey-Factor-Authentication-Security/dp/B07HBCTYP1/",children:"5C"}),", ",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Yubico-YubiKey-Factor-Authentication-Security/dp/B07HBTBJ5S/",children:"5C Nano"}),", ",(0,s.jsx)(n.a,{href:"https://www.amazon.com/Yubico-YubiKey-5Ci-Authentication-Connectors/dp/B07WGJ1DNJ/",children:"5ci"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"YubiKey 4 Series and 5 NEO are acceptable, but not preferred. Keys are limited to 2048 bits"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"FIPS based YubiKeys ship with security vulnerabilities. Do not purchase a FIPS based YubiKey for work performed at Truss. FIPS YubiKey models are specifically called YubiKey FIPS and not part of the 5 series listed above."})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://www.yubico.com/support/security-advisories/ysa-2019-02/",children:"Yubico Security Advisory"})," about FIPS keys"]}),"\n",(0,s.jsx)(n.h3,{id:"software-requirements",children:"Software Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["brew","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"ykman"}),"\n",(0,s.jsx)(n.li,{children:"ykpers"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["brew cask","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"gpg-suite-no-mail"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Configure your environment with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"brew install ykman ykpers\nbrew install --cask gpg-suite-no-mail\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If xcode is not up to date, you will be prompted to install it with: ",(0,s.jsx)(n.code,{children:"xcode-select --install"})]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-your-environment",children:"Configuring Your Environment"}),"\n",(0,s.jsx)(n.p,{children:"Enable SSH support by default when launching gpg-agent:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"echo enable-ssh-support >> ~/.gnupg/gpg-agent.conf\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Add the following to your shell profile ",(0,s.jsx)(n.code,{children:".bashrc"}),", ",(0,s.jsx)(n.code,{children:".zshrc"}),", etc."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# allow GPG to sign in the terminal\nGPG_TTY=$(tty)\nexport GPG_TTY\n\n# Expose the SSH agent to the GPG agent.\nSSH_AUTH_SOCK="${HOME}/.gnupg/S.gpg-agent.ssh"\nexport SSH_AUTH_SOCK\n\n# Define a function to manually reset the GPG and SSH agent.\nyubikey-init () {\n    if pgrep gpg-agent > /dev/null; then killall gpg-agent; fi\n    if pgrep ssh-agent > /dev/null; then killall ssh-agent; fi\n    gpg --card-status all &> /dev/null\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"yubikey-init"})," to manually reset the GPG agent whenever you need to, such as after re-inserting\nyour YubiKey into your computer."]}),"\n",(0,s.jsxs)(n.p,{children:["To configure the GPG agent to use your YubiKey upon logging into the system, create a new file at\n",(0,s.jsx)(n.code,{children:"~/Library/LaunchAgents/gpg-agent.plist"})," with the following contents (",(0,s.jsxs)(n.em,{children:["Note: this assumes you are\nusing GPG Suite, which can be installed using ",(0,s.jsx)(n.code,{children:"brew cask install gpg-suite-no-mail"})]}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n<plist version="1.0">\n<dict>\n    <key>Label</key>\n    <string>gpg-agent</string>\n    <key>ProgramArguments</key>\n    <array>\n        <string>/bin/bash</string>\n        <string>-c</string>\n        <string>\n            if pgrep gpg-agent > /dev/null; then killall gpg-agent; fi\n            if pgrep ssh-agent > /dev/null; then killall ssh-agent; fi\n            gpg --card-status all &> /dev/null\n        </string>\n    </array>\n    <key>RunAtLoad</key>\n    <true/>\n</dict>\n</plist>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Regarding the use of ",(0,s.jsx)(n.code,{children:"gpg --card-status all &> /dev/null"}),", this seems to be the only reliable\napproach we have found to get gpg-agent to use YubiKey when running Big Sur. This command starts\ngpg-agent as a daemon if it is not currently running, so it is an implicit way of starting\ngpg-agent. Otherwise, using something like ",(0,s.jsx)(n.code,{children:"gpg-agent --daemon"})," would work equally as well."]}),"\n",(0,s.jsx)(n.h3,{id:"using-pinentry-optional",children:"Using pinentry (optional)"}),"\n",(0,s.jsx)(n.p,{children:"Instead of prompting you in a terminal, you can have gpg-agent use an\nexternal program.  This might be useful if you want to use your editor\nfor commits."}),"\n",(0,s.jsxs)(o.A,{groupID:"pinentry-mac",children:[(0,s.jsxs)(l.A,{value:"intel",label:"Intel Based Mac",children:[(0,s.jsxs)(n.p,{children:["Your homebrew path may be different for pinentry-mac than below. You can confirm it with ",(0,s.jsx)(n.code,{children:"which pinentry-mac"})]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"brew install pinentry-mac\necho 'pinentry-program /usr/local/bin/pinentry-mac' >> \\\n    ~/.gnupg/gpg-agent.conf\ngpgconf --kill gpg-agent\ngpg --card-status all &> /dev/null\n"})})]}),(0,s.jsxs)(l.A,{value:"m1-mac",label:"M1 Based Mac",children:[(0,s.jsxs)(n.p,{children:["If you are on an ",(0,s.jsx)(n.strong,{children:"M1 based Macbook"})," then your homebrew path will likely be different for pinentry-mac. You can confirm it with ",(0,s.jsx)(n.code,{children:"which pinentry-mac"})]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"brew install pinentry-mac\necho 'pinentry-program /opt/homebrew/bin/pinentry-mac' >> \\\n    ~/.gnupg/gpg-agent.conf\ngpgconf --kill gpg-agent\ngpg --card-status all &> /dev/null\n"})})]})]}),"\n",(0,s.jsxs)(n.p,{children:["If you use this, you do not need to set ",(0,s.jsx)(n.code,{children:"GPG_TTY"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"verifying-your-yubikey",children:"Verifying Your YubiKey"}),"\n",(0,s.jsxs)(n.p,{children:["To verify a YubiKey is genuine, open a ",(0,s.jsx)(n.a,{href:"https://support.yubico.com/support/solutions/articles/15000009591-how-to-confirm-your-yubico-device-is-genuine-with-u2f",children:"browser with U2F support"})," to ",(0,s.jsx)(n.a,{href:"https://www.yubico.com/genuine/",children:"https://www.yubico.com/genuine/"}),". (Chrome, FireFox and Safari work). Insert a Yubico device, and select Verify Device to begin the process. Touch the YubiKey when prompted, and if asked, allow it to see the make and model of the device. If you see Verification complete, the device is authentic."]}),"\n",(0,s.jsxs)(n.p,{children:["This website verifies the YubiKey's device attestation certificates signed by a set of Yubico CAs, and helps mitigate ",(0,s.jsx)(n.a,{href:"https://media.defcon.org/DEF%20CON%2025/DEF%20CON%2025%20presentations/DEF%20CON%2025%20-%20r00killah-and-securelyfitz-Secure-Tokin-and-Doobiekeys.pdf",children:"supply chain attacks"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"setting-the-yubikey-user-and-admin-pin-codes",children:"Setting the YubiKey User and Admin PIN codes"}),"\n",(0,s.jsxs)(n.p,{children:["The YubiKey ships with a default User PIN of ",(0,s.jsx)(n.code,{children:"123456"})," and a default Admin PIN of ",(0,s.jsx)(n.code,{children:"12345678"}),". For security purposes, these PIN codes must be changed before use."]}),"\n",(0,s.jsx)(n.p,{children:"The User PIN is the PIN that will be used on a daily basis when signing commits or authenticating. The Admin PIN is used to make changes to the YubiKey itself, such as when enabling or disabling touch-mode."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Insert your YubiKey into the USB port."}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"gpg --card-edit"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"admin"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"passwd"})]}),"\n",(0,s.jsxs)(n.li,{children:["To change the Admin PIN enter: ",(0,s.jsx)(n.code,{children:"3"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the default PIN of ",(0,s.jsx)(n.code,{children:"12345678"})]}),"\n",(0,s.jsx)(n.li,{children:"Enter your new 8 digit Admin PIN, add it to 1Password, and confirm it."}),"\n",(0,s.jsxs)(n.li,{children:["To change the User PIN enter: ",(0,s.jsx)(n.code,{children:"1"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the default PIN of ",(0,s.jsx)(n.code,{children:"123456"})]}),"\n",(0,s.jsx)(n.li,{children:"Enter your new 6 digit User PIN, add it to 1Password, and confirm it."}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"q"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"name"})]}),"\n",(0,s.jsx)(n.li,{children:"Enter your surname and given name (these should match the name provided when you generate your certificate)"}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command ",(0,s.jsx)(n.code,{children:"q"})," to exit the admin menu"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If at any point you make a mistake and need to reset your YubiKey PIN(s), you can do so with the command: ",(0,s.jsx)(n.code,{children:"ykman openpgp reset"})]}),"\n",(0,s.jsx)(n.h2,{id:"key-generation",children:"Key Generation"}),"\n",(0,s.jsx)(n.h3,{id:"generating-a-gpg-private-key",children:"Generating a GPG Private Key"}),"\n",(0,s.jsx)(n.p,{children:"This will generate the secret key."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --expert --full-gen-key"})]}),"\n",(0,s.jsx)(n.li,{children:'When prompted to specify the key type, enter 1 (for "RSA and RSA") and press Enter'}),"\n",(0,s.jsxs)(n.li,{children:["Specify the size of key you want to generate. This key size will also apply to subkey size. Do one of the following:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"For a YubiKey 4 series, enter 2048 and press Enter"}),"\n",(0,s.jsx)(n.li,{children:"For a YubiKey 5 series, enter 4096 and press Enter"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Specify an indefinite expiration date of the key by pressing press Enter. Verify the expiration date when prompted"}),"\n",(0,s.jsx)(n.li,{children:"Now you will enter your user information. Enter your Real Name and press Enter. Be sure to enter both your first and last name"}),"\n",(0,s.jsxs)(n.li,{children:["Enter your ",(0,s.jsx)(n.code,{children:"@truss.works"})," Email Address and press Enter. If you do not perform commits with your @truss.works email address, we\u2019ll add your GitHub email address to the key in a later step."]}),"\n",(0,s.jsx)(n.li,{children:"If desired, enter a Comment about this key (e.g., \u201cwork\u201d), and press Enter. (To leave the comment blank, just press Enter)"}),"\n",(0,s.jsx)(n.li,{children:"Review the information you entered, make any changes if necessary. If all information is correct, enter O (for Okay) and press Enter"}),"\n",(0,s.jsxs)(n.li,{children:["A dialog box is displayed so you can enter the passphrase for your key. While the key is being generated, move your mouse around or type on the keyboard to gain enough entropy. When the key has been generated, you will see several messages displayed. Make a note of the key ID, that is displayed in the message such as ",(0,s.jsx)(n.code,{children:"gpg: key 1234ABC marked as ultimately trusted"}),". The key ID in this case is 1234ABC and you will need this key ID to perform other operations."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If at any point you forget the key ID, enter ",(0,s.jsx)(n.code,{children:"gpg --list-signatures"})," to display it. If the key ID isn't displayed during the previous command it will be when you run ",(0,s.jsx)(n.code,{children:"gpg --list-signatures"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"It\u2019s time to add the subkeys. Some of these may already be created. You can check what\u2019s been created by checking your keys."}),"\n",(0,s.jsx)(n.h3,{id:"add-a-s-signing-subkey",children:"Add a (S) signing subkey"}),"\n",(0,s.jsx)(n.p,{children:"This will be used for git commit and tag signing."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --expert --edit-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"addkey"})]}),"\n",(0,s.jsx)(n.li,{children:"You are prompted to specify the type of key. Enter 4 for RSA (sign only)"}),"\n",(0,s.jsxs)(n.li,{children:["Specify the size of the key that you want to generate. Do one of the following:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"For a YubiKey 4 series, enter 2048 and press Enter"}),"\n",(0,s.jsx)(n.li,{children:"For a YubiKey 5 series, enter 4096 and press Enter"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Specify the expiration of the authentication key (this should be the same expiration as the key). Unless you have a specific need, this should be set to indefinite"}),"\n",(0,s.jsxs)(n.li,{children:["When prompted to save your changes, enter y (yes)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If prompted to replace the existing key, select no."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Enter the passphrase for the key. Note that this is the passphrase, and not the User PIN or Admin PIN"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"add-an-a-authentication-subkey",children:"Add an (A) authentication subkey"}),"\n",(0,s.jsx)(n.p,{children:"This subkey will be used to pull private git repos via SSH and may be used to authenticate to any SSH host."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --expert --edit-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"addkey"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"You are prompted to specify the type of key. Enter 8 for RSA"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"To add an authentication key, toggle all options until Authenticate is the only selection, and then Q if you are finished."}),"\n",(0,s.jsxs)(n.p,{children:["This is interface has a unique design where you need to toggle things on and off to get the desired result.\nThe default state shows ",(0,s.jsx)(n.strong,{children:"Sign Encrypt"})," active."]}),"\n",(0,s.jsx)("img",{src:"images/yubikey-sign-encrypt.png",alt:"default state",width:"400"}),"\n",(0,s.jsxs)(n.p,{children:["Enter ",(0,s.jsx)(n.code,{children:"A"})," to enable ",(0,s.jsx)(n.strong,{children:"Authenticate"}),". Enter ",(0,s.jsx)(n.code,{children:"E"})," and ",(0,s.jsx)(n.code,{children:"S"})," (separately) to disable ",(0,s.jsx)(n.strong,{children:"Sign"})," and ",(0,s.jsx)(n.strong,{children:"Encrypt"}),"."]}),"\n",(0,s.jsx)("img",{src:"images/yubikey-select-authenticate.png",alt:"authenticate",width:"400"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Hit ",(0,s.jsx)(n.code,{children:"Q"})," to finish."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Specify the size of the key that you want to generate. Do one of the following:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"For a YubiKey 4 series, enter 2048 and press Enter"}),"\n",(0,s.jsx)(n.li,{children:"For a YubiKey 5 series, enter 4096 and press Enter"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Specify the expiration of the authentication key (this should be the same expiration as the key). Unless you have a specific need, this should be set to indefinite"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"When prompted to save your changes, enter y (yes)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"If prompted to replace the existing key, select no."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Enter the passphrase for the key. Note that this is the passphrase, and not the User PIN or Admin PIN"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"check-your-keys",children:"Check Your Keys"}),"\n",(0,s.jsxs)(n.p,{children:["After adding the subkeys, enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --expert --edit-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsxs)(n.p,{children:["The optimal output should look similar to this, showing an individual subkey for ",(0,s.jsx)(n.strong,{children:"E (Encrypt)"}),", ",(0,s.jsx)(n.strong,{children:"A (Authenticate)"}),", and ",(0,s.jsx)(n.strong,{children:"S (Sign)"})," in the YubiKey keychain."]}),"\n",(0,s.jsx)("img",{src:"images/yubikey-check-keys.png",alt:"keycheck",width:"500"}),"\n",(0,s.jsx)(n.h2,{id:"deleting-a-secret-key",children:"Deleting a secret key"}),"\n",(0,s.jsx)(n.p,{children:"If you add one too many keys, you can delete them."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --edit-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsxs)(n.li,{children:["Enter ",(0,s.jsx)(n.code,{children:"key 1"})," (This will select the first key but you can select any key)"]}),"\n",(0,s.jsxs)(n.li,{children:["After pressing enter an ",(0,s.jsx)(n.em,{children:"asterisk"})," will appear next to that key"]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"delkey"})]}),"\n",(0,s.jsx)(n.li,{children:"It will then ask if you want to delete the key. Select yes"}),"\n",(0,s.jsx)(n.li,{children:"Enter your passphrase"}),"\n",(0,s.jsx)(n.li,{children:"Verify the key is deleted"}),"\n",(0,s.jsx)(n.li,{children:"Repeat if multiple keys need to be deleted"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Note that if you have not imported the keys to your YubiKey yet then your output will not include those card-no details."})}),"\n",(0,s.jsx)(n.h2,{id:"creating-backups",children:"Creating Backups"}),"\n",(0,s.jsx)(n.p,{children:"These steps are optional and will help to configure a new YubiKey should yours become lost or damaged. While you could start from scratch, and should in some cases, this will provide the quickest path to recovery."}),"\n",(0,s.jsx)(n.h3,{id:"create-a-backup-of-your-secret-keys-optional",children:"Create a backup of your secret keys (optional)"}),"\n",(0,s.jsx)(n.p,{children:"This will create a backup of the secret key and subkeys."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Insert the YubiKey into the USB port"}),"\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --export-secret-key --armor 1234ABC > /path/to/secret.key"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --export-secret-subkeys --armor 1234ABC > /path/to/secret.sub.key"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsx)(n.li,{children:"Store these files in 1Password and delete them from your system."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"create-a-backup-of-your-public-key-optional",children:"Create a backup of your public key (optional)"}),"\n",(0,s.jsx)(n.p,{children:"Save the public key in 1Password for reference. This is not secret material, but it can be helpful to have it saved alongside the secret key material. You can export it using the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"gpg --export --armor 1234ABC > public.key\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-a-revocation-certificate-optional",children:"Create a revocation certificate (optional)"}),"\n",(0,s.jsx)(n.p,{children:"This will allow you to revoke the key should your secret key becomes lost or compromised. This step is not required in our current use case because we\u2019re not uploading our certificates to a public keyserver. This may be required for future use at some point, so we\u2019ll leave this in place for the time being."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"gpg --gen-revoke 1234ABC > 1234ABC-revoke-cert.asc"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"Y"})]}),"\n",(0,s.jsx)(n.li,{children:"Select a reason for revocation. The reason really doesn\u2019t matter for our use case. I usually select 3 = Key is no longer used"}),"\n",(0,s.jsx)(n.li,{children:"Enter an optional description, or hit enter to continue. This field is not important."}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"Y"})]}),"\n",(0,s.jsx)(n.li,{children:"Store this file in 1Password and delete it from your system."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-the-yubikey",children:"Configuring the YubiKey"}),"\n",(0,s.jsx)(n.h3,{id:"importing-the-keys-to-your-yubikey",children:"Importing the keys to your YubiKey"}),"\n",(0,s.jsxs)(n.p,{children:["This will ",(0,s.jsx)(n.em,{children:"destructively"})," move the secret key as well as the three subkeys to the YubiKey from the local keystore, via the ",(0,s.jsx)(n.code,{children:"keytocard"})," command. In this case, ",(0,s.jsx)(n.em,{children:"destructively"})," is a good thing because it will require the YubiKey to be inserted to perform any of these functions."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Insert the YubiKey into the USB port"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --edit-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"toggle"})," to switch to the public key listing (there will be no visible output)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"key 1"})," (to select subkey 1)"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["The interface is not intuitive here. Typing ",(0,s.jsx)(n.code,{children:"key 1"})," will select the first subkey (ssb). An * next to the key will indicate that it has been selected:"]})}),"\n",(0,s.jsx)("img",{src:"images/yubikey-key-import.png",alt:"check import",width:"500"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"keytocard"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When prompted where to store the key, select ",(0,s.jsx)(n.code,{children:"2"}),". This will move the ",(0,s.jsx)(n.em,{children:"encryption"})," subkey to the YubiKey"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"key 1"})," (to deselect subkey 1)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"key 2"})," (to select subkey 2)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"keytocard"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When prompted where to store the key, select 1. This will move the ",(0,s.jsx)(n.em,{children:"signing"})," subkey to the YubiKey"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"key 2"})," (to deselect subkey 2)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"key 3"})," (to select subkey 3)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"keytocard"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["When prompted where to store the key, select 3. This will move the ",(0,s.jsx)(n.em,{children:"authentication"})," subkey to the YubiKey"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"save"})," to save the configuration and exit to the CLI."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"adding-additional-email-addresses",children:"Adding Additional Email Addresses"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Insert the YubiKey into the USB port"}),"\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --expert --edit-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"adduid"})]}),"\n",(0,s.jsx)(n.li,{children:"Enter your Name"}),"\n",(0,s.jsx)(n.li,{children:"Enter the Additional Email Address"}),"\n",(0,s.jsx)(n.li,{children:"Enter a comment if desired"}),"\n",(0,s.jsxs)(n.li,{children:["Enter (",(0,s.jsx)(n.code,{children:"O"}),")kay"]}),"\n",(0,s.jsx)(n.li,{children:"Enter your PIN if prompted"}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"quit"})]}),"\n",(0,s.jsx)(n.li,{children:"When prompted to save your changes, enter y (yes). You have now saved the additional email address to your YubiKey"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"uids-and-the-primary-key",children:"UIDs and the primary key"}),"\n",(0,s.jsx)(n.p,{children:"User IDs are attached to the primary key (aka: master key). Subkeys do not contain any user ID\ninformation. Therefore, if you want to change the user ID information, you only need to:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Modify the primary key (after importing from the key saved in 1Password) to include whatever\nuser ID(s) you choose."}),"\n",(0,s.jsx)(n.li,{children:"Re-generate GPG ASCII armor."}),"\n",(0,s.jsx)(n.li,{children:"Upload the new GPG ASCII armor to GitHub."}),"\n",(0,s.jsx)(n.li,{children:"Re-import the new public key into your local keychain."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["This process does not require modification of anything on the YubiKey. You can verify the results\nof your changes by running ",(0,s.jsx)(n.code,{children:"gpg --card-status"})," while you do and do not have the public key imported\ninto your local keychain. For example:"]}),"\n",(0,s.jsx)(n.p,{children:"Without importing public key into your local GPG keychain:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ gpg --card-status | grep key\nURL of public key : [not set]\nSignature key ....: AAAA BBBB CCCC DDDD EEEE  FFFF 0000 1111 2345 6CDE\nEncryption key....: BBBB CCCC DDDD EEEE FFFF  0000 1111 2222 3234 5BCD\nAuthentication key: CCCC DDDD EEEE FFFF 0000  1111 2222 3333 4456 7DEF\nGeneral key info..: [none]\n"})}),"\n",(0,s.jsx)(n.p,{children:'With importing public key into your local GPG keychain (note the "General key info" now shows User\nID information):'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ gpg --card-status | grep key\nURL of public key : [not set]\nSignature key ....: AAAA BBBB CCCC DDDD EEEE  FFFF 0000 1111 2345 6CDE\nEncryption key....: BBBB CCCC DDDD EEEE FFFF  0000 1111 2222 3234 5BCD\nAuthentication key: CCCC DDDD EEEE FFFF 0000  1111 2222 3333 4456 7DEF\nGeneral key info..: sub  rsa4096/3456CDE 2020-10-14 Human Person <noreply@truss.works>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuring-ssh",children:"Configuring SSH"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Insert the YubiKey into the USB port"}),"\n",(0,s.jsx)(n.li,{children:"Configure your environment"}),"\n",(0,s.jsxs)(n.li,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --export-ssh-key 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n",(0,s.jsx)(n.li,{children:"This will return a string that begins with: ssh-rsa and ends with openpgp:0x1234ABC"}),"\n",(0,s.jsxs)(n.li,{children:["To use this key to push to GitHub, copy this key into your ",(0,s.jsx)(n.a,{href:"https://github.com/settings/keys",children:"GitHub account"}),". If you need to use it to SSH directly into a host, you will need to add it to an authorized-keys file."]}),"\n",(0,s.jsx)(n.li,{children:"Verify the SSH key with the command: ssh-add -L"}),"\n",(0,s.jsxs)(n.li,{children:["This should verify that the SSH key is available on your yubikey. If the string ends in ",(0,s.jsx)(n.code,{children:"cardno:000YXXXXXXXX"}),", then it is on the YubiKey."]}),"\n",(0,s.jsx)(n.li,{children:"Restart the SSH services if necessary with the following commands: source ~/.bash_profile or  source ~/.bashrc"}),"\n",(0,s.jsxs)(n.li,{children:["When connecting via SSH, you should be prompted for your YubiKey User PIN","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"On first use, it may also prompt for the YubiKey passphrase."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-git-commit-signing",children:"Configuring git commit Signing"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Insert the YubiKey into the USB port"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Enter the GPG command: ",(0,s.jsx)(n.code,{children:"gpg --export --armor 1234ABC"})," (where 1234ABC is the key ID of your secret key)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"This will export your public key, which is derived from the secret key. Copy this entire key including the lines:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"-----BEGIN PGP PUBLIC KEY BLOCK-----\n\n-----END PGP PUBLIC KEY BLOCK-----\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Add this key into GitHub"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Add the key into your git config with the following command: ",(0,s.jsx)(n.code,{children:"git config --global user.signingkey 1234ABC"})," (where 1234ABC is the key ID of your key)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Add your name to your git config with the following command: ",(0,s.jsx)(n.code,{children:"git config --global user.name \u201cyour name\u201d"})," (this should match the name provided when you generate your certificate)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Add your email to your git config with the following command: ",(0,s.jsx)(n.code,{children:"git config --global user.email youremail@truss.works"})," (this should match the email that you push commits with)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Configure Git client to always sign commits: ",(0,s.jsx)(n.code,{children:"git config --global commit.gpgsign true"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-github",children:"Configuring Github"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"This step is not sequential and is linked in previous steps. If you\u2019ve reached this point in the document, you should have already completed this."})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Sign into the GitHub web interface"}),"\n",(0,s.jsx)(n.li,{children:"Click on the user icon in the upper right hand corner and select settings"}),"\n",(0,s.jsx)(n.li,{children:"Select SSH and PGP Keys"}),"\n",(0,s.jsx)(n.li,{children:"Add an SSH Key and enter the value generated in Configuring SSH"}),"\n",(0,s.jsx)(n.li,{children:"Add a new GPG Key and enter the value generated in Configuring git signing"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"using-github-desktop",children:"Using Github Desktop"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"echo no-tty >> ~/.gnupg/gpg.conf"}),"\n",(0,s.jsxs)(n.li,{children:["Specify GPG path for clients: ",(0,s.jsx)(n.code,{children:"git config --global gpg.program /usr/local/bin/gpg"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"verifying-your-configuration",children:"Verifying your configuration"}),"\n",(0,s.jsx)(n.p,{children:"To verify that you have both GPG and SSH properly configured, perform the following steps."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Close out of all terminals. This is to ensure that any terminal/shell configuration you made is\nsaved to disk rather than only configured for a shell session. Re-open your terminal of choice."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Remove your YubiKey."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Verify that the only data from your key in your GPG keyring is public key information. If you\nsee ",(0,s.jsx)(n.code,{children:"sec"})," (secret) next to your primary key and/or ",(0,s.jsx)(n.code,{children:"ssb"})," (secret subkey), then you still have\nsecret key material in your keyring and/or on your system. Follow the instructions in the\n",(0,s.jsx)(n.a,{href:"#deleting-local-secret-key-material",children:"deleting local secret key material"})," section if this is the\ncase."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ gpg --list-keys 1234ABC\npub   rsa4096 2020-10-13 [SC]\n      REALLYEXTRALONGSTRINGTHATENDSWITH1234ABC\nuid           [ultimate] Human Person <noreply@truss.works>\nsub   rsa4096 2020-10-13 [E]\nsub   rsa4096 2020-10-14 [S]\nsub   rsa4096 2020-10-14 [A]\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can also run these commands to see if you have any secret key material in your keyring."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"gpg --export-secret-key --armor 1234ABC | gpg --list-packets --verbose | grep skey\ngpg --export-secret-subkeys --armor 1234ABC | gpg --list-packets --verbose | grep skey\n"})}),"\n",(0,s.jsx)(n.p,{children:"2 things will tell you that the secret key material is not present:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"GPG will not ask for your passphrase. If secret key material was present, it would have asked\nfor a passphrase so that it could decrypt the secret key material."}),"\n",(0,s.jsxs)(n.li,{children:["You have no output. If you had output, it would look something like ",(0,s.jsx)(n.code,{children:"skey[2]: [v4 protected]"}),". If you do have ",(0,s.jsx)(n.code,{children:"skey"})," in your output, then you have secret key material on your\nlocal system. If no secret key material is on your local system, then you should only have\n",(0,s.jsx)(n.code,{children:"pkey"})," values (if you remove the ",(0,s.jsx)(n.code,{children:"grep"})," command).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"skey: secret key"}),"\n",(0,s.jsx)(n.li,{children:"pkey: public key"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Re-insert your YubiKey."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Initialize your YubiKey in whatever way you configured it. If you made a separate script, run\nthat. If you need to open a new terminal, do that. Whatever approach you take, it should be the\nthing that does a ",(0,s.jsx)(n.code,{children:"killall"})," on gpg-agent and ssh-agent, followed by ",(0,s.jsx)(n.code,{children:"gpg --card-status all &> /dev/null"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Verify that the secret key data is now available to GPG. This is what it looks like when the key\nmaterial only exists on the YubiKey (not loaded from secret material stored on your system):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ gpg --card-status\n<snip>\nsec#  rsa4096/1234ABC  created: 2020-10-13  expires: never\nssb>  rsa4096/2345BCD  created: 2020-10-13  expires: never\n                       card-no: 000Y XXXXXXXX\nssb>  rsa4096/3456CDE  created: 2020-10-14  expires: never\n                       card-no: 000Y XXXXXXXX\nssb>  rsa4096/4567DEF  created: 2020-10-14  expires: never\n                       card-no: 000Y XXXXXXXX\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you do not see ",(0,s.jsx)(n.code,{children:"sec#"})," next to the primary key and do not see ",(0,s.jsx)(n.code,{children:"ssb>"})," next to the subkeys, then\nthe secret key material may exist on the YubiKey, but GPG is falling back to locally\nstored/loaded secret key material. If this is the case (incorrect configuration), it will look\nlike this. Note there is no ",(0,s.jsx)(n.code,{children:"#"})," after ",(0,s.jsx)(n.code,{children:"sec"})," and no ",(0,s.jsx)(n.code,{children:">"})," after ",(0,s.jsx)(n.code,{children:"ssb"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ gpg --card-status\n<snip>\nsec   rsa4096/1234ABC  created: 2020-10-13  expires: never\nssb   rsa4096/2345BCD  created: 2020-10-13  expires: never\nssb   rsa4096/3456CDE  created: 2020-10-14  expires: never\nssb   rsa4096/4567DEF  created: 2020-10-14  expires: never\n"})}),"\n",(0,s.jsxs)(n.p,{children:["If you do not see the ",(0,s.jsx)(n.code,{children:"#"})," and ",(0,s.jsx)(n.code,{children:">"})," characters after ",(0,s.jsx)(n.code,{children:"sec"})," and ",(0,s.jsx)(n.code,{children:"ssb"}),", then the secret key material\nneeds to be removed from your local system. See the ",(0,s.jsx)(n.a,{href:"#deleting-local-secret-key-material",children:"deleting local secret key\nmaterial"})," section if this is the case."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Verify that the SSH agent can use the subkey used for authentication. If you do not see an entry\nwith ",(0,s.jsx)(n.code,{children:"cardno"})," near the end, then the SSH agent is not correctly configured to use the\nauthentication subkey on your YubiKey."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ ssh-add -L\nssh-rsa AAAAB3<snip>2yyu4Q== cardno:000YXXXXXXXX\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Verify that the GPG agent can use the subkey used for signing. You should see a PGP signature\nthat is generated by running this test. If not, then the GPG agent is not correctly configured\nto use the signing subkey on your YubiKey."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:'$ echo "test" | gpg --clearsign\ngpg: using "REALLYEXTRALONGSTRINGTHATENDSWITH1234ABC" as default secret key for signing\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA256\n\ntest\n-----BEGIN PGP SIGNATURE-----\n\niQIzBAEBCAAdFiEE9zVLjb+li/0UKVrGlXbmxIOHrVoFAl+HbEgACgkQlXbmxIOH\nrVqu7g//RtdsYwTS5+k2pF+IEUyZk0LXnjdnRZhEjRT9M34d/Sh6jhgYZPLx7NLp\n+YSKRLnMpxx1JbS/ffkmq9zibeODyeilO30zh6xC5TsIZak489i0jl1wTo4J7DGf\n4VqoTqNwc3RE8FTUYFGX6trgbjeu7q7yoo6yEGWaxLhR0/TRTU0/eREgAsdwxR+6\n7TkmhxIXV7zO6pe4wLddvJzOM/KZyaumv1dJ0nX3U4q50IqXf+He3WGuetZUci80\nmIsUfv7TH2Bo3kIqm/cTtcpjiXrIXrfpFxC5o9mGII5tw3YzXw0chGm7X5q2yyTl\n7DNpJE/s6kXei45UER/NtyKH6N63GRN9c3aBs4ARGIU/hAlH5SrKOlRCTYENh0HC\ndGJZ68LBvpUNujtU/8TZaPPz0cfhb1hhOa8Ruoo9DwujpScjgpKgpuVxCM+YZB2l\n8/mGGhAzXDIhE8JDjEKk2bHaTy2gulwqTDjuv572qwwJvYkQT3wmx8dp0jswL0fj\nNdjVPs47PGNsLkrVnudzx4VkrS/l8+1g2jn2jCsEbwzjSqWsDYEDAbgopNC4wUQC\nLvXG4r7r2JS6rlmE9rOMlsx3IW16eIGmRCunbP6oOzPJkFn7rBEpl8U37CVdU46F\nhrWMtDgZrBwtz9oklxMfnQMWq+4lCEVuxT6nMJ8FeqxxAnmhVUc=\n=7pFx\n-----END PGP SIGNATURE-----\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If this errors out like this be sure that the environment var ",(0,s.jsx)(n.code,{children:"GPG_TTY"})," is set. See ",(0,s.jsx)(n.a,{href:"#configuring-your-environment",children:"Configuring Your Environment"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:'0 \u276f echo "test" | gpg --clearsign\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA256\n\ntest\ngpg: signing failed: Inappropriate ioctl for device\ngpg: [stdin]: clear-sign failed: Inappropriate ioctl for device\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Verify that the GPG agent can use the subkey used for encryption. This command will create\ncontent ("hello world"), encrypt it from standard input to standard output, and then decrypt it\nfrom standard input to standard output. The final line should be the input string ("hello\nworld").'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:'$ echo "hello world" | gpg --recipient 1234ABC -o- --encrypt - | gpg --decrypt -\ngpg: encrypted with 4096-bit RSA key, ID 2345BCD, created 2020-10-13\n      "Human Person <noreply@truss.works>"\nhello world\n'})}),"\n",(0,s.jsx)(n.p,{children:"You may get an error such as the following. This is transient. As long as the output ends with\nthe string that you echoed out, then everything is working properly."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-plaintext",children:"gpg: error opening lockfile '/Users/human/.gnupg/pubring.kbx.lock': No such file or directory\ngpg: lockfile disappeared\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"deleting-local-secret-key-material",children:"Deleting local secret key material"}),"\n",(0,s.jsxs)(n.p,{children:["During this process, you may find that you have secret key material on your system even though you\nthought you removed it. For instance, this may happen when using ",(0,s.jsx)(n.code,{children:"keytocard"}),". While it is supposed\nto be destructive and remove secret key material from your system (leaving it only on your\nYubiKey), this is not always the case despite what the documentation indicates. Therefore, you may\nhave to manually remove the secret keys from your system. To do that, follow this procedure:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Remove the YubiKey from the computer."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Delete the ",(0,s.jsx)(n.strong,{children:"secret"})," key material from your system. ",(0,s.jsxs)(n.em,{children:["Do not remove your ",(0,s.jsx)(n.strong,{children:"public"})," key material\nor else your GPG agent will not be able to identify the correct secret keys to use on your\nYubiKey."]})]}),"\n",(0,s.jsx)(n.p,{children:"To delete your primary secret key material, run the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"gpg --delete-secret-key 1234ABC\n"})}),"\n",(0,s.jsx)(n.p,{children:"If for some reason that command does not fully delete the subkey secret key material, you can\ndelete that data with this procedure. First identify the keygrips for each subkey. Then delete\nthem."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:'$ gpg --with-keygrip --list-secret-keys "1234ABC"\nsec#  rsa4096 2020-10-13 [SC]\n      REALLYEXTRALONGSTRINGTHATENDSWITH1234ABC\n      Keygrip = REALLYEXTRALONGSTRINGTHATENDSWITH5677EFA\nuid           [ultimate] Human Person <noreply@truss.works>\nssb>  rsa4096 2020-10-13 [E]\n      Keygrip = REALLYEXTRALONGSTRINGTHATENDSWITH2345BCD\nssb>  rsa4096 2020-10-14 [S]\n      Keygrip = REALLYEXTRALONGSTRINGTHATENDSWITH3456CDE\nssb>  rsa4096 2020-10-14 [A]\n      Keygrip = REALLYEXTRALONGSTRINGTHATENDSWITH4567DEF\n'})}),"\n",(0,s.jsx)(n.p,{children:"Once you have the subkey keygrips, delete the secret subkey material:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'$ gpg-connect-agent "delete_key REALLYEXTRALONGSTRINGTHATENDSWITH2345BCD" /bye\nOK\n$ gpg-connect-agent "delete_key REALLYEXTRALONGSTRINGTHATENDSWITH3456CDE" /bye\nOK\n$ gpg-connect-agent "delete_key REALLYEXTRALONGSTRINGTHATENDSWITH4567DEF" /bye\nOK\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Insert YubiKey back into the computer."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Ensure that the signature key, encryption key, and authentication key are set. Ensure that each\nof these keys have a ",(0,s.jsx)(n.code,{children:"card-no"})," entry next to them."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"gpg --card-status\n<snip>\nSignature key ....: AAAA BBBB CCCC DDDD EEEE  FFFF 0000 1111 2345 6CDE\n      created ....: 2020-10-14 00:06:51\nEncryption key....: BBBB CCCC DDDD EEEE FFFF  0000 1111 2222 3234 5BCD\n      created ....: 2020-10-13 23:59:43\nAuthentication key: CCCC DDDD EEEE FFFF 0000  1111 2222 3333 4456 7DEF\n      created ....: 2020-10-14 00:07:50\nGeneral key info..: sub  rsa4096/3456CDE 2020-10-14 Human Person <noreply@truss.works>\nsec#  rsa4096/1234ABC  created: 2020-10-13  expires: never\nssb>  rsa4096/2345BCD  created: 2020-10-13  expires: never\n                       card-no: 000Y XXXXXXXX\nssb>  rsa4096/3456CDE  created: 2020-10-14  expires: never\n                       card-no: 000Y XXXXXXXX\nssb>  rsa4096/4567DEF  created: 2020-10-14  expires: never\n                       card-no: 000Y XXXXXXXX\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Note: if you delete the public keys from your local system, then ",(0,s.jsx)(n.code,{children:"gpg"})," operations will fail when\nusing your YubiKey."]}),"\n",(0,s.jsx)(n.h3,{id:"subkey-stubs",children:"Subkey stubs"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"~/.gnupg/private-keys-v1.d"})," will contain the key stubs for each of the subkeys. These do not\ncontain secret key material, but instead tell GPG that the secret key material is on your YubiKey.\nTo verify this, you can look at the strings in that file and search for a match for\n",(0,s.jsx)(n.code,{children:"shadowed-private-key"}),". The output will look similar to the following:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ strings filename.key| grep shadowed-private-key\n(20:shadowed-private-key(3:rsa(1:n513:\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you see something like the output above, then the file is a stub key, which does not contain the\nsecret key material. Instead, it indicates that the secret key material is on your YubiKey."}),"\n",(0,s.jsx)(n.h2,{id:"using-the-yubikey",children:"Using The YubiKey"}),"\n",(0,s.jsx)(n.h3,{id:"signing-git-commits",children:"Signing git commits"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Insert the YubiKey into the USB port"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"To manually sign a git commit (commits should already be signed automatically if you've enabled it in your git config):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ git commit -a -S -m 'Fixed a small undocumented procedure that made foo crash'\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"To manually sign a git tag:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ git tag foo-1.0 -s -m 'Release 1.0 of foo'\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"When signing, you should be prompted to enter your YubiKey User PIN"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If you\u2019ve enabled touch mode, touch the YubiKey to complete the operation"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"enabling-touch-only-mode-optional",children:"Enabling touch-only mode (optional)"}),"\n",(0,s.jsx)(n.p,{children:"It is possible that your YubiKey could be activated by malware on your machine, which could conceivably use a keylogger to capture your PIN and use that information to automatically sign commits and tags when you're not aware."}),"\n",(0,s.jsx)(n.p,{children:"If enabling touch-only mode, it is recommended to perform this step after you\u2019ve confirmed that everything else is working."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"ykman openpgp keys set-touch aut on"})]}),"\n",(0,s.jsx)(n.li,{children:"Enter the 8 digit Admin PIN"}),"\n",(0,s.jsxs)(n.li,{children:["Enter: ",(0,s.jsx)(n.code,{children:"yes"})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["NOTE: When touch mode is enabled, operations will appear to stall. This is the only prompt that you will receive to touch your YubiKey. Failure to touch the YubiKey for authentication will result in failure of the operation. You can also disable touch-only mode with the following command: ",(0,s.jsx)(n.code,{children:"ykman openpgp keys set-touch aut off"})]}),"\n",(0,s.jsx)(n.h3,{id:"disabling-otp-one-time-password",children:"Disabling OTP (One Time Password)"}),"\n",(0,s.jsx)(n.p,{children:"Disabling the OTP is possible using the YubiKey Manager, and does not affect any other functionality of the YubiKey."}),"\n",(0,s.jsx)(n.p,{children:"A side effect of the YubiKey is the Yubisneeze. The YubiKey will generate and paste a password to your screen nearly every time that you touch it."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Insert the YubiKey into the USB port"}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"ykman config usb --disable otp"})]}),"\n",(0,s.jsxs)(n.li,{children:["Enter the command: ",(0,s.jsx)(n.code,{children:"Y"})," to confirm"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["To re-enable otp, use the command: ",(0,s.jsx)(n.code,{children:"ykman config usb --enable otp"})]}),"\n",(0,s.jsx)(n.h2,{id:"github-apps",children:"GitHub Apps"}),"\n",(0,s.jsx)(n.p,{children:"GitHub Desktop does not support commit signing. In fact, it appears that GitHub wants to keep it this way. That said, if GitHub is configured with your keys correctly, GitHub Desktop may respect your settings and sign commits. We\u2019re still testing this."}),"\n",(0,s.jsxs)(n.p,{children:["Gitkraken directly ",(0,s.jsx)(n.a,{href:"https://support.gitkraken.com/git-workflows-and-extensions/commit-signing-with-gpg/",children:"supports"})," commit signing."]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"The YubiKey is not detected when signing a commit or pulling a private repo via SSH."})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure that the environment has been configured correctly"}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"source ~/.bashrc"})," or ",(0,s.jsx)(n.code,{children:"source ~./zshrc"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"The YubiKey appears to hang when performing operations and then the operations time out."})}),"\n",(0,s.jsx)(n.p,{children:"Touch-only has been enabled. There is no prompt that the YubiKey is waiting to be touched. Run the operation again and touch the YubiKey when the operation hangs. You may see something similar to this:"}),"\n",(0,s.jsx)("img",{src:"images/yubikey-otp-error.png",alt:"otp error",width:"450"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["SSH commands like ",(0,s.jsx)(n.code,{children:"ssh -T git@github.com"})," do not ask for pin"]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:'0 \u276f ssh -T git@github.com\nsign_and_send_pubkey: signing failed for RSA "cardno:000YXXXXXXXX" from agent: agent refused operation\ngit@github.com: Permission denied (publickey).\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Make sure that ",(0,s.jsx)(n.code,{children:"GPG_TTY"})," is set. If so you may need to also run ",(0,s.jsx)(n.code,{children:"gpg-connect-agent updatestartuptty /bye"})," to force the agent to uppdate the tty"]})]})}function y(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},1470:(e,n,i)=>{i.d(n,{A:()=>v});var t=i(6540),s=i(4164),r=i(7559),o=i(3104),l=i(6347),a=i(205),c=i(7485),d=i(1682),h=i(679);function u(e){return t.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function y(e){const{values:n,children:i}=e;return(0,t.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:i,default:t}})=>({value:e,label:n,attributes:i,default:t}))}(i);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,i])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const i=(0,l.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(s),(0,t.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(i.location.search);n.set(s,e),i.replace({...i.location,search:n.toString()})},[s,i])]}function m(e){const{defaultValue:n,queryString:i=!1,groupId:s}=e,r=y(e),[o,l]=(0,t.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const i=n.find(e=>e.default)??n[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:r})),[c,d]=g({queryString:i,groupId:s}),[u,m]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[i,s]=(0,h.Dv)(n);return[i,(0,t.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),x=(()=>{const e=c??u;return p({value:e,tabValues:r})?e:null})();(0,a.A)(()=>{x&&l(x)},[x]);return{selectedValue:o,selectValue:(0,t.useCallback)(e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),m(e)},[d,m,r]),tabValues:r}}var x=i(2303);const j={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=i(4848);function b({className:e,block:n,selectedValue:i,selectValue:t,tabValues:r}){const l=[],{blockElementScrollPositionUntilNextRender:a}=(0,o.a_)(),c=e=>{const n=e.currentTarget,s=l.indexOf(n),o=r[s].value;o!==i&&(a(n),t(o))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const i=l.indexOf(e.currentTarget)+1;n=l[i]??l[0];break}case"ArrowLeft":{const i=l.indexOf(e.currentTarget)-1;n=l[i]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:r.map(({value:e,label:n,attributes:t})=>(0,f.jsx)("li",{role:"tab",tabIndex:i===e?0:-1,"aria-selected":i===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:c,...t,className:(0,s.A)("tabs__item",j.tabItem,t?.className,{"tabs__item--active":i===e}),children:n??e},e))})}function k({lazy:e,children:n,selectedValue:i}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===i);return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i}))})}function w(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,s.A)(r.G.tabs.container,"tabs-container",j.tabList),children:[(0,f.jsx)(b,{...n,...e}),(0,f.jsx)(k,{...n,...e})]})}function v(e){const n=(0,x.A)();return(0,f.jsx)(w,{...e,children:u(e.children)},String(n))}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}},9365:(e,n,i)=>{i.d(n,{A:()=>o});i(6540);var t=i(4164);const s={tabItem:"tabItem_Ymn6"};var r=i(4848);function o({children:e,hidden:n,className:i}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,i),hidden:n,children:e})}}}]);