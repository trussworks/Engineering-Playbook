"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[6840],{2081:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"infrasec/bootstrap","title":"Project Bootstrap Guide","description":"When we\'re starting up a new project, often there is a period of time","source":"@site/docs/infrasec/bootstrap.md","sourceDirName":"infrasec","slug":"/infrasec/bootstrap","permalink":"/docs/infrasec/bootstrap","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/bootstrap.md","tags":[],"version":"current","frontMatter":{},"sidebar":"practices","previous":{"title":"Book Club","permalink":"/docs/infrasec/book-club/"},"next":{"title":"SSL Certificates","permalink":"/docs/infrasec/certs"}}');var i=o(4848),r=o(8453);const a={},s="Project Bootstrap Guide",l={},c=[{value:"GitHub and Git Repos",id:"github-and-git-repos",level:2},{value:"1Password",id:"1password",level:2},{value:"AWS Organization and Accounts",id:"aws-organization-and-accounts",level:2},{value:"GovCloud",id:"govcloud",level:3},{value:"Atlantis",id:"atlantis",level:3},{value:"Placeholder service modules",id:"placeholder-service-modules",level:3},{value:"CI/CD Pipeline",id:"cicd-pipeline",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"project-bootstrap-guide",children:"Project Bootstrap Guide"})}),"\n",(0,i.jsx)(n.p,{children:"When we're starting up a new project, often there is a period of time\nwhere the design and research team is doing their initial work, we don't\nhave any infrastructure set up, and engineers want to do some initial\nexperimentation. This guide is intended as a resource for infrastructure\nengineers bootstrapping a new project from scratch. Not all projects will\nneed all of the elements here; for instance, if you're working in an\nexisting organization's AWS accounts or git repos, then you won't likely\nneed to set up your own."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#project-bootstrap-guide",children:"Project Bootstrap Guide"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#github-and-git-repos",children:"GitHub and Git Repos"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#1password",children:"1Password"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"#aws-organization-and-accounts",children:"AWS Organization and Accounts"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#govcloud",children:"GovCloud"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#atlantis",children:"Atlantis"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#placeholder-service-modules",children:"Placeholder service modules"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#cicd-pipeline",children:"CI/CD Pipeline"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"github-and-git-repos",children:"GitHub and Git Repos"}),"\n",(0,i.jsx)(n.p,{children:"The first thing you will likely need to do for your project is create\na number of GitHub repos and possibly a new GitHub organization. This\nis the prerequisite for nearly everything else you need to do to set\nup your infrastructure, so doing it as early as possible is a good idea."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["If your client does not have an organization for you to do this in,\nor if they would prefer you create a new one, then you will need to\ncreate a new GitHub organization. GitHub has\n",(0,i.jsx)(n.a,{href:"https://docs.github.com/en/organizations/collaborating-with-groups-in-organizations/creating-a-new-organization-from-scratch",children:"docs"}),'\nthat explain this process; you will probably want the "GitHub Team"\nproduct, and use the Truss admin credit card to handle this cost. It\'s\nalso a good idea to make sure the leads for your project are owners,\nand probably your contact at the client organization as well. This\nwill allow them to easily add or remove new members if necessary.']}),"\n",(0,i.jsxs)(n.li,{children:["Once you have a GitHub organization, you will need to create a number\nof repositories:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"myproject-infra"})," - This is a repo which you will use to hold the\nTerraform code used to configure your project's AWS (or other cloud\nservice) account(s)."]}),"\n",(0,i.jsx)(n.li,{children:"application repo(s) - You should talk to the AppEng lead to see how\nthey would like to organize the application and create repos they\ncan use early on. Some projects, like MyMove, may want a single repo\nfor all the application code, but other projects may want separate\nrepos for the frontend and backend, for instance. Neither of these\nis inherently correct, so consult with the AppEng lead (if you have\none) to make this decision."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"myproject-infra-gov"})," - If your project is going to need to have\nresources in GovCloud, as many of ours do, you will need another repo\nfor the Terraform used for that. This is for two reasons; one, we\ngenerally want tighter permissions on who has access to this repo, and\nsecond, if we want to have ",(0,i.jsx)(n.a,{href:"https://runatlantis.io",children:"Atlantis"})," handling\nthe infrastructure in these accounts, we need a separate repo."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["If at all possible, you should be using Terraform to maintain the users,\nteams, and repos for your project. The catch being that you'll need your\n",(0,i.jsx)(n.code,{children:"myproject-infra"})," repo first."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"1password",children:"1Password"}),"\n",(0,i.jsx)(n.p,{children:'It is highly likely that you will want to get a 1Password team for your\nproject. This will allow you to store things like passwords and MFA codes\nfor AWS accounts, GitHub "robot" users, and anything else that you need\nto give members of the team access to.'}),"\n",(0,i.jsxs)(n.p,{children:["You can create a new account by going to ",(0,i.jsx)(n.a,{href:"https://1password.com",children:"https://1password.com"}),' and\nclicking on "sign in" in the upper right hand corner, and then instead\nof clicking on an existing account, click on "create a new account" at\nthe bottom of the page, then click on "for my team" on the next page,\nand follow the creation dialogue. Use the Truss admin card for the\ncharges.']}),"\n",(0,i.jsx)(n.p,{children:"You should only need to add people who actually need to access these\ncredentials for the project to the team (since there's a charge per-user).\nThis generally means all members of the infra team, the engineering lead,\nand the project lead -- but you can always add more people later if\nnecessary."}),"\n",(0,i.jsx)(n.p,{children:"Like the GitHub organization/repositories, this should probably be done\nas early in the process as possible, since you will want to store\ncredentials for the other accounts you are creating."}),"\n",(0,i.jsx)(n.h2,{id:"aws-organization-and-accounts",children:"AWS Organization and Accounts"}),"\n",(0,i.jsx)(n.p,{children:"Once you have a Git repo and 1Password set up, you will want to set up\nyour AWS organization and/or accounts. Even if you don't have an actual\napplication to stand up yet, you should get this bootstrapped so that\nthings are ready to go."}),"\n",(0,i.jsxs)(n.p,{children:["If you are starting from scratch, you will need to open a new AWS account\nby going to ",(0,i.jsx)(n.a,{href:"https://aws.amazon.com",children:"https://aws.amazon.com"})," and creating an AWS account, using\nthe Truss admin card as the billing information. This account will be your\n",(0,i.jsx)(n.code,{children:"org-root"})," account that will start your\n",(0,i.jsx)(n.a,{href:"/docs/infrasec/aws/aws-organizations",children:"AWS Organization"}),". Once that is created, you\nshould bootstrap Terraform in it and set up the ",(0,i.jsx)(n.code,{children:"admin-global"})," namespace.\nThings you will want to set up in the ",(0,i.jsx)(n.code,{children:"org-root"})," account:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"AWS logs S3 bucket"}),"\n",(0,i.jsx)(n.li,{children:"IAM users for org-root users (infra users only)"}),"\n",(0,i.jsx)(n.li,{children:"AWS Config for the organization"}),"\n",(0,i.jsx)(n.li,{children:"AWS Cloudtrail for the organization"}),"\n",(0,i.jsx)(n.li,{children:"AWS GuardDuty for the organization"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Once that is done, you'll also need to set up some other accounts using\nTerraform in the ",(0,i.jsx)(n.code,{children:"org-root"})," account:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-id"})," account for handling all your IAM users"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-infra"})," account for project-wide infrastructure"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-dev"})," account for your dev deployment of the application"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You may want to set up others as well (",(0,i.jsx)(n.code,{children:"-staging"})," or ",(0,i.jsx)(n.code,{children:"-prod"})," for instance),\nbut these are probably the ones you want as soon as possible."]}),"\n",(0,i.jsx)(n.h3,{id:"govcloud",children:"GovCloud"}),"\n",(0,i.jsx)(n.p,{children:"If you will need to be using GovCloud for this project, you should set\nup the parallel organization in GovCloud as well. See the (GovCloud\nOrganization)[./aws/govcloud/gov-orgs.md] docs for an explanation of how\nto set this up."}),"\n",(0,i.jsxs)(n.p,{children:["If you will be working entirely in GovCloud, you will not need the ",(0,i.jsx)(n.code,{children:"-dev"}),"\naccount in your commercial organization; you can leave your commercial\norganization with only the ",(0,i.jsx)(n.code,{children:"org-root"}),", ",(0,i.jsx)(n.code,{children:"-id"}),", and ",(0,i.jsx)(n.code,{children:"-infra"})," accounts. These\nwill be necessary because there are some things that can ",(0,i.jsx)(n.strong,{children:"only"})," be done\nin commercial AWS, such as public DNS."]}),"\n",(0,i.jsx)(n.h3,{id:"atlantis",children:"Atlantis"}),"\n",(0,i.jsxs)(n.p,{children:["If you plan to use ",(0,i.jsx)(n.a,{href:"https://runatlantis.io",children:"Atlantis"})," to maintain your\nTerraform (which we highly recommend), you should also consider setting\nthis up early. We have an ",(0,i.jsx)(n.a,{href:"/docs/infrasec/terraform/atlantis",children:"Atlantis doc"})," that\nwill help you set this up."]}),"\n",(0,i.jsx)(n.p,{children:"Setting up Atlantis early will get your engineers used to the workflow\nand encourage good Terraform habits from the start. This will mean less\nheadaches later trying to figure out which changes are expected and which\nare not."}),"\n",(0,i.jsx)(n.h3,{id:"placeholder-service-modules",children:"Placeholder service modules"}),"\n",(0,i.jsx)(n.p,{children:"Once the AppEng lead has identified, at a high level, the services they\nwill be deploying -- such as a frontend, backend, and database -- you\nshould start building Terraform modules to deploy these components. Even\nif, at this point, they are largely placeholders, you should start\nfiguring out what you'll need to get these working -- things like ECS\nservices, RDS instances, ALBs, VPCs, security groups, IAM roles, etc."}),"\n",(0,i.jsxs)(n.p,{children:["Even if there isn't much to actually put there, and the service will be\ndormant, working this out ",(0,i.jsx)(n.em,{children:"before"})," you need to start demoing things for\nthe client will help you work out any kinks and help developers get a\ntight feedback loop once they start working on the application in earnest."]}),"\n",(0,i.jsx)(n.h2,{id:"cicd-pipeline",children:"CI/CD Pipeline"}),"\n",(0,i.jsx)(n.p,{children:"Setting up your CI/CD pipeline early is another piece of automation that\nwill pay off in the long run. Doing so means that developers will get used\nto the idea that their changes will be put, at the very least, into a real\nrunning environment every time they push, which means that building in\ntests and operability are not optional components or things to be added\nlater."}),"\n",(0,i.jsx)(n.p,{children:"Truss tends to use either CircleCI or GitHub Actions for our projects;\nGitHub Actions are newer and as a result our patterns for them are not as\nwell-developed, however they have a lower barrier to entry and you can\nuse them on a limited basis for free even with private repos. It may also\neasier to use GitHub Actions in environments where clients are cool on\nusing a SaaS product like CircleCI (since they are already likely using\nGitHub). Alternatively, you may need to use a CI/CD pipeline that the\nclient already uses."}),"\n",(0,i.jsx)(n.p,{children:"Regardless of which you pick, you should start wiring up the application\nrepo(s) to your pipeline early, and making sure there is an automated\ndeployment into the dev environment at the very least as close to the\nbeginning of the project as possible. This means that your pipeline\nshould at least do the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"run pre-commit checks on the repo for each PR"}),"\n",(0,i.jsx)(n.li,{children:"run tests (and possibly output code coverage metrics as well)"}),"\n",(0,i.jsx)(n.li,{children:"build a docker image and push it to ECR"}),"\n",(0,i.jsx)(n.li,{children:"attempt to deploy the application, usually by updating the ECS task\ndefinition, and if at all possible, ensure that the correct version\ncomes up and stays up, rolling back if it does not"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>s});var t=o(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);