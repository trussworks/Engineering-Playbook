"use strict";(self.webpackChunkengineering_playbook=self.webpackChunkengineering_playbook||[]).push([[7817],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>h});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),d=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=d(r),h=n,m=c["".concat(l,".").concat(h)]||c[h]||u[h]||s;return r?a.createElement(m,o(o({ref:t},p),{},{components:r})):a.createElement(m,o({ref:t},p))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=r.length,o=new Array(s);o[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,o[1]=i;for(var d=2;d<s;d++)o[d]=r[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},4350:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var a=r(7462),n=(r(7294),r(3905));r(8209);const s={},o="Error Response Strategy",i={unversionedId:"web/api/rest-api-design/Error-Response-Strategy",id:"web/api/rest-api-design/Error-Response-Strategy",title:"Error Response Strategy",description:"Well formatted errors are an important component of education to the user of the API and should be given as much care as the API design.",source:"@site/docs/web/api/rest-api-design/Error-Response-Strategy.md",sourceDirName:"web/api/rest-api-design",slug:"/web/api/rest-api-design/Error-Response-Strategy",permalink:"/docs/web/api/rest-api-design/Error-Response-Strategy",draft:!1,editUrl:"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/web/api/rest-api-design/Error-Response-Strategy.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Data-Design",permalink:"/docs/web/api/rest-api-design/Data-Design"},next:{title:"HTTP Methods",permalink:"/docs/web/api/rest-api-design/HTTP-Methods"}},l={},d=[{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Terms",id:"terms",level:2},{value:"Use a consistent error format across the API",id:"use-a-consistent-error-format-across-the-api",level:3},{value:"Use the correct HTTP status codes",id:"use-the-correct-http-status-codes",level:3},{value:"Use a constant error code to uniquely identify errors",id:"use-a-constant-error-code-to-uniquely-identify-errors",level:3},{value:"Provide Detailed Messages",id:"provide-detailed-messages",level:3},{value:"Examples",id:"examples",level:3},{value:"Security",id:"security",level:3},{value:"Reporting validation errors",id:"reporting-validation-errors",level:3},{value:"Add a requestID to help track errors",id:"add-a-requestid-to-help-track-errors",level:3},{value:"Handling errors in API requests that affect multiple &quot;objects&quot;",id:"handling-errors-in-api-requests-that-affect-multiple-objects",level:3},{value:"Todo",id:"todo",level:2},{value:"Resources",id:"resources",level:3}],p={toc:d};function u(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"error-response-strategy"},"Error Response Strategy"),(0,n.kt)("p",null,"Well formatted errors are an important component of education to the user of the API and should be given as much care as the API design."),(0,n.kt)("p",null,"Just like an HTML error page shows a useful error message to a visitor, an API should provide a ",(0,n.kt)("strong",{parentName:"p"},"useful error message")," in a known consumable format."),(0,n.kt)("h2",{id:"key-takeaways"},"Key Takeaways"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Use a consistent error response strategy."),(0,n.kt)("li",{parentName:"ul"},"Have a default list of errors, in addition to abiding by the correct HTTP status codes."),(0,n.kt)("li",{parentName:"ul"},"Your error codes should not change, unlike descriptive messages, which can change."),(0,n.kt)("li",{parentName:"ul"},"Consider readability by providing a list of errors and using strings for messages instead of integers.")),(0,n.kt)("h2",{id:"terms"},"Terms"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Error Code"),"        \u2014 A unique, machine readable, identifier for the error.\\\n",(0,n.kt)("strong",{parentName:"p"},"Status Code")," \u2014 The status code on the HTTP response. \\\n",(0,n.kt)("strong",{parentName:"p"},"Message"),"           \u2014 A brief human-readable message.\\\n",(0,n.kt)("strong",{parentName:"p"},"Detail"),"            \u2014 A lengthier explanation of the error.\\\n",(0,n.kt)("strong",{parentName:"p"},"Parameters / Path")," \u2014 a description of which part of the request triggered the error."),(0,n.kt)("h3",{id:"use-a-consistent-error-format-across-the-api"},"Use a consistent error format across the API"),(0,n.kt)("p",null,"When the client handles an error, they should know the format of the error beforehand. To make this simple, use the same error format across all errors, at least at the top level."),(0,n.kt)("p",null,"This way the error handling code on the frontend can be somewhat generic, instead of having to adapt to different response types based on the API."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Example"),"\nA bad example would be to return errors like these in the same system. Notice one has parameters ",(0,n.kt)("inlineCode",{parentName:"p"},"Message")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"MissingParameter")," and the other ",(0,n.kt)("inlineCode",{parentName:"p"},"Code")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"Message"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'  "Message": "Required parameter AppId is missing.",\n  "MissingParameter": "SearchRequest.AppId",\n')),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'  "Code": "125764",\n  "Message": "Transaction could not be completed"\n')),(0,n.kt)("p",null,"The client cannot tell whether ",(0,n.kt)("inlineCode",{parentName:"p"},"code")," will always be returned or not, they would have to match the string. The string could change in another similar error."),(0,n.kt)("p",null,"A good example would be to return an error like this, where the ",(0,n.kt)("inlineCode",{parentName:"p"},"Code"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"Title")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"Message")," are available in ALL errors across the API:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'  "Code": "VALIDATION_ERROR",\n  "Title": "Validation Error",\n  "Message": "Required parameter is missing from body"\n  "Body": {\n    "Parameter": "appId"\n  }\n')),(0,n.kt)("p",null,"There's an argument in favor of returning a list of error objects, rather than a single error object, so that the frontend doesn\u2019t have to check every time what the shape of the error response is. This is especially true if you may return multiple errors anywhere in the API."),(0,n.kt)("h3",{id:"use-the-correct-http-status-codes"},"Use the correct HTTP status codes"),(0,n.kt)("p",null,"HTTP defines a lot of ",(0,n.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"meaningful status codes")," that can be returned from an API. Use these as your HTTP response type."),(0,n.kt)("p",null,"For e.g. The types of responses are grouped into the following top level categories."),(0,n.kt)("p",null,"The error codes are 3-digit numbers, and ",(0,n.kt)("inlineCode",{parentName:"p"},"2xx")," below indicates any number from 200-299."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"2xx")," ",(0,n.kt)("strong",{parentName:"li"},"Success")," - This category indicates the action requested by the client was received, understood, and accepted."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"4xx")," ",(0,n.kt)("strong",{parentName:"li"},"Client Error")," - This category indicate that the error seems to have been caused by the client."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"5xx")," ",(0,n.kt)("strong",{parentName:"li"},"Server Error")," - This category indicates the server failed to fulfill a request.")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Importance of the Client vs. Server Error Distinction")," - ",(0,n.kt)("inlineCode",{parentName:"p"},"500")," server errors signal that something went wrong on the backend ",(0,n.kt)("em",{parentName:"p"},"that shouldn't have"),"."),(0,n.kt)("p",null,"If a client sends a request and it has a bad value, the source of the error is the client. That is a known error that should be detected and returned with a ",(0,n.kt)("inlineCode",{parentName:"p"},"4xx"),". Most known errors should be a ",(0,n.kt)("inlineCode",{parentName:"p"},"4xx"),". Some can even be fixed by the client."),(0,n.kt)("p",null,"Most ",(0,n.kt)("inlineCode",{parentName:"p"},"500")," errors are bugs, unexpected situations on the server that cannot be fixed by the client. Keep this in mind as you select which type of error response your situation calls for."),(0,n.kt)("p",null,"Why is this important? 500 errors are usually serious enough that a slew of them should cause on-call staff to be paged. You wouldn't want on-call staff to be paged for something any client can trigger by mashing the submit key on a badly formed request."),(0,n.kt)("p",null,"Since there are a lot of status codes, it's advisable to pick a well-known subset of HTTP responses and return mainly those. It makes it easier for the client to support."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"200")," ",(0,n.kt)("strong",{parentName:"li"},"OK")," - Response to a successful GET, PUT, PATCH or DELETE. Can also be used for a POST that doesn't result in a creation."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"201")," ",(0,n.kt)("strong",{parentName:"li"},"Created")," - Response to a POST that results in a creation."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"404")," ",(0,n.kt)("strong",{parentName:"li"},"Not Found")," - When a non-existent resource is requested."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"409")," ",(0,n.kt)("strong",{parentName:"li"},"Conflict")," - When we cannot process the request due to the current state of the server."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"412")," ",(0,n.kt)("strong",{parentName:"li"},"Precondition Failed")," - A precondition like ",(0,n.kt)("a",{parentName:"li",href:"/docs/web/api/rest-api-design/Concurrency-Control"},"optimistic locking")," has failed."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("inlineCode",{parentName:"li"},"422")," ",(0,n.kt)("strong",{parentName:"li"},"Unprocessable Entity")," - Used for validation errors.")),(0,n.kt)("h3",{id:"use-a-constant-error-code-to-uniquely-identify-errors"},"Use a constant error code to uniquely identify errors"),(0,n.kt)("p",null,"A constant error code in the body allows the logic on the frontend to understand and handle the error correctly. Note this is different from the HTTP status code."),(0,n.kt)("p",null,'For e.g. rather than a message stating "Last name was missing from the response", it\'s better to send a code as well as the message. The frontend code can then look for ',(0,n.kt)("inlineCode",{parentName:"p"},"code == MISSING_PARAMETER")," and know how to handle it consistently for all missing parameters."),(0,n.kt)("p",null,'Without a code, a different error might return, "Phone number is required" resulting in special handling for very similar issues.'),(0,n.kt)("p",null,"Any logic that handles this error code should match on the error code and not on an error string. This ensures error handling won\u2019t break if the message changes."),(0,n.kt)("p",null,"For the error code itself, consider using an enumerated short string for readability. This provides the twofold benefit of being a constant value, but also being human-readable."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'  "Code": "MISSING_PARAMETER"\n')),(0,n.kt)("h3",{id:"provide-detailed-messages"},"Provide Detailed Messages"),(0,n.kt)("p",null,"Messages are mainly used by developers who are reading a raw response, so help them understand what went wrong and how they could fix it."),(0,n.kt)("p",null,"Provide detail. If there are multiple errors, it's best to always return a list of errors, lists are easier to read and process."),(0,n.kt)("p",null,"Consider adding parameters to your messages. This is most commonly\nused for validation errors, describing what parameter in the request\nis wrong. E.g. \u201csubmitter.email\u201d"),(0,n.kt)("h3",{id:"examples"},"Examples"),(0,n.kt)("p",null,(0,n.kt)("em",{parentName:"p"},"From Bing, a good error response:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "SearchResponse": {\n    "Version": "2.2",\n    "Query": {\n      "SearchTerms": "api error codes"\n    },\n    "Errors": [\n      {\n        "Code": 1001,\n        "Message": "Required parameter is missing.",\n        "Parameter": "SearchRequest.AppId",\n        "HelpUrl": "http://msdn.microsoft.com/en-us/library/dd251042.aspx"\n      }\n    ]\n  }\n}\n')),(0,n.kt)("p",null,(0,n.kt)("em",{parentName:"p"},"From go, a bad error response:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},"    Bad Request\n")),(0,n.kt)("h3",{id:"security"},"Security"),(0,n.kt)("p",null,"While detailed messages are good, do not reveal the internals of the system unnecessarily."),(0,n.kt)("p",null,"For e.g. do not return the raw SQL error that reveals schema information to your user. Instead log that error securely, and return a rewritten message that clearly states to the user what ",(0,n.kt)("em",{parentName:"p"},"they")," might fix in their request."),(0,n.kt)("p",null,"The following message reveals table names and column names and an ID. Do not return this to the client."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},"{\n        \"Code\": 1001,\n        \"Message\": \"ERROR: insert or update on table 'user_auth' violates foreign key constraint 'user_auth_address_id_fkey' DETAIL: Key (user_auth)=(27856) is not present in table 'address'.\"\n}\n")),(0,n.kt)("p",null,"Instead, return a succinct, readable message that is useful to the user but doesn't reveal sytem internals:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n        "Code": CONFLICT_ERROR,\n        "Message": "User account is incomplete and causes a conflict. Please add address information."\n}\n')),(0,n.kt)("h3",{id:"reporting-validation-errors"},"Reporting validation errors"),(0,n.kt)("p",null,"Validation issues can be global, per object, and per field and a single request can have multiple errors. This is why it is important to be able return an array of errors."),(0,n.kt)("p",null,"We recommend having a list of errors be the default, even in cases when there is only one error returned."),(0,n.kt)("p",null,"This simplifies client side code to be able to assume the top level format of error bodies."),(0,n.kt)("p",null,"You can tie individual errors to the invalid request using a \u201cparameters/path\u201d key"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "errors": [\n    {\n      "Code": "PARAMETER_MISSING",\n      "Message": "First name is missing.",\n      "Parameter": "geek.firstname"\n    },\n    {\n      "Code": "TOO_SHORT",\n      "Message": "Phone number must be at least 10 digits.",\n      "Parameter": "geek.phone_number"\n    }\n    ]\n}\n')),(0,n.kt)("h3",{id:"add-a-requestid-to-help-track-errors"},"Add a requestID to help track errors"),(0,n.kt)("p",null,"It can be useful to add a parameter that uniquely identifies the specific request with a UUID. Then in your server logs, be sure to add that parameter in your structured logging data. Also, it is beneficial to add this as a header in all responses."),(0,n.kt)("p",null,"When a client has an error and cannot solve it themselves, they can report the error with the requestID, allowing backend developers to find the associated logs."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},' {\n      "code": "CONFLICT_ERROR",\n      "title": "Conflict Error",\n      "detail": "Estimated weight must be set before this item can be approved.",\n      "requestID": "7673868d-231e-490d-9c4f-19288e7e668d"\n }\n')),(0,n.kt)("h3",{id:"handling-errors-in-api-requests-that-affect-multiple-objects"},'Handling errors in API requests that affect multiple "objects"'),(0,n.kt)("p",null,"If an API request could affect multiple \u201cobjects\u201d, how are errors handled? Are all changes rolled back?"),(0,n.kt)("p",null,"From ",(0,n.kt)("a",{parentName:"p",href:"https://alidg.me/blog/2016/9/24/rest-api-error-handling"},"Rest Api Error Handling")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Define ranges for error codes"),(0,n.kt)("li",{parentName:"ol"},"Define Resource Based Error Codes.\nThat is, we use a string prefix for each error code and that prefix is determined by the resource itself.\nExample:")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status_code": 400,\n  "reason_phrase": "Bad Request",\n  "errors": [\n    {"code": "geeks-2", "message": "The first_name is mandatory"},\n    {"code": "geeks-3", "message": "The last_name is mandatory"}\n  ]\n}\n')),(0,n.kt)("h2",{id:"todo"},"Todo"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Internationalizing errors")),(0,n.kt)("h3",{id:"resources"},"Resources"),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/30109787/internationalization-of-api-error-messages-on-front-end-or-back-end"},"Internationalization of API error messages"),"\\\n",(0,n.kt)("a",{parentName:"p",href:"https://www.at-it-translator.com/best-practicestips-for-software-application-and-game-localization/"},"Best practices for localization"),"\\\n",(0,n.kt)("a",{parentName:"p",href:"https://docs.ckan.org/en/2.9/contributing/string-i18n.html"},"String Internationalization"),"\\\n",(0,n.kt)("a",{parentName:"p",href:"https://nordicapis.com/best-practices-api-error-handling/"},"Best practices for API error handling"),"\\\n",(0,n.kt)("a",{parentName:"p",href:"https://www.baeldung.com/rest-api-error-handling-best-practices"},"Rest API Error Handling")))}u.isMDXComponent=!0},8209:(e,t,r)=>{r(7294)}}]);