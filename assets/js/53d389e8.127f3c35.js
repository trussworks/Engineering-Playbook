"use strict";(globalThis.webpackChunkengineering_playbook=globalThis.webpackChunkengineering_playbook||[]).push([[6006],{45:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"appeng/adrs/distributed-tracing","title":"0002 - Use OpenTelemetry to instrument code for distributed tracing","description":"Status: Accepted","source":"@site/docs/appeng/adrs/0002-distributed-tracing.md","sourceDirName":"appeng/adrs","slug":"/appeng/adrs/distributed-tracing","permalink":"/docs/appeng/adrs/distributed-tracing","draft":false,"unlisted":false,"editUrl":"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/appeng/adrs/0002-distributed-tracing.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"practices","previous":{"title":"0001 - Preference to use TypeScript in place of JavaScript","permalink":"/docs/appeng/adrs/use-typescript"},"next":{"title":"0003 Open Source Application Code","permalink":"/docs/appeng/adrs/open-source-application-code"}}');var s=i(4848),r=i(8453);const o={},a="0002 - Use OpenTelemetry to instrument code for distributed tracing",l={},d=[{value:"Context",id:"context",level:2},{value:"Objective",id:"objective",level:3},{value:"Why Distributed Tracing?",id:"why-distributed-tracing",level:3},{value:"ADR Goals and Anti-goals",id:"adr-goals-and-anti-goals",level:3},{value:"Decision",id:"decision",level:2},{value:"Use OpenTelemetry",id:"use-opentelemetry",level:3},{value:"Why is this Applicable to the Practice as a Whole",id:"why-is-this-applicable-to-the-practice-as-a-whole",level:2},{value:"When to Not Implement This Decision",id:"when-to-not-implement-this-decision",level:2},{value:"Alternatives Considered",id:"alternatives-considered",level:2},{value:"Use a vendor&#39;s instrumentation libraries",id:"use-a-vendors-instrumentation-libraries",level:3},{value:"Do not instrument",id:"do-not-instrument",level:3},{value:"Links",id:"links",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"0002---use-opentelemetry-to-instrument-code-for-distributed-tracing",children:"0002 - Use OpenTelemetry to instrument code for distributed tracing"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Status:"})," Accepted"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Date Accepted:"})," 12/8/2021"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Reviewers:"})," @ahobson @felipe-lee @gidjin @jim @macrael @mikena-truss @reggieriser @rogeruiz"]}),"\n",(0,s.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,s.jsx)(n.h3,{id:"objective",children:"Objective"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Give developers and operators an easier way to understand the behavior and\nstructure of running systems by instrumenting code for distributed tracing,\nleading to a more consistent experience for the systems' users."})}),"\n",(0,s.jsx)(n.h3,{id:"why-distributed-tracing",children:"Why Distributed Tracing?"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"Observability is defined as the ability of the internal states of a system to\nbe determined by its external outputs."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are several established techniques for gaining observability into complex\nsoftware systems:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Logging","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"helpful for known knowns"}),"\n",(0,s.jsx)(n.li,{children:'e.g. "I want to know when a specific condition is reached"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Metrics","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"helpful for assessing known unknowns"}),"\n",(0,s.jsx)(n.li,{children:'e.g. "How many requests per second was the system handling last Tuesday?"'}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Distributed Tracing","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"helpful for learning about unknown unknowns"}),"\n",(0,s.jsx)(n.li,{children:'e.g. "What was the execution context for User X that caused their\ninteraction to timeout last Tuesday?"'}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Some of the benefits of distributed tracing as outlined in\n",(0,s.jsx)(n.a,{href:"https://petabridge.com/blog/why-use-distributed-tracing/",children:(0,s.jsx)(n.em,{children:"How Distributed Tracing Solves One of the Worst Microservices Problems"})}),"\nare:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"radically improves developer productivity and output"}),"\n",(0,s.jsx)(n.li,{children:"works across multiple applications, programming languages, and transports"}),"\n",(0,s.jsx)(n.li,{children:"improve time to market"}),"\n",(0,s.jsx)(n.li,{children:"facilitates excellent cross-team communication and cooperation"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Here are several example scenarios or questions that distributed tracing can\nhelp answer:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"As a new engineer on the team, I want to understand how many separate systems\nare involved when a certain user type logs in and the first page is rendered."}),"\n",(0,s.jsx)(n.li,{children:"As an operations engineer, I want to know how many SQL queries are executed\nfor a given endpoint or interaction."}),"\n",(0,s.jsx)(n.li,{children:"As a product manager, I want to know if a new feature is being used by a\ncertain cohort of users on a regular basis."}),"\n",(0,s.jsx)(n.li,{children:"As an engineer, I want to prove that an optimization I wrote is effective\nin a production environment."}),"\n",(0,s.jsx)(n.li,{children:"As a load tester, after I have shown that a problem exists, I want to\nunderstand how the system is interacting so I can debug and fix the issue."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"adr-goals-and-anti-goals",children:"ADR Goals and Anti-goals"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Goal: Choose which set of libraries to use within a codebase (across\nprogramming languages) for generating distributed tracing data"}),"\n",(0,s.jsxs)(n.li,{children:['Anti-goal: Committing to a specific "backend", i.e. platform or service for\ngathering, exploring, and displaying trace information',"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Sub-goal: Leaving open as many options as possible for the backend"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsx)(n.h3,{id:"use-opentelemetry",children:"Use OpenTelemetry"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["OpenTelemetry is an emerging industry standard","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"vendors find benefit of being in the OpenTelemetry ecosystem because they\nno longer have to create or support instrumentation libraries in an ever\ngrowing array of languages, i.e. as soon as language library exists for\nOpenTelemetry, the vendors automatically become available to support that\ngiven language."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["OpenTelemetry is vendor agnostic","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"tracing information can be sent to hosted services (e.g. Honeycomb.io, AWS\nX-Ray, etc) or self-hosted Open Source implementations (e.g. Zipkin, Jaeger,\netc)"}),"\n",(0,s.jsx)(n.li,{children:"if left unconfigured, OpenTelemetry instrumentation calls default to\nlightweight/noop executions"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["OpenTelemetry has well-maintained libraries for the languages used in the\nlayers of most Truss projects","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"i.e. Go (back-end); JavaScript (front-end); Python (load testing); etc"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Easily swappable back-ends","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"e.g. could choose a local Docker version of OpenZipkin for an all-local\ndevelopment environment"}),"\n",(0,s.jsx)(n.li,{children:"e.g. can use Honeycomb.io in the experimental commercial-cloud hosted\nenvironment"}),"\n",(0,s.jsx)(n.li,{children:"e.g. can swap in AWS X-Ray for use in GovCloud hosted environments"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Cons","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"as an abstraction layer, OpenTelemetry may prohibit usage of vendor-specific\ncapabilities"}),"\n",(0,s.jsx)(n.li,{children:"some OpenTelemetry libraries and tools may trail their vendor-supported\ncounterparts"}),"\n",(0,s.jsx)(n.li,{children:"instrumentation for tracing may be a vector for performance overhead"}),"\n",(0,s.jsx)(n.li,{children:"the specification is relatively new so you may have to use pre-1.0\nversions of some libraries"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"why-is-this-applicable-to-the-practice-as-a-whole",children:"Why is this Applicable to the Practice as a Whole"}),"\n",(0,s.jsx)(n.p,{children:"Most applications will benefit from instrumentation once they are accepting\nproduction traffic. For many systems, a significant amount of work is required\nto add tracing calls to the code after substantial development has been\ncompleted. Therefore, instrumentation needs to be part of the development\nprocess early in a project."}),"\n",(0,s.jsx)(n.p,{children:"Projects should identify what types of calls need to be traced as a part of\ndiscovery and document these decisions in a project-level ADR. For example,\na web backend might add tracing to HTTP requests, service invocations,\ndatabase calls, and any network requests made by the backend."}),"\n",(0,s.jsx)(n.h2,{id:"when-to-not-implement-this-decision",children:"When to Not Implement This Decision"}),"\n",(0,s.jsx)(n.p,{children:"Don't use OpenTelemetry if:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"the ecosystem you are working in doesn't have a mature instrumentation\nlibrary"}),"\n",(0,s.jsx)(n.li,{children:"the project already has a working instrumentation solution using a\nproprietary hosted service that is satisfying the project's needs"}),"\n",(0,s.jsx)(n.li,{children:"the project is too small to support the effort required to implement\ntracing. If this is the case, it is probably worth investigating if there\nare other implementation options for the project, potentially in\nhigher-level languages or batteries-included frameworks."}),"\n",(0,s.jsx)(n.li,{children:"it isn't possible to setup a backend to collect data"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"alternatives-considered",children:"Alternatives Considered"}),"\n",(0,s.jsx)(n.h3,{id:"use-a-vendors-instrumentation-libraries",children:"Use a vendor's instrumentation libraries"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"+"})," Enables accessing vendor-specific capabilities"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-"})," Vendor lock-in in code","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"lock-in may be somewhat mitigated by translation layers available within\nthe OpenTelemetry ecosystem, at the expense of increased configuration burden"}),"\n",(0,s.jsx)(n.li,{children:"example - choosing AWS X-Ray would work well in the deployed GovCloud\nenvironments, but it does not scale down to exclusively local development\nenvironments, i.e. X-Ray does not provide a UI for browsing distributed\ntraces with their local X-Ray daemon"}),"\n",(0,s.jsx)(n.li,{children:"example - choosing Honeycomb.io's instrumentation libraries adds a lot of\nnice auto-instrumentation capabilities over OpenTelemetry, but since\nHoneycomb does not have FedRAMP (nor do most of their peers), the distributed\ntracing could not be enabled in the GovCloud deployed environments"}),"\n",(0,s.jsx)(n.li,{children:"example - using an open source tool (e.g. OpenZipkin) can scale down to\nlocal development, but would require more infrastructure support to self-host\nthe data storage and UI tools in the GovCloud environments"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"do-not-instrument",children:"Do not instrument"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"+"})," No work to be done"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"-"})," developers and operators continue to use current methods to build their\nunderstanding of the system, which is likely slower and less complete than when\nusing distributed tracing"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://youtu.be/_OXYCzwFd1Y",children:"Modern Observability with OpenTelemetry"})," (YouTube video, 12 minutes)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://player.fm/series/the-infoq-podcast-2896265/ted-young-on-observability-and-the-release-of-opentelemetry-10",children:"Ted Young on Observability and the Release of OpenTelemetry 1.0"})," (The InfoQ Podcast, 33 minutes)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://petabridge.com/blog/why-use-distributed-tracing/",children:"How Distributed Tracing Solves One of the Worst Microservices Problems"})," (article)"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);