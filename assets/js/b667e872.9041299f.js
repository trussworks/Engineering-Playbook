"use strict";(self.webpackChunkengineering_playbook=self.webpackChunkengineering_playbook||[]).push([[1966],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>m});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var s=n.createContext({}),l=function(e){var t=n.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},p=function(e){var t=l(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=a(e,["components","mdxType","originalType","parentName"]),d=l(r),m=i,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return r?n.createElement(f,c(c({ref:t},p),{},{components:r})):n.createElement(f,c({ref:t},p))}));function m(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=r.length,c=new Array(o);c[0]=d;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:i,c[1]=a;for(var l=2;l<o;l++)c[l]=r[l];return n.createElement.apply(null,c)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5908:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var n=r(7462),i=(r(7294),r(3905));r(8209);const o={},c="CircleCI Utilities",a={unversionedId:"developing/cicd/circleci-utilities",id:"developing/cicd/circleci-utilities",title:"CircleCI Utilities",description:"There are common tasks that may be useful to build into CircleCI commands and jobs to inform more complex build pipeline logic. Since CircleCI does not support orbs designed to return values which can be passed into other commands as parameters, it can be difficult to create reusable orbs for these purposes.",source:"@site/docs/developing/cicd/circleci-utilities.md",sourceDirName:"developing/cicd",slug:"/developing/cicd/circleci-utilities",permalink:"/docs/developing/cicd/circleci-utilities",draft:!1,editUrl:"https://github.com/trussworks/Engineering-Playbook/edit/main/docs/developing/cicd/circleci-utilities.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"CircleCI Config Patterns",permalink:"/docs/developing/cicd/circleci-patterns"},next:{title:"Standard Delivery Pipeline",permalink:"/docs/developing/cicd/delivery-pipeline"}},s={},l=[{value:"Make Github API Requests",id:"make-github-api-requests",level:2}],p={toc:l};function u(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"circleci-utilities"},"CircleCI Utilities"),(0,i.kt)("p",null,"There are common tasks that may be useful to build into CircleCI commands and jobs to inform more complex build pipeline logic. Since CircleCI does not support orbs designed to return values which can be passed into other commands as parameters, it can be difficult to create reusable orbs for these purposes."),(0,i.kt)("h2",{id:"make-github-api-requests"},"Make Github API Requests"),(0,i.kt)("p",null,"CircleCI pipelines provide some information about the VCS, but there are scenarios where more information may be required. One way to access more information is to use the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.github.com/en/rest/reference/"},"Github API")," within a job or command."),(0,i.kt)("p",null,"The example below leverages a GET request to get the details of a given PR, specifically extracting the PR's base branch commit SHA. This base SHA combined with the CircleCI-provided pipeline SHA is used to get a list of which files were changed. The output could be used within other steps of a more complex job (e.g. determining what parts of a pipeline should run based on what files were changed)"),(0,i.kt)("details",null,(0,i.kt)("summary",null,"GET Pull Request changed files"),(0,i.kt)("p",null,"References:\n",(0,i.kt)("a",{parentName:"p",href:"https://circleci.com/docs/2.0/oss/#only-build-pull-requests"},"Only build Pull Requests"),"\n",(0,i.kt)("a",{parentName:"p",href:"https://circleci.com/docs/2.0/env-vars/?section=pipelines#built-in-environment-variables"},"Built-in environment variables"),"\n",(0,i.kt)("a",{parentName:"p",href:"https://support.circleci.com/hc/en-us/articles/360047521451-Why-is-CIRCLE-PR-NUMBER-empty-"},"Get PR number from CircleCI pull request build"),"\n",(0,i.kt)("a",{parentName:"p",href:"https://docs.github.com/en/rest/reference/pulls#get-a-pull-request"},"Github API - GET Pull Request API"),"\n",(0,i.kt)("a",{parentName:"p",href:"https://git-scm.com/docs/git-diff"},"git diff")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'jobs:\n  get-pull-request-changes:\n    executor: main\n    steps:\n      - checkout\n      - run:\n          name: "git PR diff"\n          command: |\n            pr_number=${CIRCLE_PULL_REQUEST##*/}\n            base_sha=$( \\\n              curl \\\n              -s \\\n              -H "Accept: application/vnd.github.v3+json" \\\n              https://api.github.com/repos/"${CIRCLE_PROJECT_USERNAME}"/"${CIRCLE_PROJECT_REPONAME}"/pulls/"${pr_number}" \\\n              | jq -r \'.base.sha\'\n            )\n            git diff "$base_sha" "$CIRCLE_SHA1" --name-only\n          environment:\n            TERM: xterm-256color\n'))))}u.isMDXComponent=!0},8209:(e,t,r)=>{r(7294)}}]);