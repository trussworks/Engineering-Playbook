<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-infrasec/aws/vpcs">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">VPC Configuration | Truss Engineering Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.truss.dev/docs/infrasec/aws/vpcs"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="VPC Configuration | Truss Engineering Playbook"><meta data-rh="true" name="description" content="VPC basics"><meta data-rh="true" property="og:description" content="VPC basics"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://playbook.truss.dev/docs/infrasec/aws/vpcs"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/infrasec/aws/vpcs" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/infrasec/aws/vpcs" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4015f6c5.css">
<link rel="preload" href="/assets/js/runtime~main.5460b823.js" as="script">
<link rel="preload" href="/assets/js/main.f254410f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Engineering Playbook</b></a><a class="navbar__item navbar__link" href="/docs">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/practices">Practices</a><a class="navbar__item navbar__link" href="/docs/incident-response">Incident Response</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trussworks/Engineering-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/practices">Engineering Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/appeng">AppEng</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/infrasec">InfraSec</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec">InfraSec Practice</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/adrs">ADRs</a><button aria-label="Toggle the collapsible sidebar category &#x27;ADRs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/alert-providers">Alert Providers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/ansible">Ansible</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/infrasec/aws">AWS</a><button aria-label="Toggle the collapsible sidebar category &#x27;AWS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/aws-organizations">AWS Organizations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/aws/govcloud">Working in GovCloud</a><button aria-label="Toggle the collapsible sidebar category &#x27;Working in GovCloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/guardduty">GuardDuty for Organizations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/naming">Naming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/org-bootstrap">Bootstrapping an AWS Organization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/sns-guardduty-alert-integrations">Using SNS, GuardDuty, and External Integrations with AWS Organizations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/sns-topics">SNS Topics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/infrasec/aws/vpcs">VPC Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/book-club">Book Club</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/bootstrap">Project Bootstrap Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/certs">SSL Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/charter">InfraSec Practice Charter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/ci_cd">CI/CD according to Truss</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/delivery-pipeline">Standard Delivery Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/good-infra">Good Infrastructure - A Philosophy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/pro-dev">Professional Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/teardown">Project Teardown Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/terraform">Terraform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Terraform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">InfraSec</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/infrasec/aws"><span itemprop="name">AWS</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">VPC Configuration</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>VPC Configuration</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-basics">VPC basics<a href="#vpc-basics" class="hash-link" aria-label="Direct link to VPC basics" title="Direct link to VPC basics">​</a></h2><p>A VPC is a &quot;Virtual Private Cloud&quot;.
This is a virtual network defined in AWS.
Each VPC is defined in a specified <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-available-regions" target="_blank" rel="noopener noreferrer">region</a>.</p><p>The VPC needs a defined CIDR block.
These are private network blocks and need to have enough ip addresses for whatever you plan to deploy.
When in doubt, use a <code>/16</code>.</p><p>Note that each region has multiple <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-availability-zones" target="_blank" rel="noopener noreferrer">Availability Zones</a> and the ip space will be subdivided into subnets across these availabilty zones.</p><p>Depending on what you&#x27;re doing you might just want to use the <a href="https://github.com/terraform-aws-modules/terraform-aws-vpc" target="_blank" rel="noopener noreferrer">terraform-aws-vpc module</a> with the right toggles.</p><p>The following are objects associated with VPCs that can be configured.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subnets">Subnets<a href="#subnets" class="hash-link" aria-label="Direct link to Subnets" title="Direct link to Subnets">​</a></h3><p>A subnet is a logical subdivision of an IP network.
Generally, you will create a pair of public and private subnets in each availability zone for the region.
A good default CIDR range for each subnet is either a <code>/22</code> or <code>/24</code>.
You will not want to repeat CIDR ranges across your whole network otherwise your routing might get messy.</p><p>Creating additional subnets will create additional complexity in route tables.
If your project requires you to isolate resources from one another, use Security groups.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="route-tables">Route tables<a href="#route-tables" class="hash-link" aria-label="Direct link to Route tables" title="Direct link to Route tables">​</a></h3><p>Route tables define the network routing in the VPC.
You can route specific ip address spaces to separate subnets or to gateways.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-acls">Network ACLs<a href="#network-acls" class="hash-link" aria-label="Direct link to Network ACLs" title="Direct link to Network ACLs">​</a></h3><p>Network ACLs are like firewall rules applied to specific subnets in a VPC.
You can define inbound and outbound network traffic across ports for specific IP addresses.
We prefer to use Security Groups over Network ACLs as they can be applied to specific resources in a VPC.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-groups">Security Groups<a href="#security-groups" class="hash-link" aria-label="Direct link to Security Groups" title="Direct link to Security Groups">​</a></h3><p>In a traditional corporate network these would be equivalent to firewall rules.
Security Groups allow you to define inbound and outbound network traffic across ports that than be specific to IP addresses OR other security groups.
Because you can define security group access using security group names, we find it easier to configure intended access to resources than Network ACLs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateways">Gateways<a href="#gateways" class="hash-link" aria-label="Direct link to Gateways" title="Direct link to Gateways">​</a></h3><p>Use an Internet Gateway for public subnets.
These allow traffic in and out of the VPC to the public internet.
For all public subnets in a VPC, use a single internet gateway for default routes.</p><p>Use a NAT Gateway for private subnets.
These only allow traffic out of the VPC to the public internet.
For each private subnet, create a NAT gateway.
Based on Terraform documentation, a NAT gateway will be provisioned with an EIP.
Note, you do not need a NAT instance.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vpc-endpoints">VPC endpoints<a href="#vpc-endpoints" class="hash-link" aria-label="Direct link to VPC endpoints" title="Direct link to VPC endpoints">​</a></h3><p>VPC endpoints are AWS provided and defined endpoints for AWS services.
You may want to use this to close up your network so you have no public traffic.</p><p>There are two types of VPC endpoints, Gateway endpoints and Interface endpoints.</p><p>Interface endpoints are a deployed elastic network interface with a private IP address connected to your VPC.
Note: In our internal test configuration we weren&#x27;t sure it was worth the cost to just spin up one of everything.</p><p>Example of S3 endpoint (heavily modified and commented) from <a href="https://github.com/terraform-aws-modules/terraform-aws-vpc/blob/master/vpc-endpoints.tf" target="_blank" rel="noopener noreferrer">terraform-aws-vpc module endpoints file</a>:</p><div class="language-terraform codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-terraform codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">locals {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    vpc_id = &quot;id of vpc&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    vpce_tags = { some map of tags... }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"># Does a data lookup on the s3 service to determine the name of the service for aws_vpc_endpoint</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">data &quot;aws_vpc_endpoint_service&quot; &quot;s3&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  service = &quot;s3&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"># Creates the VPC endpoint</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_vpc_endpoint&quot; &quot;s3&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  vpc_id       = local.vpc_id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  service_name = data.aws_vpc_endpoint_service.s3[0].service_name</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  tags         = local.vpce_tags</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"># Create the route table association in the private rout tables</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_vpc_endpoint_route_table_association&quot; &quot;private_s3&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  vpc_endpoint_id = aws_vpc_endpoint.s3[0].id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  route_table_id  = element(aws_route_table.private.*.id, count.index)</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"># Create the route table association if you have intra subnets</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_vpc_endpoint_route_table_association&quot; &quot;intra_s3&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  vpc_endpoint_id = aws_vpc_endpoint.s3[0].id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  route_table_id  = element(aws_route_table.intra.*.id, 0)</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"># Create the route table for the public subnets if you have them</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_vpc_endpoint_route_table_association&quot; &quot;public_s3&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  vpc_endpoint_id = aws_vpc_endpoint.s3[0].id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  route_table_id  = aws_route_table.public[0].id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Gateway endpoints are existing endpoints that require configuration in the route tables.
Available Gateway endpoints are: AWS S3 and AWS DynamoDB endpoints in your VPC and you should just deploy those.</p><p>The full list of supported endpoints is <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html" target="_blank" rel="noopener noreferrer">here</a>.
You can see some examples of how to set them up <a href="https://github.com/terraform-aws-modules/terraform-aws-vpc/blob/master/vpc-endpoints.tf" target="_blank" rel="noopener noreferrer">here</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="flow-logs">Flow logs<a href="#flow-logs" class="hash-link" aria-label="Direct link to Flow logs" title="Direct link to Flow logs">​</a></h3><p>VPC Flow logs allow you to monitor all network traffic in your VPC.</p><p>If you plan to use AWS GuardDuty you must turn these on.
Otherwise, unless you have a plan to ingest, manage, view, and monitor network flow logs we do not recommend you turn these on.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="default-vpc-configuration">Default VPC configuration<a href="#default-vpc-configuration" class="hash-link" aria-label="Direct link to Default VPC configuration" title="Direct link to Default VPC configuration">​</a></h2><p>Every AWS account comes with a default VPC.
In general, you will not want to use that VPC.</p><p>Use our <a href="https://github.com/trussworks/terraform-aws-destroy-default-vpc" target="_blank" rel="noopener noreferrer">Destroy default VPC Terraform Module</a> to effectively destroy the VPC.
WARNING: undoing this module is hard so if you have inherited the infrastructure you are managing and MIGHT have old resources in the default VPC we don&#x27;t suggest using it.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference-links">Reference links<a href="#reference-links" class="hash-link" aria-label="Direct link to Reference links" title="Direct link to Reference links">​</a></h2><ul><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html" target="_blank" rel="noopener noreferrer">AWS VPC documentation</a></li><li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-endpoints.html" target="_blank" rel="noopener noreferrer">AWS VPC Endpoint documentation</a></li><li><a href="https://docs.google.com/document/d/1LeEfqBqVw8gyvSU-TD5IUvDYEwM-0wq5IhYE58fNB8c/edit" target="_blank" rel="noopener noreferrer">Truss Internal guidance doc</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/aws/vpcs.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/infrasec/aws/sns-topics"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SNS Topics</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/infrasec/book-club"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Book Club</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#vpc-basics" class="table-of-contents__link toc-highlight">VPC basics</a><ul><li><a href="#subnets" class="table-of-contents__link toc-highlight">Subnets</a></li><li><a href="#route-tables" class="table-of-contents__link toc-highlight">Route tables</a></li><li><a href="#network-acls" class="table-of-contents__link toc-highlight">Network ACLs</a></li><li><a href="#security-groups" class="table-of-contents__link toc-highlight">Security Groups</a></li><li><a href="#gateways" class="table-of-contents__link toc-highlight">Gateways</a></li><li><a href="#vpc-endpoints" class="table-of-contents__link toc-highlight">VPC endpoints</a></li><li><a href="#flow-logs" class="table-of-contents__link toc-highlight">Flow logs</a></li></ul></li><li><a href="#default-vpc-configuration" class="table-of-contents__link toc-highlight">Default VPC configuration</a></li><li><a href="#reference-links" class="table-of-contents__link toc-highlight">Reference links</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023 TrussWorks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5460b823.js"></script>
<script src="/assets/js/main.f254410f.js"></script>
</body>
</html>