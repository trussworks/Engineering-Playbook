<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-infrasec/aws/sns-guardduty-alert-integrations">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Using SNS, GuardDuty, and External Integrations with AWS Organizations | Truss Engineering Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.truss.dev/docs/infrasec/aws/sns-guardduty-alert-integrations"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Using SNS, GuardDuty, and External Integrations with AWS Organizations | Truss Engineering Playbook"><meta data-rh="true" name="description" content="Ideally our infrastructure is flawless and impenetrable, but much of our work requires us to be aware of unexpected occurrences. We rely on a system using a number of AWS resources and services such as SNS, GuardDuty, and CloudWatch with external integrations such as Slack and PagerDuty to allow us to stay alert and aware of unforeseen or suspicious activity. This primer should describe our recommended current set up and allow you to set up your own system to achieve similar results. Please familiarize yourself with Truss&#x27; conception of AWS Organizations before proceeding."><meta data-rh="true" property="og:description" content="Ideally our infrastructure is flawless and impenetrable, but much of our work requires us to be aware of unexpected occurrences. We rely on a system using a number of AWS resources and services such as SNS, GuardDuty, and CloudWatch with external integrations such as Slack and PagerDuty to allow us to stay alert and aware of unforeseen or suspicious activity. This primer should describe our recommended current set up and allow you to set up your own system to achieve similar results. Please familiarize yourself with Truss&#x27; conception of AWS Organizations before proceeding."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://playbook.truss.dev/docs/infrasec/aws/sns-guardduty-alert-integrations"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/infrasec/aws/sns-guardduty-alert-integrations" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/infrasec/aws/sns-guardduty-alert-integrations" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5fb1e4a1.css">
<link rel="preload" href="/assets/js/runtime~main.29b85d7b.js" as="script">
<link rel="preload" href="/assets/js/main.8ec32cdf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Engineering Playbook</b></a><a class="navbar__item navbar__link" href="/docs">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/practices">Practices</a><a class="navbar__item navbar__link" href="/docs/incident-response">Incident Response</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trussworks/Engineering-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/practices">Engineering Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/appeng">AppEng</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/infrasec">InfraSec</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec">InfraSec Practice</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/adrs">ADRs</a><button aria-label="Toggle the collapsible sidebar category &#x27;ADRs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/alert-providers">Alert Providers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/ansible">Ansible</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/infrasec/aws">AWS</a><button aria-label="Toggle the collapsible sidebar category &#x27;AWS&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/aws-organizations">AWS Organizations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/aws/govcloud">Working in GovCloud</a><button aria-label="Toggle the collapsible sidebar category &#x27;Working in GovCloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/guardduty">GuardDuty for Organizations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/naming">Naming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/org-bootstrap">Bootstrapping an AWS Organization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/infrasec/aws/sns-guardduty-alert-integrations">Using SNS, GuardDuty, and External Integrations with AWS Organizations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/sns-topics">SNS Topics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/aws/vpcs">VPC Configuration</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/book-club">Book Club</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/bootstrap">Project Bootstrap Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/certs">SSL Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/charter">InfraSec Practice Charter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/ci_cd">CI/CD according to Truss</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/good-infra">Good Infrastructure - A Philosophy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/pro-dev">Professional Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/teardown">Project Teardown Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/terraform">Terraform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Terraform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">InfraSec</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/infrasec/aws"><span itemprop="name">AWS</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Using SNS, GuardDuty, and External Integrations with AWS Organizations</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Using SNS, GuardDuty, and External Integrations with AWS Organizations</h1><p>Ideally our infrastructure is flawless and impenetrable, but much of our work requires us to be aware of unexpected occurrences. We rely on a system using a number of AWS resources and services such as SNS, GuardDuty, and CloudWatch with external integrations such as Slack and PagerDuty to allow us to stay alert and aware of unforeseen or suspicious activity. This primer should describe our recommended current set up and allow you to set up your own system to achieve similar results. Please familiarize yourself with <a href="/docs/infrasec/aws/aws-organizations">Truss&#x27; conception of AWS Organizations</a> before proceeding.</p><p>Our intent is to have a system which notifies regarding GuardDuty events on two integration channels (PagerDuty and Slack), depending on the kind of alert.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="information-flow">Information Flow<a href="#information-flow" class="hash-link" aria-label="Direct link to Information Flow" title="Direct link to Information Flow">​</a></h2><p><img loading="lazy" alt="SNS Information Flow" src="/assets/images/sns-info-flow-52b035cbb1d2ffcd8616b3dfc367aef7.png" width="812" height="273" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guardduty-organizational-setup">GuardDuty Organizational Setup<a href="#guardduty-organizational-setup" class="hash-link" aria-label="Direct link to GuardDuty Organizational Setup" title="Direct link to GuardDuty Organizational Setup">​</a></h2><p>Using GuardDuty with AWS Organizations allows us to designate an administrative account to &quot;roll up&quot; all findings for member accounts, aggregating findings in one place. <a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_organizations.html" target="_blank" rel="noopener noreferrer">This is a user guide</a> that may provide helpful background information, although we do this in Terraform code. You should set up a GuardDuty detector in your GuardDuty administrative account and invite all the other accounts in your organization as members. Please refer to <a href="https://github.com/trussworks/terraform-layout-example" target="_blank" rel="noopener noreferrer">Truss&#x27; example of an organization account layout</a> for more info. Make sure to enable a GuardDuty detector in the region you will have SNS subscriptions by using the <code>aws_guardduty_detector</code> resource in your GuardDuty administrative account. Use <a href="/docs/infrasec/aws/guardduty">Truss&#x27; GuardDuty for Organizations Guide</a> to help with the set up.</p><p>We do not suggest setting this up in your <code>org-root</code> account, as that should not be used for frequent access. Instead, set it up in whichever account you use to handle org-wide infrastructure (for this example, we&#x27;ll call that <code>infrasec</code>).</p><p>The way GuardDuty fits into the org structure will likely look something like the structure below. Remember, though, you do not have to include any terraform resources for GuardDuty in member accounts.</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">├──project-org-root</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   ├── admin-global</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   │   └── GuardDuty member account</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   └── bootstrap</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">└── project-id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   ├── admin-global</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   │   └── GuardDuty member account</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   └── bootstrap</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">└── project-infrasec</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   ├── admin-global</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   │   └── GuardDuty Administrative account</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">│   └── bootstrap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will need to set up a detector, designate an admin account, and create configuration with member OUs in each region you intend to use GuardDuty for.</p><p>In the org-root account:</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_guardduty_organization_admin_account&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  depends_on = [aws_organizations_organization.main]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  admin_account_id = aws_organizations_account.infrasec.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the GuardDuty administrative account:</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_guardduty_detector&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  enable = true</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_guardduty_organization_configuration&quot; &quot;main&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  auto_enable = true</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  detector_id = aws_guardduty_detector.main.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_guardduty_member&quot; &quot;project_environment&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  account_id                 = aws_organizations_account.project_environment.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  detector_id                = aws_guardduty_detector.main.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  email                      = aws_organizations_account.project_environment.email</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  invite                     = false</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  disable_email_notification = true</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sns-topics">SNS Topics<a href="#sns-topics" class="hash-link" aria-label="Direct link to SNS Topics" title="Direct link to SNS Topics">​</a></h2><p><a href="https://docs.aws.amazon.com/sns/latest/dg/welcome.html" target="_blank" rel="noopener noreferrer">Here&#x27;s a primer</a> on how SNS works to familiarize you with vocabulary.</p><p>Set up the SNS topics. Please review <a href="/docs/infrasec/aws/sns-topics">this doc</a> to understand the organization structure we&#x27;re using.</p><p>The SNS topics and related policy documents should live in the <code>admin-global</code> stack of whichever AWS account you are using for your GuardDuty administrative account in whatever regions you&#x27;re planning to set up your GuardDuty detectors in. In our example, <code>project-infrasec/admin-global</code>, <code>us-west-2</code>.</p><p>If you plan to make SNS topics outside your default region, you will need to create a provider aliased for the region and pass that to the <code>aws_sns_topic</code> resource (example below).</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">data &quot;aws_iam_policy_document&quot; &quot;team_notification_region_policy&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  policy_id = &quot;__default_policy_ID&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  statement {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    sid = &quot;general_policy&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    actions = [</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:Subscribe&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:SetTopicAttributes&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:RemovePermission&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:Receive&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:Publish&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:ListSubscriptionsByTopic&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:GetTopicAttributes&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:DeleteTopic&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:AddPermission&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    condition {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      test     = &quot;StringEquals&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      variable = &quot;AWS:SourceOwner&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      values = [</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        &quot;${data.aws_caller_identity.current.account_id}&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    effect = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    principals {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      type        = &quot;AWS&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      identifiers = [&quot;*&quot;]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    resources = [</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;arn:aws:sns:region:${data.aws_caller_identity.current.account_id}:team-notification&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  statement {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    sid = &quot;allow_cw&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    actions = [</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;sns:Publish&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    effect = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    principals {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      type        = &quot;Service&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      identifiers = [&quot;events.amazonaws.com&quot;]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    resources = [</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      &quot;arn:aws:sns:region:${data.aws_caller_identity.current.account_id}:team-notification&quot;,</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_sns_topic&quot; &quot;team_notification_region&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  name     = &quot;team-notification&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  provider = aws.region</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  policy   = data.aws_iam_policy_document.team_notification_region_policy.json</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sns-subscriptions">SNS Subscriptions<a href="#sns-subscriptions" class="hash-link" aria-label="Direct link to SNS Subscriptions" title="Direct link to SNS Subscriptions">​</a></h2><p>Each SNS topic should have one or more subscriptions. There are a <a href="https://docs.aws.amazon.com/sns/latest/api/API_Subscribe.html" target="_blank" rel="noopener noreferrer">number of protocols</a> that can be used for a subscription endpoint. Our setup uses Email, HTTPS, and Lambda protocols.</p><p>We set up these subscriptions in a number of ways, depending on the integration. If you are using the model of SNS Topics indicated above, your alert topic will have 2 subscriptions (Slack and PagerDuty), while your notification topic will have just 1 (Slack).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="special-consideration-for-email-protocol-072020">Special consideration for email protocol (07/2020)<a href="#special-consideration-for-email-protocol-072020" class="hash-link" aria-label="Direct link to Special consideration for email protocol (07/2020)" title="Direct link to Special consideration for email protocol (07/2020)">​</a></h3><p>Terraform doesn&#x27;t support email protocol, so any subscription to email will be set up manually. We do record these as commented out terraform code in our repos.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ssm-parameters">SSM Parameters<a href="#ssm-parameters" class="hash-link" aria-label="Direct link to SSM Parameters" title="Direct link to SSM Parameters">​</a></h3><p>To integrate with PagerDuty and Slack, you will need to generate API keys. For Slack, you&#x27;ll have to set up an <a href="https://my.slack.com/services/new/incoming-webhook/" target="_blank" rel="noopener noreferrer">incoming webhook</a>. With PagerDuty, you&#x27;ll have to <a href="https://support.pagerduty.com/docs/generating-api-keys" target="_blank" rel="noopener noreferrer">create an API key</a>.</p><p>We recommend storing these keys in <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank" rel="noopener noreferrer">SSM Parameter Store</a> as secure strings. We prefix our keys with the stacks they live since there may be more than one key per account. Then you can refer to them in your code without revealing their contents:</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">data &quot;aws_ssm_parameter&quot; &quot;pagerduty_api_key&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  name = &quot;admin_global/pagerduty_api_key&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="slack-integration">Slack Integration<a href="#slack-integration" class="hash-link" aria-label="Direct link to Slack Integration" title="Direct link to Slack Integration">​</a></h2><p>We use this <a href="https://registry.terraform.io/modules/terraform-aws-modules/notify-slack/aws" target="_blank" rel="noopener noreferrer">notify-slack module</a>. It allows you to either create or pass in an SNS topic and then creates an AWS Lambda to send Slack notifications. Our implementation favors creating SNS topics on our own so we can set the topics&#x27; policies. Create an instance of this module for each of the topics you have created that you want to use for a Slack notification, in each region and account you want that topic and notification to exist. Since we&#x27;re using GuardDuty with Organizations, we&#x27;re expecting GuardDuty incidents to bubble up to the <code>orgname-infrasec</code> account. That means that for GuardDuty, we only need to set up the slack integration in that delegated administrator account.</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">module &quot;slack_team_notification_region&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  providers = {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    aws  = aws.region</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    null = null</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  source  = &quot;terraform-aws-modules/notify-slack/aws&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  version = &quot;~&gt; 3.0.0&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  lambda_function_name = local.region_team_notification_lambda_function_name</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  create_sns_topic     = false</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  sns_topic_name       = local.region_team_notification_sns_topic_name</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  slack_webhook_url = data.aws_ssm_parameter.slack_webhook.value</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  slack_username    = local.region_team_notification_username</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  slack_channel     = local.region_team_notification_channel</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="special-consideration-for-broken-lambdas-072020">Special consideration for broken lambdas (07/2020)<a href="#special-consideration-for-broken-lambdas-072020" class="hash-link" aria-label="Direct link to Special consideration for broken lambdas (07/2020)" title="Direct link to Special consideration for broken lambdas (07/2020)">​</a></h3><p>If a lambda is broken, it cannot self-report the break. This is relevant for this set up because we use the <code>notify-slack</code> module, which includes a lambda. We get around this issue by making a &quot;failover&quot; SNS topic in each region of interest. We create a <code>aws_cloudwatch_metric_alarm</code> to report when the lambda itself fails. You should make an instance of this alarm for every instance of the <code>notify-slack</code> module (or other lambdas).</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_cloudwatch_metric_alarm&quot; &quot;slack_team_notification_region_error&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  provider = aws.region</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  alarm_name        = &quot;slack-team-notification-region-error&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  alarm_description = &quot;This metric monitors lambda invocation failures&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  comparison_operator = &quot;GreaterThanOrEqualToThreshold&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  evaluation_periods  = &quot;2&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  metric_name         = &quot;Errors&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  namespace           = &quot;notify-slack-notifications&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  period              = &quot;300&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  statistic           = &quot;Average&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  threshold           = &quot;1&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  alarm_actions = [aws_sns_topic.failover_region.arn]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pagerduty-organizational-setup">PagerDuty Organizational Setup<a href="#pagerduty-organizational-setup" class="hash-link" aria-label="Direct link to PagerDuty Organizational Setup" title="Direct link to PagerDuty Organizational Setup">​</a></h2><p>Using PagerDuty with AWS Organizations allows us to set organization-wide service schedules, escalation policies, and users. These resources will live in a PagerDuty stack in your organizational infrastructure account. You will need to create an API key to use anywhere you are implementing a PagerDuty provider. You can do this in the PagerDuty console and store it in the appropriate AWS account&#x27;s parameter store.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pagerduty-integration">PagerDuty Integration<a href="#pagerduty-integration" class="hash-link" aria-label="Direct link to PagerDuty Integration" title="Direct link to PagerDuty Integration">​</a></h2><p>Once you have created those resources, you can create a PagerDuty provider to create resources on PagerDuty. You&#x27;ll refer to your <code>pagerduty_api_key</code> that you stored in Parameter Store here.</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">provider &quot;pagerduty&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  version = &quot;~&gt; 1.7.4&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  token   = data.aws_ssm_parameter.pagerduty_api_key.value</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once you have a PagerDuty provider, you can create PagerDuty services for each unit you want alerts on. We decided to split by team--so there is a service for the app team and one for the infra team. Be aware: you do not need a service for each AWS account! You should keep the <code>pagerduty_service_integration</code> resources in the same place as you put the the PagerDuty team services.</p><p>Create a <code>pagerduty_service_integration</code> for each of the AWS services you&#x27;d like to get PagerDuty alerts on. In this case, we have set up integrations for CloudWatch and of course, GuardDuty. Once you have created those integrations, you should create <code>aws_sns_topic_subscription</code> linking the subscription endpoint to the service integration you just set up. This will read something like <code>&quot;https://events.pagerduty.com/integration/${pagerduty_service_integration.guardduty.integration_key}/enqueue&quot;</code>. You will only have these in the AWS account where you expect alerts to go off--your GuardDuty designated admin account (i.e. <code>orgname-infrasec</code>). Only add subscriptions elsewhere if you have other integration alerts such as CloudWatch.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="integration">Integration<a href="#integration" class="hash-link" aria-label="Direct link to Integration" title="Direct link to Integration">​</a></h3><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">data &quot;pagerduty_vendor&quot; &quot;guardduty&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  name = &quot;GuardDuty&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;pagerduty_service_integration&quot; &quot;guardduty&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  name    = &quot;GuardDuty - team env cloud&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  service = pagerduty_service.team_account.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  vendor  = data.pagerduty_vendor.guardduty.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subscription">Subscription<a href="#subscription" class="hash-link" aria-label="Direct link to Subscription" title="Direct link to Subscription">​</a></h3><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;aws_sns_topic_subscription&quot; &quot;guardduty_team_notification_region&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  provider = aws.region</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  topic_arn              = &quot;arn:aws:sns:region:${data.aws_caller_identity.current.account_id}:sns_topic_name&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  protocol               = &quot;https&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  endpoint               = &quot;https://events.pagerduty.com/integration/${pagerduty_service_integration.guardduty.integration_key}/enqueue&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  endpoint_auto_confirms = true</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pagerduty-slack-integration">PagerDuty Slack Integration<a href="#pagerduty-slack-integration" class="hash-link" aria-label="Direct link to PagerDuty Slack Integration" title="Direct link to PagerDuty Slack Integration">​</a></h2><p>You may also want PagerDuty to integrate with Slack, in order to create alerts from PagerDuty incidents on Slack and allow users to Acknowledge and Resolve incidents from Slack itself. You will most likely only create one extension per service, so we recommend putting them wherever the service is created.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extension">Extension<a href="#extension" class="hash-link" aria-label="Direct link to Extension" title="Direct link to Extension">​</a></h3><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">## Slack extension integration with pagerduty for app level alerts</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">data &quot;pagerduty_extension_schema&quot; &quot;slack-v2&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  name = &quot;Slack V2&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">resource &quot;pagerduty_extension&quot; &quot;slack-v2-service&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  name = &quot;slack v2 - team&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  extension_schema  = data.pagerduty_extension_schema.slack-v2.id</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  extension_objects = [pagerduty_service.team_account.id]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  # Ignore this configuration as the actual authorization must be done manually.</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  # See manual operations log in the README for details</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  config = null</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  lifecycle {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    ignore_changes = [config]</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You&#x27;re not quite done yet. PagerDuty does not actually authorize the link between the extension and Slack until you manually create it. Sign into PagerDuty and <a href="https://movemil.pagerduty.com/extensions" target="_blank" rel="noopener noreferrer">visit the extensions page</a>. Locate your new extension in the Service Extensions table and click on the gear button on the bottom right of the far-right Details cell for your extension. Select either the Re-authorize/Authorize or Edit option (they do the same thing) from the drop-down. Scroll down and select the channel you prefer under <code>Where should PagerDuty post?</code> then click &quot;Allow&quot;. You should see a notification appear in the channel you&#x27;ve selected in Slack that says &quot;<!-- -->[<!-- -->your name<!-- -->]<!-- --> added an integration to this channel: PagerDuty&quot;. Make sure to record that you&#x27;ve done this in your Manual Operations log. Note: You only need to create one extension per service rather than per environment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guardduty-tie-in">GuardDuty Tie-In<a href="#guardduty-tie-in" class="hash-link" aria-label="Direct link to GuardDuty Tie-In" title="Direct link to GuardDuty Tie-In">​</a></h2><p>At this point, you have SNS topics, notify-slack lambdas and therefore Slack subscriptions, PagerDuty subscriptions, and a Slack-PagerDuty extension. The final step is to tie everything to GuardDuty, the source of all these alerts!</p><p>Given that you have set up outside integrations, you will likely want to use the <a href="https://registry.terraform.io/modules/trussworks/guardduty-notifications/aws" target="_blank" rel="noopener noreferrer">TrussWorks GuardDuty Notifications</a> module. This module allows you to create the CloudWatch event targets for the SNS topic you are using for PagerDuty notifications and the SNS topic you are using for Slack notifications. These must be two separate topics, as they are formatted differently. Given <a href="/docs/infrasec/aws/sns-topics">this setup</a>, we used the <code>team-type-notification</code> SNS topic for Slack and the <code>team-type-alert</code> topic for PagerDuty. Note, this assumes you&#x27;ve already enabled a GuardDuty detector in the region with your SNS topics. You will need to implement an instance of the <code>guardduty_notifications</code> module for each region you expect to receive GuardDuty notifications from.</p><div class="language-hcl codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-hcl codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">module &quot;guardduty_notifications&quot; {</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  source  = &quot;trussworks/guardduty-notifications/aws&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  version = &quot;3.0.1&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  sns_topic_slack     = aws_sns_topic.slack</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  sns_topic_pagerduty = aws_sns_topic.pagerduty</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-note-about-root-login-notification">A note about root login notification<a href="#a-note-about-root-login-notification" class="hash-link" aria-label="Direct link to A note about root login notification" title="Direct link to A note about root login notification">​</a></h2><p>We&#x27;ve taken care to manage our team members&#x27; account access to avoid root users. So if someone is logging into accounts as a root user, we want a notification. We can only set alerts for this scenario in <code>us-east-1</code> because that is the default region on root login. Therefore, we replicate the SNS topics and subscriptions that we might otherwise only have in <em>our</em> default region in <code>us-east-1</code> to enable this notification flow. <a href="https://aws.amazon.com/blogs/mt/monitor-and-notify-on-aws-account-root-user-activity/" target="_blank" rel="noopener noreferrer">Here&#x27;s a helpful reader about this scenario from AWS</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-your-work">Testing your work<a href="#testing-your-work" class="hash-link" aria-label="Direct link to Testing your work" title="Direct link to Testing your work">​</a></h2><p>Once you&#x27;ve done all of this set up, you&#x27;ll want to test your work! GuardDuty is a black box, but there&#x27;s an easy way to generate findings by using AWS&#x27; <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/guardduty/create-sample-findings.html" target="_blank" rel="noopener noreferrer"><code>create-sample-findings</code></a> command. First figure out the detector ID for your current account by using <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/guardduty/list-detectors.html" target="_blank" rel="noopener noreferrer"><code>list-detectors</code></a>. Then create a sample finding for that detector. Detectors and the <code>create-sample-finding</code> command will both be region-specific. You will likely want to generate just one finding at a time. You can find the <a href="https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html" target="_blank" rel="noopener noreferrer">finding types here</a>. Create a sample finding in each member account and each region of interest. These findings will appear both in the account in which they were created AND in the GuardDuty administrative account you&#x27;ve designated. The finding will create a notification in Slack and a PagerDuty incident, which will also notify in Slack.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">aws guardduty list-detectors --region us-east-1</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">aws guardduty create-sample-findings --detector-id XXXXXXXXXXXXXXXXXX --region us-east-1 --finding-types PrivilegeEscalation:IAMUser/AdministrativePermissions</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-resolverespond-to-guardduty-findings">How to Resolve/Respond to GuardDuty Findings<a href="#how-to-resolverespond-to-guardduty-findings" class="hash-link" aria-label="Direct link to How to Resolve/Respond to GuardDuty Findings" title="Direct link to How to Resolve/Respond to GuardDuty Findings">​</a></h2><p>When an alert occurs and you are notified via PagerDuty or Slack, you&#x27;ll have to respond.</p><ol><li>Immediately Acknowledge the finding, which you can do via the PagerDuty app, website, or Slack integration.</li><li>Once you&#x27;ve found a resolution for the incident, you should Resolve it (which again you can do via app, site, or on Slack).</li><li>Archive the relevant GuardDuty finding using the AWS Console. Because you&#x27;ve set your <code>infrasec</code> as the administrative account for GuardDuty, all  findings for member accounts &quot;roll up&quot; there. Depending on whether the alerts are in the GovCloud or Commercial space, that will be either the <code>project-com-infrasec</code> or <code>project-gov-infrasec</code> account. Make sure you are in the correct region (either <code>us-west-2</code> or <code>us-east-1</code>, depending on where the alert fired). Confirm the alert you are archiving fired in the account you expected by checking the <code>Account ID</code> column in the Findings table.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/aws/sns-guardduty-alert-integrations.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/infrasec/aws/org-bootstrap"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Bootstrapping an AWS Organization</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/infrasec/aws/sns-topics"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SNS Topics</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#information-flow" class="table-of-contents__link toc-highlight">Information Flow</a></li><li><a href="#guardduty-organizational-setup" class="table-of-contents__link toc-highlight">GuardDuty Organizational Setup</a></li><li><a href="#sns-topics" class="table-of-contents__link toc-highlight">SNS Topics</a></li><li><a href="#sns-subscriptions" class="table-of-contents__link toc-highlight">SNS Subscriptions</a><ul><li><a href="#special-consideration-for-email-protocol-072020" class="table-of-contents__link toc-highlight">Special consideration for email protocol (07/2020)</a></li><li><a href="#ssm-parameters" class="table-of-contents__link toc-highlight">SSM Parameters</a></li></ul></li><li><a href="#slack-integration" class="table-of-contents__link toc-highlight">Slack Integration</a><ul><li><a href="#special-consideration-for-broken-lambdas-072020" class="table-of-contents__link toc-highlight">Special consideration for broken lambdas (07/2020)</a></li></ul></li><li><a href="#pagerduty-organizational-setup" class="table-of-contents__link toc-highlight">PagerDuty Organizational Setup</a></li><li><a href="#pagerduty-integration" class="table-of-contents__link toc-highlight">PagerDuty Integration</a><ul><li><a href="#integration" class="table-of-contents__link toc-highlight">Integration</a></li><li><a href="#subscription" class="table-of-contents__link toc-highlight">Subscription</a></li></ul></li><li><a href="#pagerduty-slack-integration" class="table-of-contents__link toc-highlight">PagerDuty Slack Integration</a><ul><li><a href="#extension" class="table-of-contents__link toc-highlight">Extension</a></li></ul></li><li><a href="#guardduty-tie-in" class="table-of-contents__link toc-highlight">GuardDuty Tie-In</a></li><li><a href="#a-note-about-root-login-notification" class="table-of-contents__link toc-highlight">A note about root login notification</a></li><li><a href="#testing-your-work" class="table-of-contents__link toc-highlight">Testing your work</a></li><li><a href="#how-to-resolverespond-to-guardduty-findings" class="table-of-contents__link toc-highlight">How to Resolve/Respond to GuardDuty Findings</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023 TrussWorks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.29b85d7b.js"></script>
<script src="/assets/js/main.8ec32cdf.js"></script>
</body>
</html>