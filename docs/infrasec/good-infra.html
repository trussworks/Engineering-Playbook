<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-infrasec/good-infra" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Good Infrastructure - A Philosophy | Truss Engineering Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.truss.dev/docs/infrasec/good-infra"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Good Infrastructure - A Philosophy | Truss Engineering Playbook"><meta data-rh="true" name="description" content="While the tools, techniques, and patterns we use to build our solutions are important, they often don&#x27;t help us design and architect new things. What follows are some opinions about how to think about the work we do at a high level."><meta data-rh="true" property="og:description" content="While the tools, techniques, and patterns we use to build our solutions are important, they often don&#x27;t help us design and architect new things. What follows are some opinions about how to think about the work we do at a high level."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://playbook.truss.dev/docs/infrasec/good-infra"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/infrasec/good-infra" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/infrasec/good-infra" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2ca6eb06.css">
<link rel="preload" href="/assets/js/runtime~main.1b7e5a17.js" as="script">
<link rel="preload" href="/assets/js/main.61283db9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Engineering Playbook</b></a><a class="navbar__item navbar__link" href="/docs">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/practices">Practices</a><a class="navbar__item navbar__link" href="/docs/incident-response">Incident Response</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trussworks/Engineering-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/practices">Engineering Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/appeng">AppEng</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/infrasec">InfraSec</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec">InfraSec Practice</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/adrs">ADRs</a><button aria-label="Toggle the collapsible sidebar category &#x27;ADRs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/alert-providers">Alert Providers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/ansible">Ansible</a><button aria-label="Toggle the collapsible sidebar category &#x27;Ansible&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/aws">AWS</a><button aria-label="Toggle the collapsible sidebar category &#x27;AWS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/book-club">Book Club</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/bootstrap">Project Bootstrap Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/certs">SSL Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/charter">InfraSec Practice Charter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/ci_cd">CI/CD according to Truss</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/delivery-pipeline">Standard Delivery Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/infrasec/good-infra">Good Infrastructure - A Philosophy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/pro-dev">Professional Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/infrasec/teardown">Project Teardown Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/terraform">Terraform</a><button aria-label="Toggle the collapsible sidebar category &#x27;Terraform&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/infrasec/tutorials">Tutorials</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tutorials&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">InfraSec</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Good Infrastructure - A Philosophy</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Good Infrastructure - A Philosophy</h1><p>While the tools, techniques, and patterns we use to build our solutions are important, they often don&#x27;t help us design and architect new things. What follows are some opinions about how to think about the work we do at a high level.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="human-factors">Human factors<a href="#human-factors" class="hash-link" aria-label="Direct link to Human factors" title="Direct link to Human factors">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="empathy">Empathy<a href="#empathy" class="hash-link" aria-label="Direct link to Empathy" title="Direct link to Empathy">​</a></h3><blockquote><p>Without establishing shared expectations and coherent communication frameworks, your tools will be instruments of chaos.</p><p>-- <a href="https://guide.truss.works/docs/distributed/#tools-last" target="_blank" rel="noopener noreferrer">Truss Distributed Playbook: Tools Last</a></p></blockquote><p>InfraSec work is first and foremost a human endeavour. Every aspect of what we do is for other people. We build software for other developers. We deliver reliable infrastructure to meet the needs of the users. We automate systems and write documentation to ease the burden on our future selves and those who come after.</p><p>Empathy drives our research into the tooling we build for others. It helps us make good decisions about the operating controls we create for our software. The better our environments are to work in, the less stress we&#x27;ll have and the easier it will feel to do our job. It creates trust in the system of people and tooling we are surrounded by.</p><p>We believe diverse voices result in better solutions. As such, we strive to have diverse voices.</p><p>We believe folks decisions are driven by the systems they are in. As such, we strive to improve the systems we work within.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="operator-first">Operator first<a href="#operator-first" class="hash-link" aria-label="Direct link to Operator first" title="Direct link to Operator first">​</a></h3><p>Our industry continues to use the phrase &quot;ship it&quot;, as if we&#x27;re sending off a physical disk to a store or customer. This has not been the case for a while now. For the most part, we&#x27;re building and running services. The people we are shipping the software to are ourselves. There are customer endpoints (e.g., the website, the API), but the customer isn&#x27;t running those, we are.</p><p>When building a service, we must avoid thinking exclusively about the happy path customer experience and instead give time and attention to the operating controls and gauges we need to run the service. It&#x27;s like we&#x27;re tasked to build a commercial aircraft and our &quot;user&quot; stories focus on seating,  entertainment, and snack options. Things our customers will need or like so they can have a good in-flight experience. These are important, but rather moot if the aircraft cannot make it to the destination.</p><p>Operator first thinking means we consistently consider the experience of the operator of the service as part of the design and architecture. It treats the system operator as a first class user. We should expect user stories about observability, resilience, automation, and tooling. We will build systems which fail less often, less catastrophically, and when they do, are more readily diagnosed and repaired. The outcome is a more humane organization spending less time in high-stress, service degradation scenarios and more time on high-value, creative work.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="minimalism">Minimalism<a href="#minimalism" class="hash-link" aria-label="Direct link to Minimalism" title="Direct link to Minimalism">​</a></h2><p>Minimalist infrastructure is the practice of building only what you need with the fewest number of resources. This is a philosophy, not a religion: don&#x27;t build bad infrastructure to achieve a minimalist design. A minimalist design should lead to good infrastructure by reducing the complexity of the design and the number of resources being managed. A simpler system with less resources has a smaller attack surface and is easier for people to learn and debug.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoid-state">Avoid state<a href="#avoid-state" class="hash-link" aria-label="Direct link to Avoid state" title="Direct link to Avoid state">​</a></h3><p>When designing your system, avoid storing additional state. Often the data you want to store is already available in the system. Using the system as the source of truth can avoid the difficult business of ensuring data consistency.</p><table><thead><tr><th>Practical Example</th></tr></thead><tbody><tr><td>Let&#x27;s say you want to be able to rollback a Fargate deploy if the new task definition results in a service that won&#x27;t become healthy. One option would be store the working task definition in something like DynamoDB (or git or any number of bad choices). However, your ECS service already has this information: the previous, healthy service is still running. Instead of managing a DynamoDB resource as well as writing code for maintaining that state record, query the ECS service itself to get what you want. This avoids managing the DynamoDB resource as well as the unfortunate scenario where the data stored is wrong.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="embrace-immutability">Embrace immutability<a href="#embrace-immutability" class="hash-link" aria-label="Direct link to Embrace immutability" title="Direct link to Embrace immutability">​</a></h3><p>Related to avoiding state, making resources immutable reduces the scope of what can change. The less that can change, the easier a system is to understand and debug and the more likely that each instance will behave as expected. Reduce systems and architectures  to testable units.</p><p>As an illustration, consider the complexity difference between a read-only, distroless, container image with a single application binary and a long-lived VM that&#x27;s updated with the latest application code and it&#x27;s dependency tree. How confident are you in each system? How confident are you that prod and dev are similar? What does a delivery pipeline look like for each?</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-managed-services">Use managed services<a href="#use-managed-services" class="hash-link" aria-label="Direct link to Use managed services" title="Direct link to Use managed services">​</a></h3><p>Manage only what you must. There are lot of services out there that solve infrastructure problems for us. For example, AWS Fargate makes it so you don&#x27;t have to manage EC2 instances running your containers. This is good. Make managing infrastructure someone else&#x27;s problem (you&#x27;ve got plenty). Build and maintain the least amount possible.</p><p>Examples:</p><ul><li>Parameter Store instead of Hashicorp Vault</li><li>Fargate instead of EC2</li><li>SaaS instead of on-premise</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="codify-entire-stacks">Codify entire stacks<a href="#codify-entire-stacks" class="hash-link" aria-label="Direct link to Codify entire stacks" title="Direct link to Codify entire stacks">​</a></h3><p>Codify entire stacks into a single callable unit (calling into other units). Keep the number of parameterizations (inputs) small so the infrastructure doesn&#x27;t vary wildly and the unit&#x27;s actions remain clear. This makes it easy to spin up the same infrastructure in multiple environments and reduces the proliferation of code unique to each environment.</p><p>Care should be given to not hardcode environmental assumptions into this wrapper. Follow the same notions for building a <a href="#the-twelve-factor-app">Twelve-Factor App</a>. The callable stack is our version of a deployable artifact.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="delivery">Delivery<a href="#delivery" class="hash-link" aria-label="Direct link to Delivery" title="Direct link to Delivery">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="infrastructure-as-code">Infrastructure as code<a href="#infrastructure-as-code" class="hash-link" aria-label="Direct link to Infrastructure as code" title="Direct link to Infrastructure as code">​</a></h3><p>We strive to codify all our work in a manner that is repeatable, versioned, and tested. To that end, we write as much of our infrastructure as declarative code (e.g., Terraform), automated scripts, and reusable tools. Necessary, ad-hoc steps (e.g., secret generation) are stored in &quot;manual operations&quot; logs.</p><p>We prefer declarative frameworks (e.g., Terraform) over imperative ones. While it can be frustrating to work in a system that lacks robust flow control, we believe the complexity costs associated with a &quot;real&quot; programming language outweigh the benefits for adoption: the ability to be &quot;clever&quot; too easily leads to infrastructure code that&#x27;s difficult learn and adapt (i.e., rearchitect) over time.</p><p>One of the goals for codifying infrastructure as code is having the ability to spin up new environments quickly. This process should be gated by the time it takes the cloud provider to make the resources available. If manual operations are the bottleneck, we&#x27;re likely missing code.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automation">Automation<a href="#automation" class="hash-link" aria-label="Direct link to Automation" title="Direct link to Automation">​</a></h3><p>One of the primary goals of creating infrastructure as code is enabling automation. When we automate our infrastructure we are able to repeat our structures in consistent ways. We can create reusable, testable, units of functionality. We can <a href="https://landing.google.com/sre/workbook/chapters/eliminating-toil/" target="_blank" rel="noopener noreferrer">⎋eliminate toil</a> and focus our energies on creative problem solving.</p><p>Like other mechanisms, the automation must be run regularly to ensure it&#x27;s functional. This can usually be achieved via CI/CD. For automation that&#x27;s expensive (in time, in money, etc.) and infrequently used, you could setup an automated, scheduled test, to ensure functionality.</p><table><thead><tr><th>Practical Example</th></tr></thead><tbody><tr><td>We should be able to spin up additional environments without much fanfare. Since these environments can require resources which take a long time to become available (e.g., an RDS) it may not be feasible to include creating a new environment as part of the CI/CD pipeline. An alternative would be to setup a daily (or weekly) job that spins up a new environment. This attempts to strike the balance between fast (enough) feedback about that process with keeping the pipeline (and getting other feedback) fast.<!-- -->[<!-- -->^1<!-- -->]</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="delivery-pipeline">Delivery pipeline<a href="#delivery-pipeline" class="hash-link" aria-label="Direct link to Delivery pipeline" title="Direct link to Delivery pipeline">​</a></h3><p><em><a href="/docs/infrasec/ci_cd">👀 See the Intro to CI/CD</a> for a deeper dive into this topic.</em></p><p>An effective delivery pipeline is important for creating a successful — organization-wide — delivery culture. This mechanism brings code from development into production, ties together the (technical and non-technical) teams, and enables the company to iterate quickly.</p><p>To achieve <em>continuous delivery</em> means you are always comfortable releasing the artifacts that have made it through the pipeline. To achieve <em>continuous deployment</em> means you have the utmost confidence in your automated processes.</p><p>At its barest, a delivery pipeline has three stages:</p><ol><li>Build</li><li>Accept</li><li>Release</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="build">Build<a href="#build" class="hash-link" aria-label="Direct link to Build" title="Direct link to Build">​</a></h4><p>A code commit should result in the creation of a deployable artifact whose code has been tested via a suite of (mostly) unit tests. Examples of artifacts: container image, binary, language package (e.g., Python wheel, Ruby gem, Rust crate), tarball, etc.</p><p>As this is the first stage in the pipeline, the quicker and more comprehensive the build and test processes are, the faster we can iterate. Catching problems here means not losing time to acceptance testing of a broken product and reduces the risk of an issue landing in production.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accept">Accept<a href="#accept" class="hash-link" aria-label="Direct link to Accept" title="Direct link to Accept">​</a></h4><p>The artifact produced by the build stage should be deployed and have acceptance tests run against it. The environment and procedures should be the same as production and the entire process should managed by the CI/CD system.</p><p>As much as possible, reduce your dependence on manual acceptance testing. Automated tests can be run at anytime. Manual testing introduces a significant delay to your feedback loop, reducing the speed of development:</p><ul><li>More context switching — While changes wait for validation, folks switch tasks. These switches are expensive as context has to be rebuilt, causing each task to take longer, and impacting team velocity.</li><li>More complex debugging — Changes are batched until the next manual test session. Instead of being able to pinpoint a bug to a small set of changes, there are now many changes and their interactions to consider. This increases the time it takes to debug a problem and creates an opportunity for incompatible changes to land together.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="release">Release<a href="#release" class="hash-link" aria-label="Direct link to Release" title="Direct link to Release">​</a></h4><p>In this final stage of the delivery pipeline, the fully tested and accepted artifact is released to the world using the same processes validated earlier in the pipeline.</p><p>Production releases should be a non-event with little ceremony. There is an inverse relationship between the frequency and risk of release. Compare the amount of change being introduced in each release if it&#x27;s done every hour versus every week.</p><p>In more sophisticated systems, where possible (e.g., web services), the code deploy and the feature release should be separated via feature flags.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="immutability">Immutability<a href="#immutability" class="hash-link" aria-label="Direct link to Immutability" title="Direct link to Immutability">​</a></h2><blockquote><p>The entropy of the universe tends to a maximum.</p><p>-- Rudolf Clausius, 1865</p></blockquote><p>Our systems tend to disorder over time. Worse, they do this in non-uniform ways. There are various mechanisms for helping long-lived systems stay in their expected states (e.g., orchestration), but it is somewhat of a fools errand since there&#x27;s always parts you aren&#x27;t tracking and stateful bits which are necessarily different. Include the will of an adversary to purposely change the system in a non-detectable way and you may begin questioning your career choices (or worse, stop caring).</p><p>As these systems drift, random errors occur which are difficult to reproduce. They were the result of complex set of factors which arose over time.<!-- -->[<!-- -->^2<!-- -->]<!-- --> More insidious, your environments (prod, ci, dev) will behave different from one another due to having different uptimes, deployment dates, patch schedules, etc. This leads to losing faith in your automated tests, slows down the delivery pipeline, and impacts work velocity.</p><p>Taking an immutable approach to your infrastructure helps limit the scope of changes that build up.</p><p>When we say a resource is immutable, we mean instead of updating it in place, we provision an entirely new version. For example, if we need to update the software on the system, instead of pulling new files to the running system we create a new disk image containing the changes we want our system to have and launch new ones.</p><p>Immutability is not a binary notion. Some amount of state (e.g., memory) must be changing in the system in order for it to run. We strive to find a balance around a usable system and the least amount of state.</p><table><thead><tr><th>Practical Example</th></tr></thead><tbody><tr><td>We consider short-lived containers to be table stakes. These boot from a known state (the container image), run a single process (or few), and are replaced often. A way to increase the immutability would be to use a read-only disk. This removes an entire class of system modification and brings awareness to the kind of data landing on disk.</td></tr></tbody></table><p>An effect of adopting an immutable architecture is being guided toward more minimal systems. Using the example above, since we boot frequently, we want fast boot times. Since we want fast boot times, we want small disk images that can transfer quickly over the network. The way to make the disk smaller is to remove as much as possible and we end up with distroless images which contain almost nothing besides a static binary. The more minimal, the less opportunity for drift.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-twelve-factor-app">The Twelve-Factor App<a href="#the-twelve-factor-app" class="hash-link" aria-label="Direct link to The Twelve-Factor App" title="Direct link to The Twelve-Factor App">​</a></h2><p>Build infrastructure in the spirit of and to support <a href="https://12factor.net/" target="_blank" rel="noopener noreferrer">⎋the Twelve-Factor methodology</a>. We should be architecting our delivery and deployment pipelines with this view and pushing back against changes which undermine this methodology.</p><p>[<!-- -->^1<!-- -->]<!-- -->: There&#x27;s no single strategy. Managing slow tests is complicated topic. You need to weigh the risks of getting slow feedback for each component to arrive at a place that feels comfortable.</p><p>[<!-- -->^2<!-- -->]<!-- -->: This hints at the limitations of doing &quot;root cause analysis&quot;.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/trussworks/Engineering-Playbook/edit/main/docs/infrasec/good-infra.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/infrasec/delivery-pipeline"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Standard Delivery Pipeline</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/infrasec/pro-dev"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Professional Development</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#human-factors" class="table-of-contents__link toc-highlight">Human factors</a><ul><li><a href="#empathy" class="table-of-contents__link toc-highlight">Empathy</a></li><li><a href="#operator-first" class="table-of-contents__link toc-highlight">Operator first</a></li></ul></li><li><a href="#minimalism" class="table-of-contents__link toc-highlight">Minimalism</a><ul><li><a href="#avoid-state" class="table-of-contents__link toc-highlight">Avoid state</a></li><li><a href="#embrace-immutability" class="table-of-contents__link toc-highlight">Embrace immutability</a></li><li><a href="#use-managed-services" class="table-of-contents__link toc-highlight">Use managed services</a></li><li><a href="#codify-entire-stacks" class="table-of-contents__link toc-highlight">Codify entire stacks</a></li></ul></li><li><a href="#delivery" class="table-of-contents__link toc-highlight">Delivery</a><ul><li><a href="#infrastructure-as-code" class="table-of-contents__link toc-highlight">Infrastructure as code</a></li><li><a href="#automation" class="table-of-contents__link toc-highlight">Automation</a></li><li><a href="#delivery-pipeline" class="table-of-contents__link toc-highlight">Delivery pipeline</a></li></ul></li><li><a href="#immutability" class="table-of-contents__link toc-highlight">Immutability</a></li><li><a href="#the-twelve-factor-app" class="table-of-contents__link toc-highlight">The Twelve-Factor App</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023 TrussWorks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1b7e5a17.js"></script>
<script src="/assets/js/main.61283db9.js"></script>
</body>
</html>