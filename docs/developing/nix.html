<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developing/nix/README" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">nix | Truss Engineering Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.truss.dev/docs/developing/nix"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="nix | Truss Engineering Playbook"><meta data-rh="true" name="description" content="EXPERIMENT"><meta data-rh="true" property="og:description" content="EXPERIMENT"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://playbook.truss.dev/docs/developing/nix"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/developing/nix" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/developing/nix" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2ca6eb06.css">
<link rel="preload" href="/assets/js/runtime~main.1b7e5a17.js" as="script">
<link rel="preload" href="/assets/js/main.b09dde9c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Engineering Playbook</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">About</a><a class="navbar__item navbar__link" href="/docs/practices">Practices</a><a class="navbar__item navbar__link" href="/docs/incident-response">Incident Response</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trussworks/Engineering-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Engineering Playbook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation/intro-to-docs">Introduction to Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation/adr">Architectural Decision Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation/external-resources">External Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/compliance">Federal Compliance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/developing">Developing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing">Tools and Practice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/bugs">Defects/Bugs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/code-reviews">Code Reviews</a><button aria-label="Toggle the collapsible sidebar category &#x27;Code Reviews&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/command-line-tools">Command Line Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Command Line Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cycle">Development Cycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/eid">Editors, IDEs and Debuggers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/growth">Growth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/healthcheck">Health Checks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/helpful-tools">Helpful Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helpful Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/languages">Programming Languages</a><button aria-label="Toggle the collapsible sidebar category &#x27;Programming Languages&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/learning">Learning Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Learning Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" tabindex="0" href="/docs/developing/nix">nix</a><button aria-label="Toggle the collapsible sidebar category &#x27;nix&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/nix/HOWTO">NIX HOWTO</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/open-source">Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/pairing">Pair Programming</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pair Programming&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/slack">Slack Best Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/technical-design">Technical Design</a><button aria-label="Toggle the collapsible sidebar category &#x27;Technical Design&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/vcs">Source Control</a><button aria-label="Toggle the collapsible sidebar category &#x27;Source Control&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/leadership">Leadership</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/web">Web Development</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developing</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">nix</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>nix</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="experiment">EXPERIMENT<a href="#experiment" class="hash-link" aria-label="Direct link to EXPERIMENT" title="Direct link to EXPERIMENT">​</a></h2><p>We are experimenting with using Nix for developer environments.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p>The <a href="https://nixos.org/manual/nix/stable/" target="_blank" rel="noopener noreferrer">nix package manager</a> is a
&quot;purely functional package manager&quot;. From that manual:</p><blockquote><p>This means that it treats packages like values in purely functional
programming languages such as Haskell — they are built by functions
that don’t have side-effects, and they never change after they have
been built.
...
You can have multiple versions or variants of a package installed at
the same time. This is especially important when different
applications have dependencies on different versions of the same
package
...
An important consequence is that operations like upgrading or
uninstalling an application cannot break other applications, since
these operations never “destructively” update or delete files that
are used by other packages.</p></blockquote><p>Nix is used to manage the dependencies of a project to ensure that
everyone is using the same version of all tools.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-nix-why-not-docker">Why Nix? Why not Docker?<a href="#why-nix-why-not-docker" class="hash-link" aria-label="Direct link to Why Nix? Why not Docker?" title="Direct link to Why Nix? Why not Docker?">​</a></h2><p>Docker for local development provides many of the same advantages of
nix: reproducible environments with strict versioning. However, docker
for development, while awesome in many ways, also has some downsides.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-of-docker">Advantages of Docker<a href="#advantages-of-docker" class="hash-link" aria-label="Direct link to Advantages of Docker" title="Direct link to Advantages of Docker">​</a></h3><p>The biggest downside of native development is that our deployments are
on Linux and it is possible for libraries and code paths to behave
differently on macOS than on Linux. We currently use native
development environments and haven&#x27;t really hit something severe yet,
so this is more of a theoretical concern for Truss projects right now.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-of-nix">Advantages of Nix<a href="#advantages-of-nix" class="hash-link" aria-label="Direct link to Advantages of Nix" title="Direct link to Advantages of Nix">​</a></h3><p>When doing local development using docker, you need to share your
mac filesystem with the docker container. Docker for mac has to keep
the files in sync between your mac and the docker container. That
synchronization has historically had poor performance. This means that
operations that access the filesystem inside docker are slow AND use
significant CPU. Running the same code outside the container is
sometimes 25-50% faster and that penalty is hard to swallow.</p><p>Using Docker for development also complicates committing code. When
using <a href="/docs/developing/vcs/tools">pre-commit</a> you need access to the development
environment when committing code. This means either running git inside
docker or trying to find a way to run your pre-commit hooks inside
docker.</p><p>Running git inside docker has problems because it makes using a hardware
device for code signing like a
<a href="/docs/infrasec/tutorials/yubikey-configuration">yubikey</a> much more
complicated and difficult.</p><p>Running pre-commit inside docker is not a supported configuration by
pre-commit which takes us even farther away from the well worn path.</p><p>Finally, configuring local tooling like editors to use the docker
development environment is generally much more complicated that
configuring it to use a native development environment.</p><p>For all of these reasons, a native development environment seems like
a less risky path forward.</p><p>Using Nix seems like a way to get almost all of the advantages of
docker and a native development environment.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="differences-with-homebrew">Differences with homebrew<a href="#differences-with-homebrew" class="hash-link" aria-label="Direct link to Differences with homebrew" title="Direct link to Differences with homebrew">​</a></h3><p>Homebrew has more packages than <code>nix</code>, and installs them globally. For
certain things, that might work great. However, that doesn&#x27;t give
projects reproducible installs.</p><p>One other difference is that versions of particular packages may be more
up to date in one or the other. E.g. as of this writing, homebrew&#x27;s
<code>watchman</code> version is <code>2021.06.07.00</code> but <code>nix</code> is on <code>4.9.0</code>, which is
from sometime in 2017 or 2018.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2><p>MacOS requires that we add an argument to the installation command. We also want to
do the single user installation. So to install, run:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token function" style="color:#b29762">sh</span><span class="token plain"> </span><span class="token operator" style="color:#063289">&lt;</span><span class="token punctuation" style="color:#b6ad9a">(</span><span class="token function" style="color:#b29762">curl</span><span class="token plain"> -L https://nixos.org/nix/install</span><span class="token punctuation" style="color:#b6ad9a">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See the <a href="https://nixos.org/manual/nix/stable/#sect-macos-installation" target="_blank" rel="noopener noreferrer">macOS installation</a>
instructions for more details.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting started<a href="#getting-started" class="hash-link" aria-label="Direct link to Getting started" title="Direct link to Getting started">​</a></h2><p>After installing <code>nix</code>, you should have <code>~/.nix-profile/bin</code> in your
PATH.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="quick-howto">Quick HOWTO<a href="#quick-howto" class="hash-link" aria-label="Direct link to Quick HOWTO" title="Direct link to Quick HOWTO">​</a></h3><p>For a template for how to set up a project see <a href="/docs/developing/nix/HOWTO">./HOWTO.md</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extra-setup-only-fish-shell-users">Extra Setup (Only Fish Shell Users)<a href="#extra-setup-only-fish-shell-users" class="hash-link" aria-label="Direct link to Extra Setup (Only Fish Shell Users)" title="Direct link to Extra Setup (Only Fish Shell Users)">​</a></h3><p>If you&#x27;re using the fish shell, check out
<a href="https://github.com/lilyball/nix-env.fish" target="_blank" rel="noopener noreferrer">nix-env.fish</a>.</p><p>Add this to your <code>~/.config/fish/config.sh</code></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">set -g fish_user_paths &quot;/Users/[your_os_username]/.nix-profile/bin&quot; $fish_user_paths</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-packages">Working With Packages<a href="#working-with-packages" class="hash-link" aria-label="Direct link to Working With Packages" title="Direct link to Working With Packages">​</a></h3><p>This is more of a quick overview, but more details can be found in the
<a href="https://nixos.org/manual/nix/stable/#ch-basic-package-mgmt" target="_blank" rel="noopener noreferrer">nix basic package management docs</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="installing-new-packages">Installing New Packages<a href="#installing-new-packages" class="hash-link" aria-label="Direct link to Installing New Packages" title="Direct link to Installing New Packages">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -i </span><span class="token operator" style="color:#063289">&lt;</span><span class="token plain">package</span><span class="token operator" style="color:#063289">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>E.g.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -i direnv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="seeing-installed-packages">Seeing Installed Packages<a href="#seeing-installed-packages" class="hash-link" aria-label="Direct link to Seeing Installed Packages" title="Direct link to Seeing Installed Packages">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -q</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="looking-for-packages">Looking for Packages<a href="#looking-for-packages" class="hash-link" aria-label="Direct link to Looking for Packages" title="Direct link to Looking for Packages">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -qa </span><span class="token operator" style="color:#063289">&lt;</span><span class="token plain">package name</span><span class="token operator" style="color:#063289">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>E.g.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -qa python3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="uninstalling-a-package">Uninstalling a Package<a href="#uninstalling-a-package" class="hash-link" aria-label="Direct link to Uninstalling a Package" title="Direct link to Uninstalling a Package">​</a></h4><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -e </span><span class="token operator" style="color:#063289">&lt;</span><span class="token plain">package</span><span class="token operator" style="color:#063289">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>E.g.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -e chamber</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="profiles">Profiles<a href="#profiles" class="hash-link" aria-label="Direct link to Profiles" title="Direct link to Profiles">​</a></h3><p>Profiles can be used at a global level and on a per-repo basis.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="default">Default<a href="#default" class="hash-link" aria-label="Direct link to Default" title="Direct link to Default">​</a></h4><p>When it&#x27;s installed, <code>nix</code> creates a profile which will store all the
packages you install by default. It will initially only contain the
packages needed for <code>nix</code> itself to work properly.</p><p>If you want, you could tell it to use a different profile. Either on a
one-off command or by switching the active profile. This is covered
more in the <a href="#profiles:-advanced">Profiles: Advanced section</a>.</p><p>Default profile is in: <code>/nix/var/nix/profiles/per-user/&lt;username&gt;/profile/</code>
E.g. <code>/nix/var/nix/profiles/per-user/felipe/profile/</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="repo-profiles">Repo Profiles<a href="#repo-profiles" class="hash-link" aria-label="Direct link to Repo Profiles" title="Direct link to Repo Profiles">​</a></h4><p>Ideally you&#x27;ll have a profile defined at a repo level that will house
your repo&#x27;s dependencies.</p><p>You can use the <code>NIX_PROFILE</code> environment variable when working with this
type of profile so that <code>nix</code> commands know to use that profile, e.g.
when installing repo dependencies. E.g.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#93abdc">NIX_PROFILE</span><span class="token operator" style="color:#063289">=</span><span class="token plain">/nix/var/nix/profiles/myproject</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then you can pre-pend this repo profile to your <code>PATH</code> when you&#x27;re working
with the repo, while keeping your default profile in the <code>PATH</code> behind the
repo profile to still have access to <code>nix</code> commands.</p><p>See
<a href="#working-with-existing-nix-expressions">Working with Existing Nix Expressions</a>
for more details on how to set this up.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="working-with-existing-nix-expressions">Working with Existing Nix Expressions<a href="#working-with-existing-nix-expressions" class="hash-link" aria-label="Direct link to Working with Existing Nix Expressions" title="Direct link to Working with Existing Nix Expressions">​</a></h3><p>For more info see the
<a href="https://nixos.org/manual/nix/stable/#chap-writing-nix-expressions" target="_blank" rel="noopener noreferrer">nix expressions docs</a>.</p><p>If you have a project or directory with a pre-defined <code>default.nix</code> file,
you can install have <code>nix</code> install the packages defined in it. Usually
this file lives in a <code>nix</code> directory, and you can use it like this:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -p /nix/var/nix/profiles/</span><span class="token operator" style="color:#063289">&lt;</span><span class="token plain">profile name</span><span class="token operator" style="color:#063289">&gt;</span><span class="token plain"> -f ./nix -i</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Create an <code>.envrc</code> file in a directory with some environment variables
your project needs:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token function" style="color:#b29762">cat</span><span class="token plain"> </span><span class="token operator" style="color:#063289">&lt;&lt;</span><span class="token string" style="color:#728fcb">ENVRC</span><span class="token string bash punctuation" style="color:#b6ad9a"> </span><span class="token string bash punctuation operator" style="color:#063289">&gt;</span><span class="token string bash punctuation" style="color:#b6ad9a"> .envrc</span><span class="token string" style="color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token string" style="color:#728fcb">export NIX_PROFILE=/nix/var/nix/profiles/myproject</span><br></span><span class="token-line" style="color:#728fcb"><span class="token string" style="display:inline-block;color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token string" style="color:#728fcb">PATH_add </span><span class="token string variable" style="color:#93abdc">${NIX_PROFILE}</span><span class="token string" style="color:#728fcb">/bin</span><br></span><span class="token-line" style="color:#728fcb"><span class="token string" style="color:#728fcb">ENVRC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On first run, you should get a message indicating that you will have to
explicitly authorize <code>direnv</code> to load the file:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">direnv: error .envrc is blocked. Run </span><span class="token variable" style="color:#93abdc">`</span><span class="token variable" style="color:#93abdc">direnv allow</span><span class="token variable" style="color:#93abdc">`</span><span class="token plain"> to approve its content.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Running this should fix it:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">$ direnv allow</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">direnv: loading .envrc</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">direnv: </span><span class="token builtin class-name">export</span><span class="token plain"> +DB_HOST +DB_NAME +DB_PASSWORD +DB_PORT +DB_USER -</span><span class="token environment constant">PS2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Your local environment variables should be updated now. Any time the <code>.envrc</code>
file has changes, you will need to re-approve the file, but it will load
automatically otherwise.</p><p>Nix installations are immutable, so by default you cannot make changes
like installing additional global software via <code>go get</code> or <code>npm install -g</code>.</p><p>To use a local directory for installing go binaries, add to your
<code>.envrc</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">export GOPATH=$PWD/.gopath</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">PATH_add ./.gopath/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To use a local directory for installing npm binaries:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">export NPM_CONFIG_PREFIX=$PWD/.npmglobal</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">PATH_add ./.npmglobal/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="learn-more-about-nix">Learn More About Nix<a href="#learn-more-about-nix" class="hash-link" aria-label="Direct link to Learn More About Nix" title="Direct link to Learn More About Nix">​</a></h2><p>There are several <a href="https://nixos.org/learn.html" target="_blank" rel="noopener noreferrer">nix guides</a>
that you may find helpful in learning more about how <code>nix</code> works
if you are curious.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-usage">Advanced Usage<a href="#advanced-usage" class="hash-link" aria-label="Direct link to Advanced Usage" title="Direct link to Advanced Usage">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="profiles-advanced">Profiles: Advanced<a href="#profiles-advanced" class="hash-link" aria-label="Direct link to Profiles: Advanced" title="Direct link to Profiles: Advanced">​</a></h3><p>In the main profiles section we mention having profiles at a global and
repo level. You can also have profiles on a per-project basis.</p><p>E.g. for MilMove, you might want a profile that contains things like
<code>aws-vault</code>, <code>chamber</code>, etc. which spans more than just the <code>mymove</code>
repo. On the other hand, you may not want to use a global profile
(like the default one mentioned in the next section) because you may
need different versions of <code>aws-vault</code> for different projects.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-profile">Creating a Profile<a href="#creating-a-profile" class="hash-link" aria-label="Direct link to Creating a Profile" title="Direct link to Creating a Profile">​</a></h4><p>You can create a new profile wherever you want, though convention seems
to be to do so in
<code>/nix/var/nix/profiles/</code>
or
<code>/nix/var/nix/profiles/per-user/&lt;username&gt;/</code></p><p>To create a new profile, you can run the command below. Note that this
won&#x27;t actually set this new profile as the active one, that&#x27;s in the
next section.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -p /nix/var/nix/profiles/</span><span class="token operator" style="color:#063289">&lt;</span><span class="token plain">profile name</span><span class="token operator" style="color:#063289">&gt;</span><span class="token plain"> -i nix nss-cacert</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>E.g.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -p /nix/var/nix/profiles/milmove -i nix nss-cacert</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>-p</code> is telling it the path to the profile you want to use for
this <code>nix</code> command. This can be used to work with profiles that aren&#x27;t
the active profile. It can also be used with profiles that don&#x27;t yet
exist (like here) or with exising profiles.</p><p>You may remember the <code>-i</code> is used for installing, so we&#x27;re installing
<code>nix</code> and <code>nss-cacert</code> into our new profile.</p><p>This is needed because of an issue if you just switch to a new profile.
If you don&#x27;t install <code>nix</code> itself, you lose access to <code>nix</code> commands.
And without <code>nss-cacert</code>, you can&#x27;t install packages because <code>nix</code> will
get SSL cert errors.</p><p>For more info see the
<a href="https://github.com/NixOS/nix/issues/1396" target="_blank" rel="noopener noreferrer">nix github issue</a></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="switching-profiles">Switching Profiles<a href="#switching-profiles" class="hash-link" aria-label="Direct link to Switching Profiles" title="Direct link to Switching Profiles">​</a></h4><p>To switch profiles, run</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -S </span><span class="token operator" style="color:#063289">&lt;</span><span class="token plain">path to profile</span><span class="token operator" style="color:#063289">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>E.g.</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">nix-env -S /nix/var/nix/profiles/milmove</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that it is possible to switch to a profile that doesn&#x27;t exist yet
and break <code>nix</code> commands. See creating profiles section for more info.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="more-profile-info">More Profile Info<a href="#more-profile-info" class="hash-link" aria-label="Direct link to More Profile Info" title="Direct link to More Profile Info">​</a></h4><p>See the <a href="https://nixos.org/manual/nix/stable/#sec-profiles" target="_blank" rel="noopener noreferrer">nix profiles docs</a>
for more info.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uninstalling">Uninstalling<a href="#uninstalling" class="hash-link" aria-label="Direct link to Uninstalling" title="Direct link to Uninstalling">​</a></h2><p>Uninstalling <code>nix</code> takes a few steps:</p><ol><li>Remove the <code>nix</code> entry from <code>fstab</code> using <code>sudo vifs</code></li><li>Destroy the data volume using <code>diskutil apfs deleteVolume &#x27;Nix Store&#x27;</code></li><li>Remove the <code>nix</code> line from <code>/etc/synthetic.conf</code> (w/<code>sudo</code>)</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/trussworks/Engineering-Playbook/edit/main/docs/developing/nix/README.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developing/learning/the_effective_engineer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The Effective Engineer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developing/nix/HOWTO"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">NIX HOWTO</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#experiment" class="table-of-contents__link toc-highlight">EXPERIMENT</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#why-nix-why-not-docker" class="table-of-contents__link toc-highlight">Why Nix? Why not Docker?</a><ul><li><a href="#advantages-of-docker" class="table-of-contents__link toc-highlight">Advantages of Docker</a></li><li><a href="#advantages-of-nix" class="table-of-contents__link toc-highlight">Advantages of Nix</a></li><li><a href="#differences-with-homebrew" class="table-of-contents__link toc-highlight">Differences with homebrew</a></li></ul></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting started</a><ul><li><a href="#quick-howto" class="table-of-contents__link toc-highlight">Quick HOWTO</a></li><li><a href="#extra-setup-only-fish-shell-users" class="table-of-contents__link toc-highlight">Extra Setup (Only Fish Shell Users)</a></li><li><a href="#working-with-packages" class="table-of-contents__link toc-highlight">Working With Packages</a></li><li><a href="#profiles" class="table-of-contents__link toc-highlight">Profiles</a></li><li><a href="#working-with-existing-nix-expressions" class="table-of-contents__link toc-highlight">Working with Existing Nix Expressions</a></li></ul></li><li><a href="#learn-more-about-nix" class="table-of-contents__link toc-highlight">Learn More About Nix</a></li><li><a href="#advanced-usage" class="table-of-contents__link toc-highlight">Advanced Usage</a><ul><li><a href="#profiles-advanced" class="table-of-contents__link toc-highlight">Profiles: Advanced</a></li></ul></li><li><a href="#uninstalling" class="table-of-contents__link toc-highlight">Uninstalling</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2024 TrussWorks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1b7e5a17.js"></script>
<script src="/assets/js/main.b09dde9c.js"></script>
</body>
</html>