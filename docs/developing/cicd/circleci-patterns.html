<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-developing/cicd/circleci-patterns">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">CircleCI Config Patterns | Truss Engineering Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.truss.dev/docs/developing/cicd/circleci-patterns"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CircleCI Config Patterns | Truss Engineering Playbook"><meta data-rh="true" name="description" content="At Truss, CircleCI tends to be our CI/CD tool of choice. In order to help"><meta data-rh="true" property="og:description" content="At Truss, CircleCI tends to be our CI/CD tool of choice. In order to help"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://playbook.truss.dev/docs/developing/cicd/circleci-patterns"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/developing/cicd/circleci-patterns" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.truss.dev/docs/developing/cicd/circleci-patterns" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4015f6c5.css">
<link rel="preload" href="/assets/js/runtime~main.339f2161.js" as="script">
<link rel="preload" href="/assets/js/main.3e0179c8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/truss-icon-light.png" alt="Truss Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Engineering Playbook</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">About</a><a class="navbar__item navbar__link" href="/docs/practices">Practices</a><a class="navbar__item navbar__link" href="/docs/incident-response">Incident Response</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trussworks/Engineering-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs">Engineering Playbook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation/intro-to-docs">Introduction to Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation/adr">Architectural Decision Records</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/documentation/external-resources">External Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/compliance">Federal Compliance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/developing">Developing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing">Tools and Practice</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/bugs">Defects/Bugs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/developing/cicd">CI/CD</a><button aria-label="Toggle the collapsible sidebar category &#x27;CI/CD&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cicd/intro">Intro to CI/CD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cicd/circleci-orbs">CircleCI Orbs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developing/cicd/circleci-patterns">CircleCI Config Patterns</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cicd/circleci-utilities">CircleCI Utilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cicd/delivery-pipeline">Standard Delivery Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cicd/dependabot">Dependabot</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/code-reviews">Code Reviews</a><button aria-label="Toggle the collapsible sidebar category &#x27;Code Reviews&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/command-line-tools">Command Line Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Command Line Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/cycle">Development Cycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/eid">Editors, IDEs and Debuggers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/growth">Growth</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/healthcheck">Health Checks</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/helpful-tools">Helpful Tools</a><button aria-label="Toggle the collapsible sidebar category &#x27;Helpful Tools&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/languages">Programming Languages</a><button aria-label="Toggle the collapsible sidebar category &#x27;Programming Languages&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/learning">Learning Resources</a><button aria-label="Toggle the collapsible sidebar category &#x27;Learning Resources&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/nix">nix</a><button aria-label="Toggle the collapsible sidebar category &#x27;nix&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/open-source">Open Source</a><button aria-label="Toggle the collapsible sidebar category &#x27;Open Source&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/pairing">Pair Programming</a><button aria-label="Toggle the collapsible sidebar category &#x27;Pair Programming&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developing/slack">Slack Best Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/technical-design">Technical Design</a><button aria-label="Toggle the collapsible sidebar category &#x27;Technical Design&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/developing/vcs">Source Control</a><button aria-label="Toggle the collapsible sidebar category &#x27;Source Control&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/leadership">Leadership</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/web">Web Development</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developing</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developing/cicd"><span itemprop="name">CI/CD</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CircleCI Config Patterns</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>CircleCI Config Patterns</h1><p>At Truss, CircleCI tends to be our CI/CD tool of choice. In order to help
developers and infrastructure engineers get their pipelines working quickly,
there are some patterns you can use to make your pipeline more robust.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="split-buildpush-steps">Split Build/Push Steps<a href="#split-buildpush-steps" class="hash-link" aria-label="Direct link to Split Build/Push Steps" title="Direct link to Split Build/Push Steps">​</a></h2><p>If you are building a pipeline that builds docker images and then deploys
them to multiple repositories, you can save the built image to the CircleCI
workspace, then load it via another. You will have two commands, a build
command and a push command, and you&#x27;ll run the build job once, and a push
job for each repository.</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Build/Push Config Pattern</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token key atrule" style="color:#728fcb">commands</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  </span><span class="token key atrule" style="color:#728fcb">build_image</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">parameters</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">dockerfile</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token key atrule" style="color:#728fcb">type</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">image_name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token key atrule" style="color:#728fcb">type</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">tag</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token key atrule" style="color:#728fcb">type</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">run</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;Build docker image&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">command</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">|</span><span class="token scalar string" style="color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            docker build -f &lt;&lt; parameters.dockerfile &gt;&gt; -t &lt;&lt; parameters.image_name &gt;&gt;:&lt;&lt; parameters.tag &gt;&gt; .</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            mkdir -p workspace</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            docker save -o workspace/&lt;&lt; parameters.image_name &gt;&gt; &lt;&lt; parameters.image_name &gt;&gt;:&lt;&lt; parameters.tag &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">persist_to_workspace</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">root</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> workspace</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">paths</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> &lt;&lt; parameters.image_name </span><span class="token punctuation" style="color:#b6ad9a">&gt;</span><span class="token punctuation" style="color:#b6ad9a">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  </span><span class="token key atrule" style="color:#728fcb">push_image</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">parameters</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">image_name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token key atrule" style="color:#728fcb">type</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">tag</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token key atrule" style="color:#728fcb">type</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">repo</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token key atrule" style="color:#728fcb">type</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> string</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">attach_workspace</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">at</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> /tmp/workspace</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">run</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;Retrieve docker image from workspace&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">command</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">|</span><span class="token scalar string" style="color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            docker load -i /tmp/workspace/&lt;&lt; parameters.image_name &gt;&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">run</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;Tag and push docker image&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">command</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">|</span><span class="token scalar string" style="color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            bash -c &quot;$(aws ecr get-login --no-include-email --region $AWS_REGION)&quot;</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            docker tag &lt;&lt; parameters.image_name &gt;&gt;:&lt;&lt; parameters.tag &gt;&gt; ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/&lt;&lt; parameters.repo &gt;&gt;:git-commit-${CIRCLE_SHA1}</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">            docker push ${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_REGION}.amazonaws.com/&lt;&lt; parameters.repo &gt;&gt;:git-commit-${CIRCLE_SHA1}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain"></span><span class="token key atrule" style="color:#728fcb">jobs</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  </span><span class="token key atrule" style="color:#728fcb">build</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">executor</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> checkout</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">setup_remote_docker</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token comment" style="color:#b6ad9a"># You can set docker_layer_caching to true if you have a paid plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">docker_layer_caching</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#896724;font-weight:bold">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> make bin_linux/my_app</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">build_image</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">dockerfile</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> Dockerfile</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">image_name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> my_app</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">tag</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  </span><span class="token key atrule" style="color:#728fcb">push</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">executor</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">setup_remote_docker</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token comment" style="color:#b6ad9a"># You can set docker_layer_caching to true if you have a paid plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">docker_layer_caching</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#896724;font-weight:bold">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">push_image</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">image_name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> my_app</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">tag</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">          </span><span class="token key atrule" style="color:#728fcb">repo</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> app</span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain">my_app</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><p>Reference: <a href="https://support.circleci.com/hc/en-us/articles/360019182513-Build-Docker-image-in-one-job-and-use-in-another-job" target="_blank" rel="noopener noreferrer">Build Docker image in one job and use in another job</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-account-operations">Multiple Account Operations<a href="#multiple-account-operations" class="hash-link" aria-label="Direct link to Multiple Account Operations" title="Direct link to Multiple Account Operations">​</a></h2><p>With the use of AWS Organizations, it&#x27;s not uncommon that we want CircleCI
to execute steps in different AWS accounts. You can update AWS credentials
and variables by saving multiple versions of the environment variables in
CircleCI, and then using commands to swap between them. See the example
code below:</p><details class="details_lb9f alert alert--info details_b_Ee" data-collapsed="true"><summary>Multiple AWS Account Credentials Pattern</summary><div><div class="collapsibleContent_i85q"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#faf8f5;--prism-color:#728fcb"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#728fcb"><span class="token plain">  </span><span class="token key atrule" style="color:#728fcb">commands</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">aws_vars_dev</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">run</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token key atrule" style="color:#728fcb">name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;Setting up AWS environment variables for dev&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token key atrule" style="color:#728fcb">command</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">|</span><span class="token scalar string" style="color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_REGION=$DEV_REGION&quot; &gt;&gt; $BASH_ENV</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_ACCOUNT_ID=$DEV_ACCOUNT_ID&quot; &gt;&gt; $BASH_ENV</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_ACCESS_KEY_ID=$DEV_ACCESS_KEY&quot; &gt;&gt; $BASH_ENV</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_SECRET_ACCESS_KEY=$DEV_SECRET_ACCESS_KEY&quot; &gt;&gt; $BASH_ENV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">aws_vars_prod</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">run</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token key atrule" style="color:#728fcb">name</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token string" style="color:#728fcb">&#x27;Setting up AWS environment variables for prod&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token key atrule" style="color:#728fcb">command</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#b6ad9a">|</span><span class="token scalar string" style="color:#728fcb"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_REGION=$PROD_REGION&quot; &gt;&gt; $BASH_ENV</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_ACCOUNT_ID=$PROD_ACCOUNT_ID&quot; &gt;&gt; $BASH_ENV</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_ACCESS_KEY_ID=$PROD_ACCESS_KEY&quot; &gt;&gt; $BASH_ENV</span><br></span><span class="token-line" style="color:#728fcb"><span class="token scalar string" style="color:#728fcb">              echo &quot;export AWS_SECRET_ACCESS_KEY=$PROD_SECRET_ACCESS_KEY&quot; &gt;&gt; $BASH_ENV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">  </span><span class="token key atrule" style="color:#728fcb">jobs</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">do_thing_dev</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">executor</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> aws_vars_dev</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">do_thing</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token key atrule" style="color:#728fcb">environment</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> dev</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">    </span><span class="token key atrule" style="color:#728fcb">do_thing_prod</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">executor</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> main</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">      </span><span class="token key atrule" style="color:#728fcb">steps</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> aws_vars_prod</span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">        </span><span class="token punctuation" style="color:#b6ad9a">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#728fcb">do_thing</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#728fcb"><span class="token plain">            </span><span class="token key atrule" style="color:#728fcb">environment</span><span class="token punctuation" style="color:#b6ad9a">:</span><span class="token plain"> prod</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></details><p>Reference: <a href="https://circleci.com/docs/2.0/env-vars/#using-bash_env-to-set-environment-variables" target="_blank" rel="noopener noreferrer">Using <code>BASH_ENV</code> to set environment variables</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-approval-by-restricted-groups">Manual Approval by Restricted Groups<a href="#manual-approval-by-restricted-groups" class="hash-link" aria-label="Direct link to Manual Approval by Restricted Groups" title="Direct link to Manual Approval by Restricted Groups">​</a></h2><p>If you need to gate part of your CI/CD pipeline to a small group (for
example, you want only product managers to be able to approve deploys to
your production environment), you can use a CircleCI restricted context
to achieve this. You will need to create a GitHub team for the people you
want to be able to approve these jobs, create a context in the CircleCI
UI that includes this team only, and then add the context to all jobs
<em>after</em> the approval job.</p><p>Reference: <a href="https://circleci.com/docs/2.0/contexts/" target="_blank" rel="noopener noreferrer">CircleCI Contexts</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/trussworks/Engineering-Playbook/edit/main/docs/developing/cicd/circleci-patterns.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developing/cicd/circleci-orbs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CircleCI Orbs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developing/cicd/circleci-utilities"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CircleCI Utilities</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#split-buildpush-steps" class="table-of-contents__link toc-highlight">Split Build/Push Steps</a></li><li><a href="#multiple-account-operations" class="table-of-contents__link toc-highlight">Multiple Account Operations</a></li><li><a href="#manual-approval-by-restricted-groups" class="table-of-contents__link toc-highlight">Manual Approval by Restricted Groups</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2023 TrussWorks, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.339f2161.js"></script>
<script src="/assets/js/main.3e0179c8.js"></script>
</body>
</html>